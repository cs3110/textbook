

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>5.8. Includes &#8212; OCaml Programming: Correct + Efficient + Beautiful</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=bd9e20870c6007c4c509" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=bd9e20870c6007c4c509" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=bd9e20870c6007c4c509"></script>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/modules/includes';</script>
    <link rel="shortcut icon" href="../../_static/op.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="5.9. Functors" href="functors.html" />
    <link rel="prev" title="5.7. Module Type Constraints" href="module_type_constraints.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <header>


  <div class="bd-header-announcement container-fluid bd-header-announcement">
    <div class="bd-header-announcement__content">Using this book as part of a course? Please <a style="color:white" href="https://docs.google.com/forms/d/e/1FAIpQLSfEW65AJPBnk732zZZM9CFpWMobWUkym6Nf-pgslRqqwoWYIA/viewform?usp=preview">let us know</a>!</div>
  </div>

  
    <div class="bd-header navbar navbar-expand-lg bd-navbar">
    </div>
  
  </header>

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../cover.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/op_title.png" class="logo__image only-light" alt="OCaml Programming: Correct + Efficient + Beautiful - Home"/>
    <script>document.write(`<img src="../../_static/op_title.png" class="logo__image only-dark" alt="OCaml Programming: Correct + Efficient + Beautiful - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Preface</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../preface/about.html">About This Book</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preface/install.html">Installing OCaml</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../intro/intro.html">1. Better Programming Through OCaml</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro/past.html">1.1. The Past of OCaml</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/present.html">1.2. The Present of OCaml</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/future.html">1.3. Look to Your Future</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/3110.html">1.4. A Brief History of CS 3110</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/summary.html">1.5. Summary</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../basics/intro.html">2. The Basics of OCaml</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../basics/toplevel.html">2.1. The OCaml Toplevel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/compiling.html">2.2. Compiling OCaml Programs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/expressions.html">2.3. Expressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/functions.html">2.4. Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/documentation.html">2.5. Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/printing.html">2.6. Printing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/debugging.html">2.7. Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/summary.html">2.8. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/exercises.html">2.9. Exercises</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">OCaml Programming</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../data/intro.html">3. Data and Types</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../data/lists.html">3.1. Lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/variants.html">3.2. Variants</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/ounit.html">3.3. Unit Testing with OUnit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/records_tuples.html">3.4. Records and Tuples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/pattern_matching_advanced.html">3.5. Advanced Pattern Matching</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/type_synonym.html">3.6. Type Synonyms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/options.html">3.7. Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/assoc_list.html">3.8. Association Lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/algebraic_data_types.html">3.9. Algebraic Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/exceptions.html">3.10. Exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/trees.html">3.11. Example: Trees</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/nats.html">3.12. Example: Natural Numbers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/summary.html">3.13. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/exercises.html">3.14. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../hop/intro.html">4. Higher-Order Programming</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../hop/higher_order.html">4.1. Higher-Order Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/map.html">4.2. Map</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/filter.html">4.3. Filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/fold.html">4.4. Fold</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/beyond_lists.html">4.5. Beyond Lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/pipelining.html">4.6. Pipelining</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/currying.html">4.7. Currying</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/summary.html">4.8. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/exercises.html">4.9. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="intro.html">5. Modular Programming</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="module_systems.html">5.1. Module Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="modules.html">5.2. Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="toplevel.html">5.3. Modules and the Toplevel</a></li>
<li class="toctree-l2"><a class="reference internal" href="encapsulation.html">5.4. Encapsulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="compilation_units.html">5.5. Compilation Units</a></li>
<li class="toctree-l2"><a class="reference internal" href="functional_data_structures.html">5.6. Functional Data Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="module_type_constraints.html">5.7. Module Type Constraints</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">5.8. Includes</a></li>
<li class="toctree-l2"><a class="reference internal" href="functors.html">5.9. Functors</a></li>
<li class="toctree-l2"><a class="reference internal" href="summary.html">5.10. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="exercises.html">5.11. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../mut/intro.html">6. Mutability</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../mut/refs.html">6.1. Refs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mut/mutable_fields.html">6.2. Mutable Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mut/arrays.html">6.3. Arrays and Loops</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mut/summary.html">6.4. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mut/exercises.html">6.5. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../conc/intro.html">7. Concurrency</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../conc/concurrency.html">7.1. Concurrency</a></li>
<li class="toctree-l2"><a class="reference internal" href="../conc/promises.html">7.2. Promises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../conc/impl_promises.html">7.3. Implementing Promises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../conc/io_promises.html">7.4. Asynchronous Input and Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../conc/callbacks.html">7.5. Callbacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../conc/impl_callbacks.html">7.6. Implementing Callbacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../conc/full_promises_impl.html">7.7. The Full Promises Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../conc/monads.html">7.8. Monads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../conc/summary.html">7.9. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../conc/exercises.html">7.10. Exercises</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Correctness and Efficiency</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../correctness/intro.html">8. Correctness</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../correctness/specifications.html">8.1. Specifications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/function_docs.html">8.2. Function Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/module_docs.html">8.3. Module Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/test_debug.html">8.4. Testing and Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/black_glass_box.html">8.5. Black-box and Glass-box Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/randomized.html">8.6. Randomized Testing with QCheck</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/proving_correctness.html">8.7. Proving Correctness</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/structural_induction.html">8.8. Structural Induction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/eq_spec.html">8.9. Equational Specification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/summary.html">8.10. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/exercises.html">8.11. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ds/intro.html">9. Data Structures</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ds/hash_tables.html">9.1. Hash Tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/amortized.html">9.2. Amortized Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/rb.html">9.3. Red-Black Trees</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/sequence.html">9.4. Sequences</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/memoization.html">9.5. Memoization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/parrays.html">9.6. Persistent Arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/summary.html">9.7. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/exercises.html">9.8. Exercises</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Language Implementation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../interp/intro.html">10. Interpreters</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../interp/calculator.html">10.1. Example: Calculator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/parsing.html">10.2. Parsing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/substitution.html">10.3. Substitution Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/environment.html">10.4. Environment Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/typecheck.html">10.5. Type Checking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/inference.html">10.6. Type Inference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/summary.html">10.7. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/exercises.html">10.8. Exercises</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Lagniappe</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../adv/curry-howard.html">The Curry-Howard Correspondence</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../appendix/bigoh.html">Big-Oh Notation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/vm.html">Virtual Machine</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/cs3110/textbook/main?urlpath=tree/src/chapters/modules/includes.md" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/cs3110/textbook" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/cs3110/textbook/edit/main/src/chapters/modules/includes.md" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/cs3110/textbook/issues/new?title=Issue%20on%20page%20%2Fchapters/modules/includes.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/chapters/modules/includes.ipynb" target="_blank"
   class="btn btn-sm btn-download-notebook-button dropdown-item"
   title="Download notebook file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li><a href="../../_sources/chapters/modules/includes.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Includes</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#semantics-of-includes">5.8.1. Semantics of Includes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#encapsulation-and-includes">5.8.2. Encapsulation and Includes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#include-vs-open">5.8.3. Include vs. Open</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#including-code-in-multiple-modules">5.8.4. Including Code in Multiple Modules</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="includes">
<h1><span class="section-number">5.8. </span>Includes<a class="headerlink" href="#includes" title="Permalink to this heading">#</a></h1>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/SmG3ChuOLpQ" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>Copying and pasting code is almost always a bad idea. Duplication of code causes
duplication and proliferation of errors. So why are we so prone to making this
mistake? Maybe because it always seems like the easier option — easier and
quicker than applying the Abstraction Principle as we should to factor out
common code.</p>
<p>The OCaml module system provides a neat feature called <em>includes</em> that is like a
principled copy-and-paste that is quick and easy to use, but avoids actual
duplication. It can be used to solve some of the same problems as <em>inheritance</em>
in object-oriented languages.</p>
<p>Let’s start with an example. Recall this implementation of sets as lists:</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="k">type</span> <span class="nc">Set</span> <span class="o">=</span> <span class="k">sig</span>
  <span class="k">type</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span>
  <span class="k">val</span> <span class="n">empty</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span>
  <span class="k">val</span> <span class="n">mem</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="kt">bool</span>
  <span class="k">val</span> <span class="n">add</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span>
  <span class="k">val</span> <span class="n">elements</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="kt">list</span>
<span class="k">end</span>

<span class="k">module</span> <span class="nc">ListSet</span> <span class="o">:</span> <span class="nc">Set</span> <span class="o">=</span> <span class="k">struct</span>
  <span class="k">type</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">=</span> <span class="k">&#39;</span><span class="n">a</span> <span class="kt">list</span>
  <span class="k">let</span> <span class="n">empty</span> <span class="o">=</span> <span class="bp">[]</span>
  <span class="k">let</span> <span class="n">mem</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">mem</span>
  <span class="k">let</span> <span class="n">add</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">cons</span>
  <span class="k">let</span> <span class="n">elements</span> <span class="n">s</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">sort_uniq</span> <span class="nn">Stdlib</span><span class="p">.</span><span class="n">compare</span> <span class="n">s</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>module type Set =
  sig
    type &#39;a t
    val empty : &#39;a t
    val mem : &#39;a -&gt; &#39;a t -&gt; bool
    val add : &#39;a -&gt; &#39;a t -&gt; &#39;a t
    val elements : &#39;a t -&gt; &#39;a list
  end
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>module ListSet : Set
</pre></div>
</div>
</div>
</details>
</div>
<p>Suppose we wanted to add a function <code class="docutils literal notranslate"><span class="pre">of_list</span> <span class="pre">:</span> <span class="pre">'a</span> <span class="pre">list</span> <span class="pre">-&gt;</span> <span class="pre">'a</span> <span class="pre">t</span></code> that could
construct a set out of a list. If we had access to the source code of both
<code class="docutils literal notranslate"><span class="pre">ListSet</span></code> and <code class="docutils literal notranslate"><span class="pre">Set</span></code>, and if we were permitted to modify it, this wouldn’t be
hard. But what if they were third-party libraries for which we didn’t have
source code?</p>
<p>In Java, we might use inheritance to solve this problem:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">interface</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
<span class="kd">class</span> <span class="nc">ListSet</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
<span class="kd">class</span> <span class="nc">ListSetExtended</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">ListSet</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">ofList</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lst</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>That helps us to reuse code, because the subclass inherits all the methods of
its superclass.</p>
<p>OCaml <em>includes</em> are similar. They enable a module to include all the items
defined by another module, or a module type to include all the specifications of
another module type.</p>
<p>Here’s how we can use includes to solve the problem of adding <code class="docutils literal notranslate"><span class="pre">of_list</span></code> to
<code class="docutils literal notranslate"><span class="pre">ListSet</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="nc">ListSetExtended</span> <span class="o">=</span> <span class="k">struct</span>
  <span class="k">include</span> <span class="nc">ListSet</span>
  <span class="k">let</span> <span class="n">of_list</span> <span class="n">lst</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">fold_right</span> <span class="n">add</span> <span class="n">lst</span> <span class="n">empty</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>module ListSetExtended :
  sig
    type &#39;a t = &#39;a ListSet.t
    val empty : &#39;a t
    val mem : &#39;a -&gt; &#39;a t -&gt; bool
    val add : &#39;a -&gt; &#39;a t -&gt; &#39;a t
    val elements : &#39;a t -&gt; &#39;a list
    val of_list : &#39;a list -&gt; &#39;a t
  end
</pre></div>
</div>
</div>
</div>
<p>This code says that <code class="docutils literal notranslate"><span class="pre">ListSetExtended</span></code> is a module that includes all the
definitions of the <code class="docutils literal notranslate"><span class="pre">ListSet</span></code> module, as well as a definition of <code class="docutils literal notranslate"><span class="pre">of_list</span></code>. We
don’t have to know the source code implementing <code class="docutils literal notranslate"><span class="pre">ListSet</span></code> to make this happen.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You might wonder why we can’t simply implement <code class="docutils literal notranslate"><span class="pre">of_list</span></code> as the identity
function. See the section below on encapsulation for the answer.</p>
</div>
<section id="semantics-of-includes">
<h2><span class="section-number">5.8.1. </span>Semantics of Includes<a class="headerlink" href="#semantics-of-includes" title="Permalink to this heading">#</a></h2>
<p>Includes can be used inside of structures and signatures. When we include inside
a signature, we must be including another signature. And when we include inside
a structure, we must be including another structure.</p>
<p><strong>Including a structure</strong> is effectively just syntactic sugar for writing a
local definition for each name defined in the module. Writing <code class="docutils literal notranslate"><span class="pre">include</span> <span class="pre">ListSet</span></code>
as we did above, for example, has an effect similar to writing the following:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="nc">ListSetExtended</span> <span class="o">=</span> <span class="k">struct</span>
  <span class="c">(* BEGIN all the includes *)</span>
  <span class="k">type</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">=</span> <span class="k">&#39;</span><span class="n">a</span> <span class="nn">ListSet</span><span class="p">.</span><span class="n">t</span>
  <span class="k">let</span> <span class="n">empty</span> <span class="o">=</span> <span class="nn">ListSet</span><span class="p">.</span><span class="n">empty</span>
  <span class="k">let</span> <span class="n">mem</span> <span class="o">=</span> <span class="nn">ListSet</span><span class="p">.</span><span class="n">mem</span>
  <span class="k">let</span> <span class="n">add</span> <span class="o">=</span> <span class="nn">ListSet</span><span class="p">.</span><span class="n">add</span>
  <span class="k">let</span> <span class="n">elements</span> <span class="o">=</span> <span class="nn">ListSet</span><span class="p">.</span><span class="n">elements</span>
  <span class="c">(* END all the includes *)</span>
  <span class="k">let</span> <span class="n">of_list</span> <span class="n">lst</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">fold_right</span> <span class="n">add</span> <span class="n">lst</span> <span class="n">empty</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>module ListSetExtended :
  sig
    type &#39;a t = &#39;a ListSet.t
    val empty : &#39;a ListSet.t
    val mem : &#39;a -&gt; &#39;a ListSet.t -&gt; bool
    val add : &#39;a -&gt; &#39;a ListSet.t -&gt; &#39;a ListSet.t
    val elements : &#39;a ListSet.t -&gt; &#39;a list
    val of_list : &#39;a list -&gt; &#39;a ListSet.t
  end
</pre></div>
</div>
</div>
</div>
<p>None of that is actually copying the source code of <code class="docutils literal notranslate"><span class="pre">ListSet</span></code>. Rather, the
<code class="docutils literal notranslate"><span class="pre">include</span></code> just creates a new definition in <code class="docutils literal notranslate"><span class="pre">ListSetExtended</span></code> with the same name
as each definition in <code class="docutils literal notranslate"><span class="pre">ListSet</span></code>. But if the set of names defined inside
<code class="docutils literal notranslate"><span class="pre">ListSet</span></code> ever changed, the <code class="docutils literal notranslate"><span class="pre">include</span></code> would reflect that change, whereas a
copy-paste job would not.</p>
<p><strong>Including a signature</strong> is much the same. For example, we could write:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="k">type</span> <span class="nc">SetExtended</span> <span class="o">=</span> <span class="k">sig</span>
  <span class="k">include</span> <span class="nc">Set</span>
  <span class="k">val</span> <span class="n">of_list</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="kt">list</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>module type SetExtended =
  sig
    type &#39;a t
    val empty : &#39;a t
    val mem : &#39;a -&gt; &#39;a t -&gt; bool
    val add : &#39;a -&gt; &#39;a t -&gt; &#39;a t
    val elements : &#39;a t -&gt; &#39;a list
    val of_list : &#39;a list -&gt; &#39;a t
  end
</pre></div>
</div>
</div>
</div>
<p>Which would have an effect similar to writing the following:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="k">type</span> <span class="nc">SetExtended</span> <span class="o">=</span> <span class="k">sig</span>
  <span class="c">(* BEGIN all the includes *)</span>
  <span class="k">type</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span>
  <span class="k">val</span> <span class="n">empty</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span>
  <span class="k">val</span> <span class="n">mem</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="kt">bool</span>
  <span class="k">val</span> <span class="n">add</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span>
  <span class="k">val</span> <span class="n">elements</span>  <span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="kt">list</span>
  <span class="c">(* END all the includes *)</span>
  <span class="k">val</span> <span class="n">of_list</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="kt">list</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>module type SetExtended =
  sig
    type &#39;a t
    val empty : &#39;a t
    val mem : &#39;a -&gt; &#39;a t -&gt; bool
    val add : &#39;a -&gt; &#39;a t -&gt; &#39;a t
    val elements : &#39;a t -&gt; &#39;a list
    val of_list : &#39;a list -&gt; &#39;a t
  end
</pre></div>
</div>
</div>
</div>
<p>That module type would be suitable for <code class="docutils literal notranslate"><span class="pre">ListSetExtended</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="nc">ListSetExtended</span> <span class="o">:</span> <span class="nc">SetExtended</span> <span class="o">=</span> <span class="k">struct</span>
  <span class="k">include</span> <span class="nc">ListSet</span>
  <span class="k">let</span> <span class="n">of_list</span> <span class="n">lst</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">fold_right</span> <span class="n">add</span> <span class="n">lst</span> <span class="n">empty</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>module ListSetExtended : SetExtended
</pre></div>
</div>
</div>
</div>
</section>
<section id="encapsulation-and-includes">
<h2><span class="section-number">5.8.2. </span>Encapsulation and Includes<a class="headerlink" href="#encapsulation-and-includes" title="Permalink to this heading">#</a></h2>
<p>We mentioned above that you might wonder why we didn’t write this simpler
definition of <code class="docutils literal notranslate"><span class="pre">of_list</span></code>:</p>
<div class="cell tag_raises-exception docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="nc">ListSetExtended</span> <span class="o">:</span> <span class="nc">SetExtended</span> <span class="o">=</span> <span class="k">struct</span>
  <span class="k">include</span> <span class="nc">ListSet</span>
  <span class="k">let</span> <span class="n">of_list</span> <span class="n">lst</span> <span class="o">=</span> <span class="n">lst</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">File</span> <span class="s2">&quot;[7]&quot;</span><span class="p">,</span> <span class="n">lines</span> <span class="mi">1</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="n">characters</span> <span class="mi">39</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span>
<span class="mi">1</span> <span class="o">|</span> <span class="o">.......................................</span><span class="n">struct</span>
<span class="mi">2</span> <span class="o">|</span>   <span class="n">include</span> <span class="n">ListSet</span>
<span class="mi">3</span> <span class="o">|</span>   <span class="n">let</span> <span class="n">of_list</span> <span class="n">lst</span> <span class="o">=</span> <span class="n">lst</span>
<span class="mi">4</span> <span class="o">|</span> <span class="n">end</span>
<span class="ne">Error</span>: Signature mismatch:
       <span class="o">...</span>
       <span class="n">Values</span> <span class="n">do</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
         <span class="n">val</span> <span class="n">of_list</span> <span class="p">:</span> <span class="s1">&#39;a -&gt; &#39;</span><span class="n">a</span>
       <span class="ow">is</span> <span class="ow">not</span> <span class="n">included</span> <span class="ow">in</span>
         <span class="n">val</span> <span class="n">of_list</span> <span class="p">:</span> <span class="s1">&#39;a list -&gt; &#39;</span><span class="n">a</span> <span class="n">t</span>
       <span class="n">The</span> <span class="nb">type</span> <span class="s1">&#39;a list -&gt; &#39;</span><span class="n">a</span> <span class="nb">list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">compatible</span> <span class="k">with</span> <span class="n">the</span> <span class="nb">type</span>
         <span class="s1">&#39;a list -&gt; &#39;</span><span class="n">a</span> <span class="n">t</span>
       <span class="n">Type</span> <span class="s1">&#39;a list is not compatible with type &#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">=</span> <span class="s1">&#39;a ListSet.t </span>
       <span class="n">File</span> <span class="s2">&quot;[5]&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">9</span><span class="p">,</span> <span class="n">characters</span> <span class="mi">2</span><span class="o">-</span><span class="mi">31</span><span class="p">:</span> <span class="n">Expected</span> <span class="n">declaration</span>
       <span class="n">File</span> <span class="s2">&quot;[7]&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">3</span><span class="p">,</span> <span class="n">characters</span> <span class="mi">6</span><span class="o">-</span><span class="mi">13</span><span class="p">:</span> <span class="n">Actual</span> <span class="n">declaration</span>
</pre></div>
</div>
</div>
</div>
<p>Check out that error message.  It looks like <code class="docutils literal notranslate"><span class="pre">of_list</span></code> doesn’t have the right
type.  What if we try adding some type annotations?</p>
<div class="cell tag_raises-exception docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="nc">ListSetExtended</span> <span class="o">:</span> <span class="nc">SetExtended</span> <span class="o">=</span> <span class="k">struct</span>
  <span class="k">include</span> <span class="nc">ListSet</span>
  <span class="k">let</span> <span class="n">of_list</span> <span class="o">(</span><span class="n">lst</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="kt">list</span><span class="o">)</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">=</span> <span class="n">lst</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">File</span> <span class="s2">&quot;[8]&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">3</span><span class="p">,</span> <span class="n">characters</span> <span class="mi">39</span><span class="o">-</span><span class="mi">42</span><span class="p">:</span>
<span class="mi">3</span> <span class="o">|</span>   <span class="n">let</span> <span class="n">of_list</span> <span class="p">(</span><span class="n">lst</span> <span class="p">:</span> <span class="s1">&#39;a list) : &#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">=</span> <span class="n">lst</span>
                                           <span class="o">^^^</span>
<span class="ne">Error</span>: This expression has type &#39;a list
       <span class="n">but</span> <span class="n">an</span> <span class="n">expression</span> <span class="n">was</span> <span class="n">expected</span> <span class="n">of</span> <span class="nb">type</span> <span class="s1">&#39;a t = &#39;</span><span class="n">a</span> <span class="n">ListSet</span><span class="o">.</span><span class="n">t</span>
</pre></div>
</div>
</div>
</div>
<p>Ah, now the problem is clearer: in the body of <code class="docutils literal notranslate"><span class="pre">of_list</span></code>, the equality of <code class="docutils literal notranslate"><span class="pre">'a</span> <span class="pre">t</span></code>
and <code class="docutils literal notranslate"><span class="pre">'a</span> <span class="pre">list</span></code> isn’t known. In <code class="docutils literal notranslate"><span class="pre">ListSetExtended</span></code>, we do know that
<code class="docutils literal notranslate"><span class="pre">'a</span> <span class="pre">t</span> <span class="pre">=</span> <span class="pre">'a</span> <span class="pre">ListSet.t</span></code>, because that’s what the <code class="docutils literal notranslate"><span class="pre">include</span></code> gave us. But the fact
that <code class="docutils literal notranslate"><span class="pre">'a</span> <span class="pre">ListSet.t</span> <span class="pre">=</span> <span class="pre">'a</span> <span class="pre">list</span></code> was hidden when <code class="docutils literal notranslate"><span class="pre">ListSet</span></code> was sealed at module
type <code class="docutils literal notranslate"><span class="pre">Set</span></code>. So, includes must obey encapsulation, just like the rest of the
module system.</p>
<p>One workaround is to rewrite the definitions as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="nc">ListSetImpl</span> <span class="o">=</span> <span class="k">struct</span>
  <span class="k">type</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">=</span> <span class="k">&#39;</span><span class="n">a</span> <span class="kt">list</span>
  <span class="k">let</span> <span class="n">empty</span> <span class="o">=</span> <span class="bp">[]</span>
  <span class="k">let</span> <span class="n">mem</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">mem</span>
  <span class="k">let</span> <span class="n">add</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">cons</span>
  <span class="k">let</span> <span class="n">elements</span> <span class="n">s</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">sort_uniq</span> <span class="nn">Stdlib</span><span class="p">.</span><span class="n">compare</span> <span class="n">s</span>
<span class="k">end</span>

<span class="k">module</span> <span class="nc">ListSet</span> <span class="o">:</span> <span class="nc">Set</span> <span class="o">=</span> <span class="nc">ListSetImpl</span>

<span class="k">module</span> <span class="k">type</span> <span class="nc">SetExtended</span> <span class="o">=</span> <span class="k">sig</span>
  <span class="k">include</span> <span class="nc">Set</span>
  <span class="k">val</span> <span class="n">of_list</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="kt">list</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span>
<span class="k">end</span>

<span class="k">module</span> <span class="nc">ListSetExtendedImpl</span> <span class="o">=</span> <span class="k">struct</span>
  <span class="k">include</span> <span class="nc">ListSetImpl</span>
  <span class="k">let</span> <span class="n">of_list</span> <span class="n">lst</span> <span class="o">=</span> <span class="n">lst</span>
<span class="k">end</span>

<span class="k">module</span> <span class="nc">ListSetExtended</span> <span class="o">:</span> <span class="nc">SetExtended</span> <span class="o">=</span> <span class="nc">ListSetExtendedImpl</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>module ListSetImpl :
  sig
    type &#39;a t = &#39;a list
    val empty : &#39;a list
    val mem : &#39;a -&gt; &#39;a list -&gt; bool
    val add : &#39;a -&gt; &#39;a list -&gt; &#39;a list
    val elements : &#39;a list -&gt; &#39;a list
  end
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>module ListSet : Set
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>module type SetExtended =
  sig
    type &#39;a t
    val empty : &#39;a t
    val mem : &#39;a -&gt; &#39;a t -&gt; bool
    val add : &#39;a -&gt; &#39;a t -&gt; &#39;a t
    val elements : &#39;a t -&gt; &#39;a list
    val of_list : &#39;a list -&gt; &#39;a t
  end
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>module ListSetExtendedImpl :
  sig
    type &#39;a t = &#39;a list
    val empty : &#39;a list
    val mem : &#39;a -&gt; &#39;a list -&gt; bool
    val add : &#39;a -&gt; &#39;a list -&gt; &#39;a list
    val elements : &#39;a list -&gt; &#39;a list
    val of_list : &#39;a -&gt; &#39;a
  end
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>module ListSetExtended : SetExtended
</pre></div>
</div>
</div>
</div>
<p>The important change is that <code class="docutils literal notranslate"><span class="pre">ListSetImpl</span></code> is not sealed, so its type <code class="docutils literal notranslate"><span class="pre">'a</span> <span class="pre">t</span></code> is
not abstract. When we include it in <code class="docutils literal notranslate"><span class="pre">ListSetExtended</span></code>, we can therefore exploit
the fact that it’s a synonym for <code class="docutils literal notranslate"><span class="pre">'a</span> <span class="pre">list</span></code>.</p>
<p>What we just did is effectively the same as what Java does to handle the
visibility modifiers <code class="docutils literal notranslate"><span class="pre">public</span></code>, <code class="docutils literal notranslate"><span class="pre">private</span></code>, etc. The “private version” of a class
is like the <code class="docutils literal notranslate"><span class="pre">Impl</span></code> version above: anyone who can see that version gets to see
all the exposed items (fields in Java, types in OCaml), without any
encapsulation. The “public version” of a class is like the sealed version above:
anyone who can see that version is forced to treat the items as abstract, hence
encapsulated.</p>
<p>With that technique, if we want to provide a new implementation of one of the
included functions we <em>could</em> do that too:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="nc">ListSetExtendedImpl</span> <span class="o">=</span> <span class="k">struct</span>
  <span class="k">include</span> <span class="nc">ListSetImpl</span>
  <span class="k">let</span> <span class="n">of_list</span> <span class="n">lst</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">fold_right</span> <span class="n">add</span> <span class="n">lst</span> <span class="n">empty</span>
  <span class="k">let</span> <span class="k">rec</span> <span class="n">elements</span> <span class="o">=</span> <span class="k">function</span>
    <span class="o">|</span> <span class="bp">[]</span> <span class="o">-&gt;</span> <span class="bp">[]</span>
    <span class="o">|</span> <span class="n">h</span> <span class="o">::</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="k">if</span> <span class="n">mem</span> <span class="n">h</span> <span class="n">t</span> <span class="k">then</span> <span class="n">elements</span> <span class="n">t</span> <span class="k">else</span> <span class="n">h</span> <span class="o">::</span> <span class="n">elements</span> <span class="n">t</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>module ListSetExtendedImpl :
  sig
    type &#39;a t = &#39;a list
    val empty : &#39;a list
    val mem : &#39;a -&gt; &#39;a list -&gt; bool
    val add : &#39;a -&gt; &#39;a list -&gt; &#39;a list
    val of_list : &#39;a list -&gt; &#39;a list
    val elements : &#39;a list -&gt; &#39;a list
  end
</pre></div>
</div>
</div>
</div>
<p>But that’s a bad idea. First, it’s actually a quadratic implementation of
<code class="docutils literal notranslate"><span class="pre">elements</span></code> instead of linearithmic. Second, it does not <em>replace</em> the original
implementation of <code class="docutils literal notranslate"><span class="pre">elements</span></code>. Remember the semantics of modules: all definitions
are evaluated from top to bottom, in order. So the new definition of <code class="docutils literal notranslate"><span class="pre">elements</span></code>
above won’t come into use until the very end of evaluation. If any earlier
functions had happened to use <code class="docutils literal notranslate"><span class="pre">elements</span></code> as a helper, they would use the
original linearithmic version, not the new quadratic version.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This differs from what you might expect from Java, which uses a language feature
called <a class="reference external" href="https://en.wikipedia.org/wiki/Dynamic_dispatch">dynamic dispatch</a> to figure out which method implementation to
invoke. Dynamic dispatch is arguably <em>the</em> defining feature of object-oriented
languages. OCaml functions are not methods, and they do not use dynamic
dispatch.</p>
</div>
</section>
<section id="include-vs-open">
<h2><span class="section-number">5.8.3. </span>Include vs. Open<a class="headerlink" href="#include-vs-open" title="Permalink to this heading">#</a></h2>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/P1-gLiagAK4" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>The <code class="docutils literal notranslate"><span class="pre">include</span></code> and <code class="docutils literal notranslate"><span class="pre">open</span></code> statements are quite similar, but they have
a subtly different effect on a structure.  Consider this code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="nc">M</span> <span class="o">=</span> <span class="k">struct</span>
  <span class="k">let</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">end</span>

<span class="k">module</span> <span class="nc">N</span> <span class="o">=</span> <span class="k">struct</span>
  <span class="k">include</span> <span class="nc">M</span>
  <span class="k">let</span> <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>
<span class="k">end</span>

<span class="k">module</span> <span class="nc">O</span> <span class="o">=</span> <span class="k">struct</span>
  <span class="k">open</span> <span class="nc">M</span>
  <span class="k">let</span> <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>module M : sig val x : int end
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>module N : sig val x : int val y : int end
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>module O : sig val y : int end
</pre></div>
</div>
</div>
</div>
<p>Look closely at the values contained in each structure. <code class="docutils literal notranslate"><span class="pre">N</span></code> has both an <code class="docutils literal notranslate"><span class="pre">x</span></code> and
<code class="docutils literal notranslate"><span class="pre">y</span></code>, whereas <code class="docutils literal notranslate"><span class="pre">O</span></code> has only a <code class="docutils literal notranslate"><span class="pre">y</span></code>. The reason is that <code class="docutils literal notranslate"><span class="pre">include</span> <span class="pre">M</span></code> causes all the
definitions of <code class="docutils literal notranslate"><span class="pre">M</span></code> to also be included in <code class="docutils literal notranslate"><span class="pre">N</span></code>, so the definition of <code class="docutils literal notranslate"><span class="pre">x</span></code> from <code class="docutils literal notranslate"><span class="pre">M</span></code>
is present in <code class="docutils literal notranslate"><span class="pre">N</span></code>. But <code class="docutils literal notranslate"><span class="pre">open</span> <span class="pre">M</span></code> only made those definitions available in the
<em>scope</em> of <code class="docutils literal notranslate"><span class="pre">O</span></code>; it doesn’t actually make them part of the <em>structure</em>. So <code class="docutils literal notranslate"><span class="pre">O</span></code>
does not contain a definition of <code class="docutils literal notranslate"><span class="pre">x</span></code>, even though <code class="docutils literal notranslate"><span class="pre">x</span></code> is in scope during the
evaluation of <code class="docutils literal notranslate"><span class="pre">O</span></code>’s definition of <code class="docutils literal notranslate"><span class="pre">y</span></code>.</p>
<p>A metaphor for understanding this difference might be: <code class="docutils literal notranslate"><span class="pre">open</span> <span class="pre">M</span></code> imports
definitions from <code class="docutils literal notranslate"><span class="pre">M</span></code> and makes them available for local consumption, but they
aren’t exported to the outside world. Whereas <code class="docutils literal notranslate"><span class="pre">include</span> <span class="pre">M</span></code> imports definitions
from <code class="docutils literal notranslate"><span class="pre">M</span></code>, makes them available for local consumption, and additionally exports
them to the outside world.</p>
</section>
<section id="including-code-in-multiple-modules">
<h2><span class="section-number">5.8.4. </span>Including Code in Multiple Modules<a class="headerlink" href="#including-code-in-multiple-modules" title="Permalink to this heading">#</a></h2>
<p>Recall that we also had an implementation of sets that made sure every element
of the underlying list was unique:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="nc">UniqListSet</span> <span class="o">:</span> <span class="nc">Set</span> <span class="o">=</span> <span class="k">struct</span>
  <span class="c">(** All values in the list must be unique. *)</span>
  <span class="k">type</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">=</span> <span class="k">&#39;</span><span class="n">a</span> <span class="kt">list</span>
  <span class="k">let</span> <span class="n">empty</span> <span class="o">=</span> <span class="bp">[]</span>
  <span class="k">let</span> <span class="n">mem</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">mem</span>
  <span class="k">let</span> <span class="n">add</span> <span class="n">x</span> <span class="n">s</span> <span class="o">=</span> <span class="k">if</span> <span class="n">mem</span> <span class="n">x</span> <span class="n">s</span> <span class="k">then</span> <span class="n">s</span> <span class="k">else</span> <span class="n">x</span> <span class="o">::</span> <span class="n">s</span>
  <span class="k">let</span> <span class="n">elements</span> <span class="o">=</span> <span class="nn">Fun</span><span class="p">.</span><span class="n">id</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>module UniqListSet : Set
</pre></div>
</div>
</div>
</div>
<p>Suppose we wanted to add <code class="docutils literal notranslate"><span class="pre">of_list</span></code> to that module too. One possibility would be to
copy and paste that function from <code class="docutils literal notranslate"><span class="pre">ListSet</span></code> into <code class="docutils literal notranslate"><span class="pre">UniqListSet</span></code>. But that’s poor
software engineering. So let’s rule that out right away as a non-solution.</p>
<p>Instead, suppose we try to define the function outside of either module:</p>
<div class="cell tag_raises-exception docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">of_list</span> <span class="n">lst</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">fold_right</span> <span class="n">add</span> <span class="n">lst</span> <span class="n">empty</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">File</span> <span class="s2">&quot;[13]&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="n">characters</span> <span class="mi">34</span><span class="o">-</span><span class="mi">37</span><span class="p">:</span>
<span class="mi">1</span> <span class="o">|</span> <span class="n">let</span> <span class="n">of_list</span> <span class="n">lst</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">fold_right</span> <span class="n">add</span> <span class="n">lst</span> <span class="n">empty</span>
                                      <span class="o">^^^</span>
<span class="ne">Error</span>: Unbound value add
</pre></div>
</div>
</div>
</div>
<p>The problem is we either need to choose which module’s <code class="docutils literal notranslate"><span class="pre">add</span></code> and <code class="docutils literal notranslate"><span class="pre">empty</span></code> we
want. But as soon as we do, the function becomes useful only with that one
module:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">of_list</span> <span class="n">lst</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">fold_right</span> <span class="nn">ListSet</span><span class="p">.</span><span class="n">add</span> <span class="n">lst</span> <span class="nn">ListSet</span><span class="p">.</span><span class="n">empty</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val of_list : &#39;a list -&gt; &#39;a ListSet.t = &lt;fun&gt;
</pre></div>
</div>
</div>
</div>
<p>We could make <code class="docutils literal notranslate"><span class="pre">add</span></code> and <code class="docutils literal notranslate"><span class="pre">empty</span></code> be parameters instead:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">of_list&#39;</span> <span class="n">add</span> <span class="n">empty</span> <span class="n">lst</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">fold_right</span> <span class="n">add</span> <span class="n">lst</span> <span class="n">empty</span>

<span class="k">let</span> <span class="n">of_list</span> <span class="n">lst</span> <span class="o">=</span> <span class="n">of_list&#39;</span> <span class="nn">ListSet</span><span class="p">.</span><span class="n">add</span> <span class="nn">ListSet</span><span class="p">.</span><span class="n">empty</span> <span class="n">lst</span>
<span class="k">let</span> <span class="n">of_list_uniq</span> <span class="n">lst</span> <span class="o">=</span> <span class="n">of_list&#39;</span> <span class="nn">UniqListSet</span><span class="p">.</span><span class="n">add</span> <span class="nn">UniqListSet</span><span class="p">.</span><span class="n">empty</span> <span class="n">lst</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val of_list&#39; : (&#39;a -&gt; &#39;b -&gt; &#39;b) -&gt; &#39;b -&gt; &#39;a list -&gt; &#39;b = &lt;fun&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val of_list : &#39;a list -&gt; &#39;a ListSet.t = &lt;fun&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val of_list_uniq : &#39;a list -&gt; &#39;a UniqListSet.t = &lt;fun&gt;
</pre></div>
</div>
</div>
</div>
<p>But this is annoying in a couple of ways. First, we have to remember which
function name to call, whereas all the other operations that are part of those
modules have the same name, regardless of which module they’re in. Second, the
<code class="docutils literal notranslate"><span class="pre">of_list</span></code> functions live outside either module, so clients who open one of the
modules won’t automatically get the ability to name those functions.</p>
<p>Let’s try to use includes to solve this problem. First, we write a module that
contains the parameterized implementation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="nc">SetOfList</span> <span class="o">=</span> <span class="k">struct</span>
  <span class="k">let</span> <span class="n">of_list&#39;</span> <span class="n">add</span> <span class="n">empty</span> <span class="n">lst</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">fold_right</span> <span class="n">add</span> <span class="n">lst</span> <span class="n">empty</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>module SetOfList :
  sig val of_list&#39; : (&#39;a -&gt; &#39;b -&gt; &#39;b) -&gt; &#39;b -&gt; &#39;a list -&gt; &#39;b end
</pre></div>
</div>
</div>
</div>
<p>Then we include that module to get the helper function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="nc">UniqListSetExtended</span> <span class="o">:</span> <span class="nc">SetExtended</span> <span class="o">=</span> <span class="k">struct</span>
  <span class="k">include</span> <span class="nc">UniqListSet</span>
  <span class="k">include</span> <span class="nc">SetOfList</span>
  <span class="k">let</span> <span class="n">of_list</span> <span class="n">lst</span> <span class="o">=</span> <span class="n">of_list&#39;</span> <span class="n">add</span> <span class="n">empty</span> <span class="n">lst</span>
<span class="k">end</span>

<span class="k">module</span> <span class="nc">ListSetExtended</span> <span class="o">:</span> <span class="nc">SetExtended</span> <span class="o">=</span> <span class="k">struct</span>
  <span class="k">include</span> <span class="nc">ListSet</span>
  <span class="k">include</span> <span class="nc">SetOfList</span>
  <span class="k">let</span> <span class="n">of_list</span> <span class="n">lst</span> <span class="o">=</span> <span class="n">of_list&#39;</span> <span class="n">add</span> <span class="n">empty</span> <span class="n">lst</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>module UniqListSetExtended : SetExtended
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>module ListSetExtended : SetExtended
</pre></div>
</div>
</div>
</div>
<p>That works, but we’ve only partially succeeded in achieving code reuse:</p>
<ul class="simple">
<li><p>On the positive side, the code that implements <code class="docutils literal notranslate"><span class="pre">of_list'</span></code> has been factored
out into a single location and reused in the two structures.</p></li>
<li><p>But on the negative side, we still had to write an implementation of <code class="docutils literal notranslate"><span class="pre">of_list</span></code>
in both modules. Worse yet, those implementations are identical. So there’s
still code duplication occurring.</p></li>
</ul>
<p>Could we do better? Yes. And that leads us to functors, next.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "cs3110/textbook",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "ocaml-jupyter"
        },
        kernelOptions: {
            name: "ocaml-jupyter",
            path: "./chapters/modules"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ocaml-jupyter'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="module_type_constraints.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">5.7. </span>Module Type Constraints</p>
      </div>
    </a>
    <a class="right-next"
       href="functors.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">5.9. </span>Functors</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#semantics-of-includes">5.8.1. Semantics of Includes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#encapsulation-and-includes">5.8.2. Encapsulation and Includes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#include-vs-open">5.8.3. Include vs. Open</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#including-code-in-multiple-modules">5.8.4. Including Code in Multiple Modules</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Michael R. Clarkson et al.
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=bd9e20870c6007c4c509"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=bd9e20870c6007c4c509"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>