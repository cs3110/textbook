

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>4.4. Fold &#8212; OCaml Programming: Correct + Efficient + Beautiful</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=bd9e20870c6007c4c509" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=bd9e20870c6007c4c509" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=bd9e20870c6007c4c509"></script>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/hop/fold';</script>
    <link rel="shortcut icon" href="../../_static/op.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="4.5. Beyond Lists" href="beyond_lists.html" />
    <link rel="prev" title="4.3. Filter" href="filter.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <header>
  
    <div class="bd-header navbar navbar-expand-lg bd-navbar">
    </div>
  
  </header>

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../cover.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/op_title.png" class="logo__image only-light" alt="OCaml Programming: Correct + Efficient + Beautiful - Home"/>
    <script>document.write(`<img src="../../_static/op_title.png" class="logo__image only-dark" alt="OCaml Programming: Correct + Efficient + Beautiful - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Preface</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../preface/about.html">About This Book</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preface/install.html">Installing OCaml</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../intro/intro.html">1. Better Programming Through OCaml</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro/past.html">1.1. The Past of OCaml</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/present.html">1.2. The Present of OCaml</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/future.html">1.3. Look to Your Future</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/3110.html">1.4. A Brief History of CS 3110</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/summary.html">1.5. Summary</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../basics/intro.html">2. The Basics of OCaml</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../basics/toplevel.html">2.1. The OCaml Toplevel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/compiling.html">2.2. Compiling OCaml Programs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/expressions.html">2.3. Expressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/functions.html">2.4. Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/documentation.html">2.5. Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/printing.html">2.6. Printing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/debugging.html">2.7. Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/summary.html">2.8. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/exercises.html">2.9. Exercises</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">OCaml Programming</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../data/intro.html">3. Data and Types</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../data/lists.html">3.1. Lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/variants.html">3.2. Variants</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/ounit.html">3.3. Unit Testing with OUnit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/records_tuples.html">3.4. Records and Tuples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/pattern_matching_advanced.html">3.5. Advanced Pattern Matching</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/type_synonym.html">3.6. Type Synonyms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/options.html">3.7. Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/assoc_list.html">3.8. Association Lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/algebraic_data_types.html">3.9. Algebraic Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/exceptions.html">3.10. Exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/trees.html">3.11. Example: Trees</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/nats.html">3.12. Example: Natural Numbers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/summary.html">3.13. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/exercises.html">3.14. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="intro.html">4. Higher-Order Programming</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="higher_order.html">4.1. Higher-Order Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="map.html">4.2. Map</a></li>
<li class="toctree-l2"><a class="reference internal" href="filter.html">4.3. Filter</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">4.4. Fold</a></li>
<li class="toctree-l2"><a class="reference internal" href="beyond_lists.html">4.5. Beyond Lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="pipelining.html">4.6. Pipelining</a></li>
<li class="toctree-l2"><a class="reference internal" href="currying.html">4.7. Currying</a></li>
<li class="toctree-l2"><a class="reference internal" href="summary.html">4.8. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="exercises.html">4.9. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../modules/intro.html">5. Modular Programming</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/module_systems.html">5.1. Module Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/modules.html">5.2. Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/toplevel.html">5.3. Modules and the Toplevel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/encapsulation.html">5.4. Encapsulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/compilation_units.html">5.5. Compilation Units</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/functional_data_structures.html">5.6. Functional Data Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/module_type_constraints.html">5.7. Module Type Constraints</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/includes.html">5.8. Includes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/functors.html">5.9. Functors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/summary.html">5.10. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/exercises.html">5.11. Exercises</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Correctness and Efficiency</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../correctness/intro.html">6. Correctness</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../correctness/specifications.html">6.1. Specifications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/function_docs.html">6.2. Function Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/module_docs.html">6.3. Module Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/test_debug.html">6.4. Testing and Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/black_glass_box.html">6.5. Black-box and Glass-box Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/randomized.html">6.6. Randomized Testing with QCheck</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/proving_correctness.html">6.7. Proving Correctness</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/structural_induction.html">6.8. Structural Induction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/eq_spec.html">6.9. Equational Specification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/summary.html">6.10. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/exercises.html">6.11. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../mut/intro.html">7. Mutability</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../mut/refs.html">7.1. Refs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mut/mutable_fields.html">7.2. Mutable Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mut/arrays.html">7.3. Arrays and Loops</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mut/summary.html">7.4. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mut/exercises.html">7.5. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ds/intro.html">8. Data Structures</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ds/hash_tables.html">8.1. Hash Tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/amortized.html">8.2. Amortized Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/rb.html">8.3. Red-Black Trees</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/sequence.html">8.4. Sequences</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/memoization.html">8.5. Memoization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/parrays.html">8.6. Persistent Arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/promises.html">8.7. Promises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/monads.html">8.8. Monads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/summary.html">8.9. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/exercises.html">8.10. Exercises</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Language Implementation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../interp/intro.html">9. Interpreters</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../interp/calculator.html">9.1. Example: Calculator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/parsing.html">9.2. Parsing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/substitution.html">9.3. Substitution Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/environment.html">9.4. Environment Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/typecheck.html">9.5. Type Checking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/inference.html">9.6. Type Inference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/summary.html">9.7. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/exercises.html">9.8. Exercises</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Lagniappe</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../adv/curry-howard.html">The Curry-Howard Correspondence</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../appendix/bigoh.html">Big-Oh Notation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/vm.html">Virtual Machine</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/cs3110/textbook/main?urlpath=tree/src/chapters/hop/fold.md" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/cs3110/textbook" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/cs3110/textbook/edit/main/src/chapters/hop/fold.md" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/cs3110/textbook/issues/new?title=Issue%20on%20page%20%2Fchapters/hop/fold.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/chapters/hop/fold.ipynb" target="_blank"
   class="btn btn-sm btn-download-notebook-button dropdown-item"
   title="Download notebook file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li><a href="../../_sources/chapters/hop/fold.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Fold</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#combine">4.4.1. Combine</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fold-right">4.4.2. Fold Right</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tail-recursion-and-combine">4.4.3. Tail Recursion and Combine</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fold-left">4.4.4. Fold Left</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fold-left-vs-fold-right">4.4.5. Fold Left vs. Fold Right</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-digression-on-labeled-arguments-and-fold">4.4.6. A Digression on Labeled Arguments and Fold</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-fold-to-implement-other-functions">4.4.7. Using Fold to Implement Other Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fold-vs-recursive-vs-library">4.4.8. Fold vs. Recursive vs. Library</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="fold">
<h1><span class="section-number">4.4. </span>Fold<a class="headerlink" href="#fold" title="Permalink to this heading">#</a></h1>
<p>The map function gives us a way to individually transform each element of a
list. The filter function gives us a way to individually decide whether to
keep or throw away each element of a list. But both of those are really just
looking at a single element at a time. What if we wanted to somehow combine all
the elements of a list? That’s what the <em>fold</em> function is for. It turns out
that there are two versions of it, which we’ll study in this section. But to
start, let’s look at a related function—not actually in the standard
library—that we call <em>combine</em>.</p>
<section id="combine">
<h2><span class="section-number">4.4.1. </span>Combine<a class="headerlink" href="#combine" title="Permalink to this heading">#</a></h2>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/uYJVwW2BFPg" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>Once more, let’s write two functions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="c">(** [sum lst] is the sum of all the elements of [lst]. *)</span>
<span class="k">let</span> <span class="k">rec</span> <span class="n">sum</span> <span class="o">=</span> <span class="k">function</span>
  <span class="o">|</span> <span class="bp">[]</span> <span class="o">-&gt;</span> <span class="mi">0</span>
  <span class="o">|</span> <span class="n">h</span> <span class="o">::</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">h</span> <span class="o">+</span> <span class="n">sum</span> <span class="n">t</span>

<span class="k">let</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sum</span> <span class="o">[</span><span class="mi">1</span><span class="o">;</span> <span class="mi">2</span><span class="o">;</span> <span class="mi">3</span><span class="o">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val sum : int list -&gt; int = &lt;fun&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val s : int = 6
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="c">(** [concat lst] is the concatenation of all the elements of [lst]. *)</span>
<span class="k">let</span> <span class="k">rec</span> <span class="n">concat</span> <span class="o">=</span> <span class="k">function</span>
  <span class="o">|</span> <span class="bp">[]</span> <span class="o">-&gt;</span> <span class="s2">&quot;&quot;</span>
  <span class="o">|</span> <span class="n">h</span> <span class="o">::</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">h</span> <span class="o">^</span> <span class="n">concat</span> <span class="n">t</span>

<span class="k">let</span> <span class="n">c</span> <span class="o">=</span> <span class="n">concat</span> <span class="o">[</span><span class="s2">&quot;a&quot;</span><span class="o">;</span> <span class="s2">&quot;b&quot;</span><span class="o">;</span> <span class="s2">&quot;c&quot;</span><span class="o">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val concat : string list -&gt; string = &lt;fun&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val c : string = &quot;abc&quot;
</pre></div>
</div>
</div>
</div>
<p>As when we went through similar exercises with map and filter, the functions
share a great deal of common structure. The differences here are:</p>
<ul class="simple">
<li><p>the case for the empty list returns a different initial value, <code class="docutils literal notranslate"><span class="pre">0</span></code> vs <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code></p></li>
<li><p>the case of a non-empty list uses a different operator to combine the head
element with the result of the recursive call, <code class="docutils literal notranslate"><span class="pre">+</span></code> vs <code class="docutils literal notranslate"><span class="pre">^</span></code>.</p></li>
</ul>
<p>So can we apply the Abstraction Principle again? Sure! But this time we need to
factor out <em>two</em> arguments: one for each of those two differences.</p>
<p>To start, let’s factor out only the initial value:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="k">rec</span> <span class="n">sum&#39;</span> <span class="n">init</span> <span class="o">=</span> <span class="k">function</span>
  <span class="o">|</span> <span class="bp">[]</span> <span class="o">-&gt;</span> <span class="n">init</span>
  <span class="o">|</span> <span class="n">h</span> <span class="o">::</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">h</span> <span class="o">+</span> <span class="n">sum&#39;</span> <span class="n">init</span> <span class="n">t</span>

<span class="k">let</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">sum&#39;</span> <span class="mi">0</span>

<span class="k">let</span> <span class="k">rec</span> <span class="n">concat&#39;</span> <span class="n">init</span> <span class="o">=</span> <span class="k">function</span>
  <span class="o">|</span> <span class="bp">[]</span> <span class="o">-&gt;</span> <span class="n">init</span>
  <span class="o">|</span> <span class="n">h</span> <span class="o">::</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">h</span> <span class="o">^</span> <span class="n">concat&#39;</span> <span class="n">init</span> <span class="n">t</span>

<span class="k">let</span> <span class="n">concat</span> <span class="o">=</span> <span class="n">concat&#39;</span> <span class="s2">&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val sum&#39; : int -&gt; int list -&gt; int = &lt;fun&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val sum : int list -&gt; int = &lt;fun&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val concat&#39; : string -&gt; string list -&gt; string = &lt;fun&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val concat : string list -&gt; string = &lt;fun&gt;
</pre></div>
</div>
</div>
</div>
<p>Now the only real difference left between <code class="docutils literal notranslate"><span class="pre">sum'</span></code> and <code class="docutils literal notranslate"><span class="pre">concat'</span></code> is the operator
used to combine the head with the recursive call on the tail. That operator can
also become an argument to a unified function we call <code class="docutils literal notranslate"><span class="pre">combine</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="k">rec</span> <span class="n">combine</span> <span class="n">op</span> <span class="n">init</span> <span class="o">=</span> <span class="k">function</span>
  <span class="o">|</span> <span class="bp">[]</span> <span class="o">-&gt;</span> <span class="n">init</span>
  <span class="o">|</span> <span class="n">h</span> <span class="o">::</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">op</span> <span class="n">h</span> <span class="o">(</span><span class="n">combine</span> <span class="n">op</span> <span class="n">init</span> <span class="n">t</span><span class="o">)</span>

<span class="k">let</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">combine</span> <span class="o">(</span> <span class="o">+</span> <span class="o">)</span> <span class="mi">0</span>
<span class="k">let</span> <span class="n">concat</span> <span class="o">=</span> <span class="n">combine</span> <span class="o">(</span> <span class="o">^</span> <span class="o">)</span> <span class="s2">&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val combine : (&#39;a -&gt; &#39;b -&gt; &#39;b) -&gt; &#39;b -&gt; &#39;a list -&gt; &#39;b = &lt;fun&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val sum : int list -&gt; int = &lt;fun&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val concat : string list -&gt; string = &lt;fun&gt;
</pre></div>
</div>
</div>
</div>
<p>One way to think of <code class="docutils literal notranslate"><span class="pre">combine</span></code> would be that:</p>
<ul class="simple">
<li><p>the <code class="docutils literal notranslate"><span class="pre">[]</span></code> value in the list gets replaced by <code class="docutils literal notranslate"><span class="pre">init</span></code>, and</p></li>
<li><p>each <code class="docutils literal notranslate"><span class="pre">::</span></code> constructor gets replaced by <code class="docutils literal notranslate"><span class="pre">op</span></code>.</p></li>
</ul>
<p>For example, <code class="docutils literal notranslate"><span class="pre">[a;</span> <span class="pre">b;</span> <span class="pre">c]</span></code> is just syntactic sugar for <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">::</span> <span class="pre">(b</span> <span class="pre">::</span> <span class="pre">(c</span> <span class="pre">::</span> <span class="pre">[]))</span></code>. So
if we replace <code class="docutils literal notranslate"><span class="pre">[]</span></code> with <code class="docutils literal notranslate"><span class="pre">0</span></code> and <code class="docutils literal notranslate"><span class="pre">::</span></code> with <code class="docutils literal notranslate"><span class="pre">(+)</span></code>, we get <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">+</span> <span class="pre">(b</span> <span class="pre">+</span> <span class="pre">(c</span> <span class="pre">+</span> <span class="pre">0))</span></code>.
And that would be the sum of the list.</p>
<p>Once more, the Abstraction Principle has led us to an amazingly simple and
succinct expression of the computation.</p>
</section>
<section id="fold-right">
<h2><span class="section-number">4.4.2. </span>Fold Right<a class="headerlink" href="#fold-right" title="Permalink to this heading">#</a></h2>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/WKKkIGncRn8" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>The <code class="docutils literal notranslate"><span class="pre">combine</span></code> function is the idea underlying an actual OCaml library function.
To get there, we need to make a couple of changes to the implementation we have
so far.</p>
<p>First, let’s rename some of the arguments: we’ll change <code class="docutils literal notranslate"><span class="pre">op</span></code> to <code class="docutils literal notranslate"><span class="pre">f</span></code> to emphasize
that really we could pass in any function, not just a built-in operator like
<code class="docutils literal notranslate"><span class="pre">+</span></code>. And we’ll change <code class="docutils literal notranslate"><span class="pre">init</span></code> to <code class="docutils literal notranslate"><span class="pre">acc</span></code>, which as usual stands for “accumulator”.
That yields:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="k">rec</span> <span class="n">combine</span> <span class="n">f</span> <span class="n">acc</span> <span class="o">=</span> <span class="k">function</span>
  <span class="o">|</span> <span class="bp">[]</span> <span class="o">-&gt;</span> <span class="n">acc</span>
  <span class="o">|</span> <span class="n">h</span> <span class="o">::</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">f</span> <span class="n">h</span> <span class="o">(</span><span class="n">combine</span> <span class="n">f</span> <span class="n">acc</span> <span class="n">t</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val combine : (&#39;a -&gt; &#39;b -&gt; &#39;b) -&gt; &#39;b -&gt; &#39;a list -&gt; &#39;b = &lt;fun&gt;
</pre></div>
</div>
</div>
</div>
<p>Second, let’s make an admittedly less well-motivated change. We’ll swap the
implicit list argument to <code class="docutils literal notranslate"><span class="pre">combine</span></code> with the <code class="docutils literal notranslate"><span class="pre">init</span></code> argument:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="k">rec</span> <span class="n">combine&#39;</span> <span class="n">f</span> <span class="n">lst</span> <span class="n">acc</span> <span class="o">=</span> <span class="k">match</span> <span class="n">lst</span> <span class="k">with</span>
  <span class="o">|</span> <span class="bp">[]</span> <span class="o">-&gt;</span> <span class="n">acc</span>
  <span class="o">|</span> <span class="n">h</span> <span class="o">::</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">f</span> <span class="n">h</span> <span class="o">(</span><span class="n">combine&#39;</span> <span class="n">f</span> <span class="n">t</span> <span class="n">acc</span><span class="o">)</span>

<span class="k">let</span> <span class="n">sum</span> <span class="n">lst</span> <span class="o">=</span> <span class="n">combine&#39;</span> <span class="o">(</span> <span class="o">+</span> <span class="o">)</span> <span class="n">lst</span> <span class="mi">0</span>
<span class="k">let</span> <span class="n">concat</span> <span class="n">lst</span> <span class="o">=</span> <span class="n">combine&#39;</span> <span class="o">(</span> <span class="o">^</span> <span class="o">)</span> <span class="n">lst</span> <span class="s2">&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val combine&#39; : (&#39;a -&gt; &#39;b -&gt; &#39;b) -&gt; &#39;a list -&gt; &#39;b -&gt; &#39;b = &lt;fun&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val sum : int list -&gt; int = &lt;fun&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val concat : string list -&gt; string = &lt;fun&gt;
</pre></div>
</div>
</div>
</div>
<p>It’s a little less convenient to code the function this way, because we no
longer get to take advantage of the <code class="docutils literal notranslate"><span class="pre">function</span></code> keyword, nor of partial
application in defining <code class="docutils literal notranslate"><span class="pre">sum</span></code> and <code class="docutils literal notranslate"><span class="pre">concat</span></code>. But there’s no algorithmic change.</p>
<p>What we now have is the actual implementation of the standard library function
<code class="docutils literal notranslate"><span class="pre">List.fold_right</span></code>. All we have left to do is change the function name
and add a manual type annotation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="k">rec</span> <span class="n">fold_right</span> <span class="n">f</span> <span class="n">lst</span> <span class="o">(</span><span class="n">acc</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">acc</span><span class="o">)</span> <span class="o">=</span> <span class="k">match</span> <span class="n">lst</span> <span class="k">with</span>
  <span class="o">|</span> <span class="bp">[]</span> <span class="o">-&gt;</span> <span class="n">acc</span>
  <span class="o">|</span> <span class="n">h</span> <span class="o">::</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">f</span> <span class="n">h</span> <span class="o">(</span><span class="n">fold_right</span> <span class="n">f</span> <span class="n">t</span> <span class="n">acc</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val fold_right : (&#39;a -&gt; &#39;acc -&gt; &#39;acc) -&gt; &#39;a list -&gt; &#39;acc -&gt; &#39;acc = &lt;fun&gt;
</pre></div>
</div>
</div>
</div>
<p>Why is this function called “fold right”? The intuition is that the way it works
is to “fold in” elements of the list from the right to the left, combining each
new element using the operator. For example, <code class="docutils literal notranslate"><span class="pre">fold_right</span> <span class="pre">(</span> <span class="pre">+</span> <span class="pre">)</span> <span class="pre">[a;</span> <span class="pre">b;</span> <span class="pre">c]</span> <span class="pre">0</span></code>
results in evaluation of the expression <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">+</span> <span class="pre">(b</span> <span class="pre">+</span> <span class="pre">(c</span> <span class="pre">+</span> <span class="pre">0))</span></code>. The parentheses
associate from the right-most subexpression to the left.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The manual type annotation is not necessary for a correct implementation of the function.
Its purpose is to provide a nicer type.
Without the annotation, the inferred type of <code class="docutils literal notranslate"><span class="pre">fold_right</span></code> would be <code class="docutils literal notranslate"><span class="pre">('a</span> <span class="pre">-&gt;</span> <span class="pre">'b</span> <span class="pre">-&gt;</span> <span class="pre">'b)</span> <span class="pre">-&gt;</span> <span class="pre">'a</span> <span class="pre">list</span> <span class="pre">-&gt;</span> <span class="pre">'b</span> <span class="pre">-&gt;</span> <span class="pre">'b</span></code>, in which the compiler chooses <code class="docutils literal notranslate"><span class="pre">'b</span></code> as the type of the accumulator.
By manually annotating that argument with a self-descriptive name, we get the more readable type <code class="docutils literal notranslate"><span class="pre">('a</span> <span class="pre">-&gt;</span> <span class="pre">'acc</span> <span class="pre">-&gt;</span> <span class="pre">'acc)</span> <span class="pre">-&gt;</span> <span class="pre">'a</span> <span class="pre">list</span> <span class="pre">-&gt;</span> <span class="pre">'acc</span> <span class="pre">-&gt;</span> <span class="pre">'acc</span></code>.</p>
</div>
</section>
<section id="tail-recursion-and-combine">
<h2><span class="section-number">4.4.3. </span>Tail Recursion and Combine<a class="headerlink" href="#tail-recursion-and-combine" title="Permalink to this heading">#</a></h2>
<p>Neither <code class="docutils literal notranslate"><span class="pre">fold_right</span></code> nor <code class="docutils literal notranslate"><span class="pre">combine</span></code> are tail recursive: after the recursive call
returns, there is still work to be done in applying the function argument <code class="docutils literal notranslate"><span class="pre">f</span></code> or
<code class="docutils literal notranslate"><span class="pre">op</span></code>. Let’s go back to <code class="docutils literal notranslate"><span class="pre">combine</span></code> and rewrite it to be tail recursive. All that
requires is to change the cons branch:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="k">rec</span> <span class="n">combine_tr</span> <span class="n">f</span> <span class="n">acc</span> <span class="o">=</span> <span class="k">function</span>
  <span class="o">|</span> <span class="bp">[]</span> <span class="o">-&gt;</span> <span class="n">acc</span>
  <span class="o">|</span> <span class="n">h</span> <span class="o">::</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">combine_tr</span> <span class="n">f</span> <span class="o">(</span><span class="n">f</span> <span class="n">acc</span> <span class="n">h</span><span class="o">)</span> <span class="n">t</span>  <span class="c">(* only real change *)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val combine_tr : (&#39;a -&gt; &#39;b -&gt; &#39;a) -&gt; &#39;a -&gt; &#39;b list -&gt; &#39;a = &lt;fun&gt;
</pre></div>
</div>
</div>
</div>
<p>(Careful readers will notice that the type of <code class="docutils literal notranslate"><span class="pre">combine_tr</span></code> is different than the
type of <code class="docutils literal notranslate"><span class="pre">combine</span></code>. We will address that soon.)</p>
<p>Now the function <code class="docutils literal notranslate"><span class="pre">f</span></code> is applied to the head element <code class="docutils literal notranslate"><span class="pre">h</span></code> and the accumulator
<code class="docutils literal notranslate"><span class="pre">acc</span></code> <em>before</em> the recursive call is made, thus ensuring there’s no work
remaining to be done after the call returns.  If that seems a little mysterious,
here’s a rewriting of the two functions that might help:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="k">rec</span> <span class="n">combine</span> <span class="n">f</span> <span class="n">acc</span> <span class="o">=</span> <span class="k">function</span>
  <span class="o">|</span> <span class="bp">[]</span> <span class="o">-&gt;</span> <span class="n">acc</span>
  <span class="o">|</span> <span class="n">h</span> <span class="o">::</span> <span class="n">t</span> <span class="o">-&gt;</span>
    <span class="k">let</span> <span class="n">acc&#39;</span> <span class="o">=</span> <span class="n">combine</span> <span class="n">f</span> <span class="n">acc</span> <span class="n">t</span> <span class="k">in</span>
    <span class="n">f</span> <span class="n">h</span> <span class="n">acc&#39;</span>

<span class="k">let</span> <span class="k">rec</span> <span class="n">combine_tr</span> <span class="n">f</span> <span class="n">acc</span> <span class="o">=</span> <span class="k">function</span>
  <span class="o">|</span> <span class="bp">[]</span> <span class="o">-&gt;</span> <span class="n">acc</span>
  <span class="o">|</span> <span class="n">h</span> <span class="o">::</span> <span class="n">t</span> <span class="o">-&gt;</span>
    <span class="k">let</span> <span class="n">acc&#39;</span> <span class="o">=</span> <span class="n">f</span> <span class="n">acc</span> <span class="n">h</span> <span class="k">in</span>
    <span class="n">combine_tr</span> <span class="n">f</span> <span class="n">acc&#39;</span> <span class="n">t</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val combine : (&#39;a -&gt; &#39;b -&gt; &#39;b) -&gt; &#39;b -&gt; &#39;a list -&gt; &#39;b = &lt;fun&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val combine_tr : (&#39;a -&gt; &#39;b -&gt; &#39;a) -&gt; &#39;a -&gt; &#39;b list -&gt; &#39;a = &lt;fun&gt;
</pre></div>
</div>
</div>
</div>
<p>Pay close attention to the definition of <code class="docutils literal notranslate"><span class="pre">acc'</span></code>, the new accumulator, in each
of those versions:</p>
<ul class="simple">
<li><p>In the original version, we procrastinate using the head element <code class="docutils literal notranslate"><span class="pre">h</span></code>. First,
we combine all the remaining tail elements to get <code class="docutils literal notranslate"><span class="pre">acc'</span></code>. Only then do we use
<code class="docutils literal notranslate"><span class="pre">f</span></code> to fold in the head. So the value passed as the initial value of <code class="docutils literal notranslate"><span class="pre">acc</span></code>
turns out to be the same for every recursive invocation of <code class="docutils literal notranslate"><span class="pre">combine</span></code>: it’s
passed all the way down to where it’s needed, at the right-most element of the
list, then used there exactly once.</p></li>
<li><p>But in the tail recursive version, we “pre-crastinate” by immediately folding
<code class="docutils literal notranslate"><span class="pre">h</span></code> in with the old accumulator <code class="docutils literal notranslate"><span class="pre">acc</span></code>. Then we fold that in with all the tail
elements. So at each recursive invocation, the value passed as the argument
<code class="docutils literal notranslate"><span class="pre">acc</span></code> can be different.</p></li>
</ul>
<p>The tail recursive version of combine works just fine for summation (and
concatenation, which we elide):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">combine_tr</span> <span class="o">(</span> <span class="o">+</span> <span class="o">)</span> <span class="mi">0</span>
<span class="k">let</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sum</span> <span class="o">[</span><span class="mi">1</span><span class="o">;</span> <span class="mi">2</span><span class="o">;</span> <span class="mi">3</span><span class="o">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val sum : int list -&gt; int = &lt;fun&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val s : int = 6
</pre></div>
</div>
</div>
</div>
<p>But something possibly surprising happens with subtraction:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">sub</span> <span class="o">=</span> <span class="n">combine</span> <span class="o">(</span> <span class="o">-</span> <span class="o">)</span> <span class="mi">0</span>
<span class="k">let</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sub</span> <span class="o">[</span><span class="mi">3</span><span class="o">;</span> <span class="mi">2</span><span class="o">;</span> <span class="mi">1</span><span class="o">]</span>

<span class="k">let</span> <span class="n">sub_tr</span> <span class="o">=</span> <span class="n">combine_tr</span> <span class="o">(</span> <span class="o">-</span> <span class="o">)</span> <span class="mi">0</span>
<span class="k">let</span> <span class="n">s&#39;</span> <span class="o">=</span> <span class="n">sub_tr</span> <span class="o">[</span><span class="mi">3</span><span class="o">;</span> <span class="mi">2</span><span class="o">;</span> <span class="mi">1</span><span class="o">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val sub : int list -&gt; int = &lt;fun&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val s : int = 2
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val sub_tr : int list -&gt; int = &lt;fun&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val s&#39; : int = -6
</pre></div>
</div>
</div>
</div>
<p>The two results are different!</p>
<ul class="simple">
<li><p>With <code class="docutils literal notranslate"><span class="pre">combine</span></code> we compute <code class="docutils literal notranslate"><span class="pre">3</span> <span class="pre">-</span> <span class="pre">(2</span> <span class="pre">-</span> <span class="pre">(1</span> <span class="pre">-</span> <span class="pre">0))</span></code>. First we fold in <code class="docutils literal notranslate"><span class="pre">1</span></code>, then <code class="docutils literal notranslate"><span class="pre">2</span></code>,
then <code class="docutils literal notranslate"><span class="pre">3</span></code>. We are processing the list from right to left, putting the initial
accumulator at the far right.</p></li>
<li><p>But with <code class="docutils literal notranslate"><span class="pre">combine_tr</span></code> we compute <code class="docutils literal notranslate"><span class="pre">(((0</span> <span class="pre">-</span> <span class="pre">3)</span> <span class="pre">-</span> <span class="pre">2)</span> <span class="pre">-</span> <span class="pre">1)</span></code>. We are processing the
list from left to right, putting the initial accumulator at the far left.</p></li>
</ul>
<p>With addition it didn’t matter which order we processed the list, because
addition is associative and commutative. But subtraction is not, so the two
directions result in different answers.</p>
<p>Actually this shouldn’t be too surprising if we think back to when we made <code class="docutils literal notranslate"><span class="pre">map</span></code>
be tail recursive. Then, we discovered that tail recursion can cause us to
process the list in reverse order from the non-tail recursive version of the
same function. That’s what happened here.</p>
</section>
<section id="fold-left">
<h2><span class="section-number">4.4.4. </span>Fold Left<a class="headerlink" href="#fold-left" title="Permalink to this heading">#</a></h2>
<p>Our <code class="docutils literal notranslate"><span class="pre">combine_tr</span></code> function is also in the standard library under the name
<code class="docutils literal notranslate"><span class="pre">List.fold_left</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="k">rec</span> <span class="n">fold_left</span> <span class="n">f</span> <span class="o">(</span><span class="n">acc</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">acc</span><span class="o">)</span> <span class="o">=</span> <span class="k">function</span>
  <span class="o">|</span> <span class="bp">[]</span> <span class="o">-&gt;</span> <span class="n">acc</span>
  <span class="o">|</span> <span class="n">h</span> <span class="o">::</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">fold_left</span> <span class="n">f</span> <span class="o">(</span><span class="n">f</span> <span class="n">acc</span> <span class="n">h</span><span class="o">)</span> <span class="n">t</span>

<span class="k">let</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">fold_left</span> <span class="o">(</span> <span class="o">+</span> <span class="o">)</span> <span class="mi">0</span>
<span class="k">let</span> <span class="n">concat</span> <span class="o">=</span> <span class="n">fold_left</span> <span class="o">(</span> <span class="o">^</span> <span class="o">)</span> <span class="s2">&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val fold_left : (&#39;acc -&gt; &#39;a -&gt; &#39;acc) -&gt; &#39;acc -&gt; &#39;a list -&gt; &#39;acc = &lt;fun&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val sum : int list -&gt; int = &lt;fun&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val concat : string list -&gt; string = &lt;fun&gt;
</pre></div>
</div>
</div>
</div>
<p>We have once more succeeded in applying the Abstraction Principle.</p>
</section>
<section id="fold-left-vs-fold-right">
<h2><span class="section-number">4.4.5. </span>Fold Left vs. Fold Right<a class="headerlink" href="#fold-left-vs-fold-right" title="Permalink to this heading">#</a></h2>
<p>Let’s review the differences between <code class="docutils literal notranslate"><span class="pre">fold_right</span></code> and <code class="docutils literal notranslate"><span class="pre">fold_left</span></code>:</p>
<ul class="simple">
<li><p>They combine list elements in opposite orders, as indicated by their names.
Function <code class="docutils literal notranslate"><span class="pre">fold_right</span></code> combines from the right to the left, whereas <code class="docutils literal notranslate"><span class="pre">fold_left</span></code>
proceeds from the left to the right.</p></li>
<li><p>Function <code class="docutils literal notranslate"><span class="pre">fold_left</span></code> is tail recursive whereas <code class="docutils literal notranslate"><span class="pre">fold_right</span></code> is
not.</p></li>
<li><p>The types of the functions are different. In <code class="docutils literal notranslate"><span class="pre">fold_X</span></code> the accumulator argument goes to the <code class="docutils literal notranslate"><span class="pre">X</span></code> of the list argument. That is a choice made by the standard library rather than a necessary implementation difference.</p></li>
</ul>
<p>If you find it hard to keep track of the argument orders, the
<a class="reference external" href="https://ocaml.org/api/ListLabels.html"><code class="docutils literal notranslate"><span class="pre">ListLabels</span></code> module</a> in the standard library can help. It uses
labeled arguments to give names to the combining operator (which it calls <code class="docutils literal notranslate"><span class="pre">f</span></code>)
and the initial accumulator value (which it calls <code class="docutils literal notranslate"><span class="pre">init</span></code>). Internally, the
implementation is actually identical to the <code class="docutils literal notranslate"><span class="pre">List</span></code> module.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="nn">ListLabels</span><span class="p">.</span><span class="n">fold_left</span> <span class="o">~</span><span class="n">f</span><span class="o">:(</span><span class="k">fun</span> <span class="n">x</span> <span class="n">y</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="o">)</span> <span class="o">~</span><span class="n">init</span><span class="o">:</span><span class="mi">0</span> <span class="o">[</span><span class="mi">1</span><span class="o">;</span> <span class="mi">2</span><span class="o">;</span> <span class="mi">3</span><span class="o">];;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>- : int = -6
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="nn">ListLabels</span><span class="p">.</span><span class="n">fold_right</span> <span class="o">~</span><span class="n">f</span><span class="o">:(</span><span class="k">fun</span> <span class="n">y</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="o">)</span> <span class="o">~</span><span class="n">init</span><span class="o">:</span><span class="mi">0</span> <span class="o">[</span><span class="mi">1</span><span class="o">;</span> <span class="mi">2</span><span class="o">;</span> <span class="mi">3</span><span class="o">];;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>- : int = -6
</pre></div>
</div>
</div>
</div>
<p>Notice how in the two applications of fold above, we are able to write the
arguments in a uniform order thanks to their labels. However, we still have to
be careful about which argument to the combining operator is the list element
vs. the accumulator value.</p>
</section>
<section id="a-digression-on-labeled-arguments-and-fold">
<h2><span class="section-number">4.4.6. </span>A Digression on Labeled Arguments and Fold<a class="headerlink" href="#a-digression-on-labeled-arguments-and-fold" title="Permalink to this heading">#</a></h2>
<p>It’s possible to write our own version of the fold functions that would label
the arguments to the combining operator, so we don’t even have to remember their
order:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="k">rec</span> <span class="n">fold_left</span> <span class="o">~</span><span class="n">op</span><span class="o">:(</span><span class="n">f</span><span class="o">:</span> <span class="n">acc</span><span class="o">:</span><span class="k">&#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="n">elt</span><span class="o">:</span><span class="k">&#39;</span><span class="n">b</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span><span class="o">)</span> <span class="o">~</span><span class="n">init</span><span class="o">:</span><span class="n">acc</span> <span class="n">lst</span> <span class="o">=</span>
  <span class="k">match</span> <span class="n">lst</span> <span class="k">with</span>
  <span class="o">|</span> <span class="bp">[]</span> <span class="o">-&gt;</span> <span class="n">acc</span>
  <span class="o">|</span> <span class="n">h</span> <span class="o">::</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">fold_left</span> <span class="o">~</span><span class="n">op</span><span class="o">:</span><span class="n">f</span> <span class="o">~</span><span class="n">init</span><span class="o">:(</span><span class="n">f</span> <span class="o">~</span><span class="n">acc</span><span class="o">:</span><span class="n">acc</span> <span class="o">~</span><span class="n">elt</span><span class="o">:</span><span class="n">h</span><span class="o">)</span> <span class="n">t</span>

<span class="k">let</span> <span class="k">rec</span> <span class="n">fold_right</span> <span class="o">~</span><span class="n">op</span><span class="o">:(</span><span class="n">f</span><span class="o">:</span> <span class="n">elt</span><span class="o">:</span><span class="k">&#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="n">acc</span><span class="o">:</span><span class="k">&#39;</span><span class="n">b</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">b</span><span class="o">)</span> <span class="n">lst</span> <span class="o">~</span><span class="n">init</span><span class="o">:</span><span class="n">acc</span> <span class="o">=</span>
  <span class="k">match</span> <span class="n">lst</span> <span class="k">with</span>
  <span class="o">|</span> <span class="bp">[]</span> <span class="o">-&gt;</span> <span class="n">acc</span>
  <span class="o">|</span> <span class="n">h</span> <span class="o">::</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">f</span> <span class="o">~</span><span class="n">elt</span><span class="o">:</span><span class="n">h</span> <span class="o">~</span><span class="n">acc</span><span class="o">:(</span><span class="n">fold_right</span> <span class="o">~</span><span class="n">op</span><span class="o">:</span><span class="n">f</span> <span class="n">t</span> <span class="o">~</span><span class="n">init</span><span class="o">:</span><span class="n">acc</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val fold_left : op:(acc:&#39;a -&gt; elt:&#39;b -&gt; &#39;a) -&gt; init:&#39;a -&gt; &#39;b list -&gt; &#39;a =
  &lt;fun&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val fold_right : op:(elt:&#39;a -&gt; acc:&#39;b -&gt; &#39;b) -&gt; &#39;a list -&gt; init:&#39;b -&gt; &#39;b =
  &lt;fun&gt;
</pre></div>
</div>
</div>
</div>
<p>But those functions aren’t as useful as they might seem:</p>
<div class="cell tag_raises-exception docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">s</span> <span class="o">=</span> <span class="n">fold_left</span> <span class="o">~</span><span class="n">op</span><span class="o">:(</span> <span class="o">+</span> <span class="o">)</span> <span class="o">~</span><span class="n">init</span><span class="o">:</span><span class="mi">0</span> <span class="o">[</span><span class="mi">1</span><span class="o">;</span><span class="mi">2</span><span class="o">;</span><span class="mi">3</span><span class="o">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">File</span> <span class="s2">&quot;[16]&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="n">characters</span> <span class="mi">22</span><span class="o">-</span><span class="mi">27</span><span class="p">:</span>
<span class="mi">1</span> <span class="o">|</span> <span class="n">let</span> <span class="n">s</span> <span class="o">=</span> <span class="n">fold_left</span> <span class="o">~</span><span class="n">op</span><span class="p">:(</span> <span class="o">+</span> <span class="p">)</span> <span class="o">~</span><span class="n">init</span><span class="p">:</span><span class="mi">0</span> <span class="p">[</span><span class="mi">1</span><span class="p">;</span><span class="mi">2</span><span class="p">;</span><span class="mi">3</span><span class="p">]</span>
                          <span class="o">^^^^^</span>
<span class="ne">Error</span>: This expression has type int -&gt; int -&gt; int
       <span class="n">but</span> <span class="n">an</span> <span class="n">expression</span> <span class="n">was</span> <span class="n">expected</span> <span class="n">of</span> <span class="nb">type</span> <span class="n">acc</span><span class="p">:</span><span class="s1">&#39;a -&gt; elt:&#39;</span><span class="n">b</span> <span class="o">-&gt;</span> <span class="s1">&#39;a</span>
</pre></div>
</div>
</div>
</div>
<p>The problem is that the built-in <code class="docutils literal notranslate"><span class="pre">+</span></code> operator doesn’t have labeled arguments,
so we can’t pass it in as the combining operator to our labeled functions.
We’d have to define our own labeled version of it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">let</span> <span class="n">add</span> <span class="o">~</span><span class="n">acc</span> <span class="o">~</span><span class="n">elt</span> <span class="o">=</span> <span class="n">acc</span> <span class="o">+</span> <span class="n">elt</span>
<span class="n">let</span> <span class="n">s</span> <span class="o">=</span> <span class="n">fold_left</span> <span class="o">~</span><span class="n">op</span><span class="p">:</span><span class="n">add</span> <span class="o">~</span><span class="n">init</span><span class="p">:</span><span class="mi">0</span> <span class="p">[</span><span class="mi">1</span><span class="p">;</span> <span class="mi">2</span><span class="p">;</span> <span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
<p>But now we have to remember that the <code class="docutils literal notranslate"><span class="pre">~acc</span></code> parameter to <code class="docutils literal notranslate"><span class="pre">add</span></code> will become
the left-hand argument to <code class="docutils literal notranslate"><span class="pre">(</span> <span class="pre">+</span> <span class="pre">)</span></code>.  That’s not really much of an improvement
over what we had to remember to begin with.</p>
</section>
<section id="using-fold-to-implement-other-functions">
<h2><span class="section-number">4.4.7. </span>Using Fold to Implement Other Functions<a class="headerlink" href="#using-fold-to-implement-other-functions" title="Permalink to this heading">#</a></h2>
<p>Folding is so powerful that we can write many other list functions in terms of
<code class="docutils literal notranslate"><span class="pre">fold_left</span></code> or <code class="docutils literal notranslate"><span class="pre">fold_right</span></code>. For example,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">length</span> <span class="n">lst</span> <span class="o">=</span>
  <span class="nn">List</span><span class="p">.</span><span class="n">fold_left</span> <span class="o">(</span><span class="k">fun</span> <span class="n">acc</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">acc</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span> <span class="mi">0</span> <span class="n">lst</span>

<span class="k">let</span> <span class="n">rev</span> <span class="n">lst</span> <span class="o">=</span>
  <span class="nn">List</span><span class="p">.</span><span class="n">fold_left</span> <span class="o">(</span><span class="k">fun</span> <span class="n">acc</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">::</span> <span class="n">acc</span><span class="o">)</span> <span class="bp">[]</span> <span class="n">lst</span>

<span class="k">let</span> <span class="n">map</span> <span class="n">f</span> <span class="n">lst</span> <span class="o">=</span>
  <span class="nn">List</span><span class="p">.</span><span class="n">fold_right</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="n">acc</span> <span class="o">-&gt;</span> <span class="n">f</span> <span class="n">x</span> <span class="o">::</span> <span class="n">acc</span><span class="o">)</span> <span class="n">lst</span> <span class="bp">[]</span>

<span class="k">let</span> <span class="n">filter</span> <span class="n">f</span> <span class="n">lst</span> <span class="o">=</span>
  <span class="nn">List</span><span class="p">.</span><span class="n">fold_right</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="n">acc</span> <span class="o">-&gt;</span> <span class="k">if</span> <span class="n">f</span> <span class="n">x</span> <span class="k">then</span> <span class="n">x</span> <span class="o">::</span> <span class="n">acc</span> <span class="k">else</span> <span class="n">acc</span><span class="o">)</span> <span class="n">lst</span> <span class="bp">[]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val length : &#39;a list -&gt; int = &lt;fun&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val rev : &#39;a list -&gt; &#39;a list = &lt;fun&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val map : (&#39;a -&gt; &#39;b) -&gt; &#39;a list -&gt; &#39;b list = &lt;fun&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val filter : (&#39;a -&gt; bool) -&gt; &#39;a list -&gt; &#39;a list = &lt;fun&gt;
</pre></div>
</div>
</div>
</div>
<p>At this point it begins to become debatable whether it’s better to express the
computations above using folding or using the ways we have already seen. Even
for an experienced functional programmer, understanding what a fold does can
take longer than reading the naive recursive implementation. If you peruse the
<a class="reference external" href="https://github.com/ocaml/ocaml/blob/trunk/stdlib/list.ml">source code of the standard library</a>, you’ll see that none of the
<code class="docutils literal notranslate"><span class="pre">List</span></code> module internally is implemented in terms of folding, which is perhaps
one comment on the readability of fold. On the other hand, using fold ensures
that the programmer doesn’t accidentally program the recursive traversal
incorrectly. And for a data structure that’s more complicated than lists, that
robustness might be a win.</p>
</section>
<section id="fold-vs-recursive-vs-library">
<h2><span class="section-number">4.4.8. </span>Fold vs. Recursive vs. Library<a class="headerlink" href="#fold-vs-recursive-vs-library" title="Permalink to this heading">#</a></h2>
<p>We’ve now seen three different ways for writing functions that manipulate lists:</p>
<ul class="simple">
<li><p>directly as a recursive function that pattern matches against the empty list
and against cons,</p></li>
<li><p>using <code class="docutils literal notranslate"><span class="pre">fold</span></code> functions, and</p></li>
<li><p>using other library functions.</p></li>
</ul>
<p>Let’s try using each of those ways to solve a problem, so that we can appreciate
them better.</p>
<p>Consider writing a function <code class="docutils literal notranslate"><span class="pre">lst_and:</span> <span class="pre">bool</span> <span class="pre">list</span> <span class="pre">-&gt;</span> <span class="pre">bool</span></code>, such that
<code class="docutils literal notranslate"><span class="pre">lst_and</span> <span class="pre">[a1;</span> <span class="pre">...;</span> <span class="pre">an]</span></code> returns whether all elements of the list are <code class="docutils literal notranslate"><span class="pre">true</span></code>.
That is, it evaluates the same as <code class="docutils literal notranslate"><span class="pre">a1</span> <span class="pre">&amp;&amp;</span> <span class="pre">a2</span> <span class="pre">&amp;&amp;</span> <span class="pre">...</span> <span class="pre">&amp;&amp;</span> <span class="pre">an</span></code>. When applied to an
empty list, it evaluates to <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p>
<p>Here are three possible ways of writing such a function. We give each way a
slightly different function name for clarity.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="k">rec</span> <span class="n">lst_and_rec</span> <span class="o">=</span> <span class="k">function</span>
  <span class="o">|</span> <span class="bp">[]</span> <span class="o">-&gt;</span> <span class="bp">true</span>
  <span class="o">|</span> <span class="n">h</span> <span class="o">::</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">h</span> <span class="o">&amp;&amp;</span> <span class="n">lst_and_rec</span> <span class="n">t</span>

<span class="k">let</span> <span class="n">lst_and_fold</span> <span class="o">=</span>
	<span class="nn">List</span><span class="p">.</span><span class="n">fold_left</span> <span class="o">(</span><span class="k">fun</span> <span class="n">acc</span> <span class="n">elt</span> <span class="o">-&gt;</span> <span class="n">acc</span> <span class="o">&amp;&amp;</span> <span class="n">elt</span><span class="o">)</span> <span class="bp">true</span>

<span class="k">let</span> <span class="n">lst_and_lib</span> <span class="o">=</span>
	<span class="nn">List</span><span class="p">.</span><span class="n">for_all</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val lst_and_rec : bool list -&gt; bool = &lt;fun&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val lst_and_fold : bool list -&gt; bool = &lt;fun&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val lst_and_lib : bool list -&gt; bool = &lt;fun&gt;
</pre></div>
</div>
</div>
</div>
<p>The worst-case running time of all three functions is linear in the length of
the list. But:</p>
<ul class="simple">
<li><p>The first function, <code class="docutils literal notranslate"><span class="pre">lst_and_rec</span></code> has the advantage that it need not process
the entire list. It will immediately return <code class="docutils literal notranslate"><span class="pre">false</span></code> the first time they
discover a <code class="docutils literal notranslate"><span class="pre">false</span></code> element in the list.</p></li>
<li><p>The second function, <code class="docutils literal notranslate"><span class="pre">lst_and_fold</span></code>, will always process every element of the
list.</p></li>
<li><p>As for the third function <code class="docutils literal notranslate"><span class="pre">lst_and_lib</span></code>, according to the documentation of
<code class="docutils literal notranslate"><span class="pre">List.for_all</span></code>, it returns <code class="docutils literal notranslate"><span class="pre">(p</span> <span class="pre">a1)</span> <span class="pre">&amp;&amp;</span> <span class="pre">(p</span> <span class="pre">a2)</span> <span class="pre">&amp;&amp;</span> <span class="pre">...</span> <span class="pre">&amp;&amp;</span> <span class="pre">(p</span> <span class="pre">an)</span></code>. So like
<code class="docutils literal notranslate"><span class="pre">lst_and_rec</span></code> it need not process every element.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "cs3110/textbook",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "ocaml-jupyter"
        },
        kernelOptions: {
            name: "ocaml-jupyter",
            path: "./chapters/hop"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ocaml-jupyter'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="filter.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">4.3. </span>Filter</p>
      </div>
    </a>
    <a class="right-next"
       href="beyond_lists.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">4.5. </span>Beyond Lists</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#combine">4.4.1. Combine</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fold-right">4.4.2. Fold Right</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tail-recursion-and-combine">4.4.3. Tail Recursion and Combine</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fold-left">4.4.4. Fold Left</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fold-left-vs-fold-right">4.4.5. Fold Left vs. Fold Right</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-digression-on-labeled-arguments-and-fold">4.4.6. A Digression on Labeled Arguments and Fold</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-fold-to-implement-other-functions">4.4.7. Using Fold to Implement Other Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fold-vs-recursive-vs-library">4.4.8. Fold vs. Recursive vs. Library</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Michael R. Clarkson et al.
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=bd9e20870c6007c4c509"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=bd9e20870c6007c4c509"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>