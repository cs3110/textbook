

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>3.3. Unit Testing with OUnit &#8212; OCaml Programming: Correct + Efficient + Beautiful</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=bd9e20870c6007c4c509" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=bd9e20870c6007c4c509" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=bd9e20870c6007c4c509"></script>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/data/ounit';</script>
    <link rel="shortcut icon" href="../../_static/op.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="3.4. Records and Tuples" href="records_tuples.html" />
    <link rel="prev" title="3.2. Variants" href="variants.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <header>
  
    <div class="bd-header navbar navbar-expand-lg bd-navbar">
    </div>
  
  </header>

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../cover.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/op_title.png" class="logo__image only-light" alt="OCaml Programming: Correct + Efficient + Beautiful - Home"/>
    <script>document.write(`<img src="../../_static/op_title.png" class="logo__image only-dark" alt="OCaml Programming: Correct + Efficient + Beautiful - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Preface</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../preface/about.html">About This Book</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preface/install.html">Installing OCaml</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../intro/intro.html">1. Better Programming Through OCaml</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro/past.html">1.1. The Past of OCaml</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/present.html">1.2. The Present of OCaml</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/future.html">1.3. Look to Your Future</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/3110.html">1.4. A Brief History of CS 3110</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/summary.html">1.5. Summary</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../basics/intro.html">2. The Basics of OCaml</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../basics/toplevel.html">2.1. The OCaml Toplevel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/compiling.html">2.2. Compiling OCaml Programs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/expressions.html">2.3. Expressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/functions.html">2.4. Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/documentation.html">2.5. Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/printing.html">2.6. Printing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/debugging.html">2.7. Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/summary.html">2.8. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/exercises.html">2.9. Exercises</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">OCaml Programming</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="intro.html">3. Data and Types</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="lists.html">3.1. Lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="variants.html">3.2. Variants</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">3.3. Unit Testing with OUnit</a></li>
<li class="toctree-l2"><a class="reference internal" href="records_tuples.html">3.4. Records and Tuples</a></li>
<li class="toctree-l2"><a class="reference internal" href="pattern_matching_advanced.html">3.5. Advanced Pattern Matching</a></li>
<li class="toctree-l2"><a class="reference internal" href="type_synonym.html">3.6. Type Synonyms</a></li>
<li class="toctree-l2"><a class="reference internal" href="options.html">3.7. Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="assoc_list.html">3.8. Association Lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="algebraic_data_types.html">3.9. Algebraic Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="exceptions.html">3.10. Exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="trees.html">3.11. Example: Trees</a></li>
<li class="toctree-l2"><a class="reference internal" href="nats.html">3.12. Example: Natural Numbers</a></li>
<li class="toctree-l2"><a class="reference internal" href="summary.html">3.13. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="exercises.html">3.14. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../hop/intro.html">4. Higher-Order Programming</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../hop/higher_order.html">4.1. Higher-Order Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/map.html">4.2. Map</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/filter.html">4.3. Filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/fold.html">4.4. Fold</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/beyond_lists.html">4.5. Beyond Lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/pipelining.html">4.6. Pipelining</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/currying.html">4.7. Currying</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/summary.html">4.8. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/exercises.html">4.9. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../modules/intro.html">5. Modular Programming</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/module_systems.html">5.1. Module Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/modules.html">5.2. Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/toplevel.html">5.3. Modules and the Toplevel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/encapsulation.html">5.4. Encapsulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/compilation_units.html">5.5. Compilation Units</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/functional_data_structures.html">5.6. Functional Data Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/module_type_constraints.html">5.7. Module Type Constraints</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/includes.html">5.8. Includes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/functors.html">5.9. Functors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/summary.html">5.10. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/exercises.html">5.11. Exercises</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Correctness and Efficiency</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../correctness/intro.html">6. Correctness</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../correctness/specifications.html">6.1. Specifications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/function_docs.html">6.2. Function Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/module_docs.html">6.3. Module Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/test_debug.html">6.4. Testing and Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/black_glass_box.html">6.5. Black-box and Glass-box Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/randomized.html">6.6. Randomized Testing with QCheck</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/proving_correctness.html">6.7. Proving Correctness</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/structural_induction.html">6.8. Structural Induction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/eq_spec.html">6.9. Equational Specification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/summary.html">6.10. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/exercises.html">6.11. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../mut/intro.html">7. Mutability</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../mut/refs.html">7.1. Refs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mut/mutable_fields.html">7.2. Mutable Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mut/arrays.html">7.3. Arrays and Loops</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mut/summary.html">7.4. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mut/exercises.html">7.5. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ds/intro.html">8. Data Structures</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ds/hash_tables.html">8.1. Hash Tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/amortized.html">8.2. Amortized Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/rb.html">8.3. Red-Black Trees</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/sequence.html">8.4. Sequences</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/memoization.html">8.5. Memoization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/parrays.html">8.6. Persistent Arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/promises.html">8.7. Promises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/monads.html">8.8. Monads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/summary.html">8.9. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/exercises.html">8.10. Exercises</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Language Implementation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../interp/intro.html">9. Interpreters</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../interp/calculator.html">9.1. Example: Calculator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/parsing.html">9.2. Parsing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/substitution.html">9.3. Substitution Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/environment.html">9.4. Environment Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/typecheck.html">9.5. Type Checking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/inference.html">9.6. Type Inference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/summary.html">9.7. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/exercises.html">9.8. Exercises</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Lagniappe</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../adv/curry-howard.html">The Curry-Howard Correspondence</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../appendix/bigoh.html">Big-Oh Notation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/vm.html">Virtual Machine</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/cs3110/textbook" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/cs3110/textbook/edit/main/src/chapters/data/ounit.md" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/cs3110/textbook/issues/new?title=Issue%20on%20page%20%2Fchapters/data/ounit.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/chapters/data/ounit.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Unit Testing with OUnit</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#an-example-of-ounit">3.3.1. An Example of OUnit</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#explanation-of-the-ounit-example">3.3.2. Explanation of the OUnit Example</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#improving-ounit-output">3.3.3. Improving OUnit Output</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-for-exceptions">3.3.4. Testing for Exceptions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-driven-development">3.3.5. Test-Driven Development</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="unit-testing-with-ounit">
<h1><span class="section-number">3.3. </span>Unit Testing with OUnit<a class="headerlink" href="#unit-testing-with-ounit" title="Permalink to this heading">#</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This section is a bit of a detour from our study of data types, but it’s a good
place to take the detour: we now know just enough to understand how unit testing
can be done in OCaml, and there’s no good reason to wait any longer to learn
about it.</p>
</div>
<p>Using the toplevel to test functions will only work for very small programs.
Larger programs need <em>test suites</em> that contain many <em>unit tests</em> and can be
re-run every time we update our code base. A unit test is a test of one small
piece of functionality in a program, such as an individual function.</p>
<p>We’ve now learned enough features of OCaml to see how to do unit testing with a
library called OUnit. It is a unit testing framework similar to JUnit in Java,
HUnit in Haskell, etc. The basic workflow for using OUnit is as follows:</p>
<ul class="simple">
<li><p>Write a function in a file <code class="docutils literal notranslate"><span class="pre">f.ml</span></code>. There could be many other functions in that
file too.</p></li>
<li><p>Write unit tests for that function in a separate file <code class="docutils literal notranslate"><span class="pre">test.ml</span></code>. That exact
name is not actually essential.</p></li>
<li><p>Build and run <code class="docutils literal notranslate"><span class="pre">test</span></code> to execute the unit tests.</p></li>
</ul>
<p>The <a class="reference external" href="https://gildor478.github.io/ounit/ounit2/index.html">OUnit documentation</a> is available on GitHub.</p>
<section id="an-example-of-ounit">
<h2><span class="section-number">3.3.1. </span>An Example of OUnit<a class="headerlink" href="#an-example-of-ounit" title="Permalink to this heading">#</a></h2>
<p>The following example shows you how to create an OUnit test suite. There are
some things in the example that might at first seem mysterious; they are
discussed in the next section.</p>
<p>Create a new directory. In that directory, create a file named <code class="docutils literal notranslate"><span class="pre">sum.ml</span></code>, and put
the following code into it:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="k">rec</span> <span class="n">sum</span> <span class="o">=</span> <span class="k">function</span>
  <span class="o">|</span> <span class="bp">[]</span> <span class="o">-&gt;</span> <span class="mi">0</span>
  <span class="o">|</span> <span class="n">x</span> <span class="o">::</span> <span class="n">xs</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">+</span> <span class="n">sum</span> <span class="n">xs</span>
</pre></div>
</div>
<p>Now create a second file named <code class="docutils literal notranslate"><span class="pre">test.ml</span></code>, and put this code into it:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">open</span> <span class="nc">OUnit2</span>
<span class="k">open</span> <span class="nc">Sum</span>

<span class="k">let</span> <span class="n">tests</span> <span class="o">=</span> <span class="s2">&quot;test suite for sum&quot;</span> <span class="o">&gt;:::</span> <span class="o">[</span>
  <span class="s2">&quot;empty&quot;</span> <span class="o">&gt;::</span> <span class="o">(</span><span class="k">fun</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">assert_equal</span> <span class="mi">0</span> <span class="o">(</span><span class="n">sum</span> <span class="bp">[]</span><span class="o">));</span>
  <span class="s2">&quot;singleton&quot;</span> <span class="o">&gt;::</span> <span class="o">(</span><span class="k">fun</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">assert_equal</span> <span class="mi">1</span> <span class="o">(</span><span class="n">sum</span> <span class="o">[</span><span class="mi">1</span><span class="o">]));</span>
  <span class="s2">&quot;two_elements&quot;</span> <span class="o">&gt;::</span> <span class="o">(</span><span class="k">fun</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">assert_equal</span> <span class="mi">3</span> <span class="o">(</span><span class="n">sum</span> <span class="o">[</span><span class="mi">1</span><span class="o">;</span> <span class="mi">2</span><span class="o">]));</span>
<span class="o">]</span>

<span class="k">let</span> <span class="o">_</span> <span class="o">=</span> <span class="n">run_test_tt_main</span> <span class="n">tests</span>
</pre></div>
</div>
<p>Depending on your editor and its configuration, you probably now see some
“Unbound module” errors about OUnit2 and Sum. Don’t worry; the code is actually
correct. We just need to set up dune and tell it to link OUnit. Create a <code class="docutils literal notranslate"><span class="pre">dune</span></code>
file and put this in it:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>(executable
 (name test)
 (libraries ounit2))
</pre></div>
</div>
<p>And create a <code class="docutils literal notranslate"><span class="pre">dune-project</span></code> file as usual:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>(lang dune 3.4)
</pre></div>
</div>
<p>Now build the test suite:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>dune<span class="w"> </span>build<span class="w"> </span>test.exe
</pre></div>
</div>
<p>Go back to your editor and do anything that will cause it to revisit <code class="docutils literal notranslate"><span class="pre">test.ml</span></code>.
You can close and re-open the window, or make a trivial change in the file
(e.g., add then delete a space). Now the errors should all disappear.</p>
<p>Finally, you can run the test suite:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>dune<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>./test.exe
</pre></div>
</div>
<p>You will get a response something like this:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>...
Ran: 3 tests in: 0.12 seconds.
OK
</pre></div>
</div>
<p>Now suppose we modify <code class="docutils literal notranslate"><span class="pre">sum.ml</span></code> to introduce a bug by changing the code
in it to the following:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="k">rec</span> <span class="n">sum</span> <span class="o">=</span> <span class="k">function</span>
  <span class="o">|</span> <span class="bp">[]</span> <span class="o">-&gt;</span> <span class="mi">1</span> <span class="c">(* bug *)</span>
  <span class="o">|</span> <span class="n">x</span> <span class="o">::</span> <span class="n">xs</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">+</span> <span class="n">sum</span> <span class="n">xs</span>
</pre></div>
</div>
<p>If rebuild and re-execute the test suite, all test cases now fail. The output
tells us the names of the failing cases. Here’s the beginning of the output, in
which we’ve replaced some strings that will be dependent on your own local
computer with <code class="docutils literal notranslate"><span class="pre">...</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FFF</span>
<span class="o">==============================================================================</span>
<span class="n">Error</span><span class="p">:</span> <span class="n">test</span> <span class="n">suite</span> <span class="k">for</span> <span class="nb">sum</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="n">two_elements</span><span class="o">.</span>

<span class="n">File</span> <span class="s2">&quot;.../_build/oUnit-test suite for sum-...#01.log&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">9</span><span class="p">,</span> <span class="n">characters</span> <span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
<span class="n">Error</span><span class="p">:</span> <span class="n">test</span> <span class="n">suite</span> <span class="k">for</span> <span class="nb">sum</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="n">two_elements</span> <span class="p">(</span><span class="ow">in</span> <span class="n">the</span> <span class="n">log</span><span class="p">)</span><span class="o">.</span>

<span class="n">Raised</span> <span class="n">at</span> <span class="n">OUnitAssert</span><span class="o">.</span><span class="n">assert_failure</span> <span class="ow">in</span> <span class="n">file</span> <span class="s2">&quot;src/lib/ounit2/advanced/oUnitAssert.ml&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">45</span><span class="p">,</span> <span class="n">characters</span> <span class="mi">2</span><span class="o">-</span><span class="mi">27</span>
<span class="n">Called</span> <span class="kn">from</span> <span class="nn">OUnitRunner.run_one_test.</span><span class="p">(</span><span class="n">fun</span><span class="p">)</span> <span class="ow">in</span> <span class="n">file</span> <span class="s2">&quot;src/lib/ounit2/advanced/oUnitRunner.ml&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">83</span><span class="p">,</span> <span class="n">characters</span> <span class="mi">13</span><span class="o">-</span><span class="mi">26</span>

<span class="ow">not</span> <span class="n">equal</span>
<span class="o">------------------------------------------------------------------------------</span>
</pre></div>
</div>
<p>The first line of that output</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FFF</span>
</pre></div>
</div>
<p>tells us that OUnit ran three test cases and all three <u>f</u>ailed.</p>
<p>The next interesting line</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span><span class="p">:</span> <span class="n">test</span> <span class="n">suite</span> <span class="k">for</span> <span class="nb">sum</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="n">two_elements</span><span class="o">.</span>
</pre></div>
</div>
<p>tells us that in the test suite named <code class="docutils literal notranslate"><span class="pre">test</span> <span class="pre">suite</span> <span class="pre">for</span> <span class="pre">sum</span></code> the test case at
index 2 named <code class="docutils literal notranslate"><span class="pre">two_elements</span></code> failed. The rest of the output for that test case
is not particularly interesting; let’s ignore it for now.</p>
</section>
<section id="explanation-of-the-ounit-example">
<h2><span class="section-number">3.3.2. </span>Explanation of the OUnit Example<a class="headerlink" href="#explanation-of-the-ounit-example" title="Permalink to this heading">#</a></h2>
<p>Let’s study more carefully what we just did in the previous section. In the test
file, <code class="docutils literal notranslate"><span class="pre">open</span> <span class="pre">OUnit2</span></code> brings into scope the many definitions in OUnit2, which is
version 2 of the OUnit framework. And <code class="docutils literal notranslate"><span class="pre">open</span> <span class="pre">Sum</span></code> brings into scope the
definitions from <code class="docutils literal notranslate"><span class="pre">sum.ml</span></code>. We’ll learn more about scope and the <code class="docutils literal notranslate"><span class="pre">open</span></code> keyword
later in a later chapter.</p>
<p>Then we created a list of test cases:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>
  <span class="s2">&quot;empty&quot;</span>  <span class="o">&gt;::</span> <span class="o">(</span><span class="k">fun</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">assert_equal</span> <span class="mi">0</span> <span class="o">(</span><span class="n">sum</span> <span class="bp">[]</span><span class="o">));</span>
  <span class="s2">&quot;one&quot;</span>    <span class="o">&gt;::</span> <span class="o">(</span><span class="k">fun</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">assert_equal</span> <span class="mi">1</span> <span class="o">(</span><span class="n">sum</span> <span class="o">[</span><span class="mi">1</span><span class="o">]));</span>
  <span class="s2">&quot;onetwo&quot;</span> <span class="o">&gt;::</span> <span class="o">(</span><span class="k">fun</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">assert_equal</span> <span class="mi">3</span> <span class="o">(</span><span class="n">sum</span> <span class="o">[</span><span class="mi">1</span><span class="o">;</span> <span class="mi">2</span><span class="o">]));</span>
<span class="o">]</span>
</pre></div>
</div>
<p>Each line of code is a separate test case.  A test case has a string giving it a
descriptive name, and a function to run as the test case.  In between the name
and the function we write <code class="docutils literal notranslate"><span class="pre">&gt;::</span></code>, which is a custom operator defined by the OUnit
framework.  Let’s look at the first function from above:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fun</span> <span class="n">_</span> <span class="o">-&gt;</span> <span class="n">assert_equal</span> <span class="mi">0</span> <span class="p">(</span><span class="nb">sum</span> <span class="p">[])</span>
</pre></div>
</div>
<p>Every test case function receives as input a parameter that OUnit calls a <em>test
context</em>. Here (and in many of the test cases we write) we don’t actually need
to worry about the context, so we use the underscore to indicate that the
function ignores its input. The function then calls <code class="docutils literal notranslate"><span class="pre">assert_equal</span></code>, which is a
function provided by OUnit that checks to see whether its two arguments are
equal. If so the test case succeeds. If not, the test case fails.</p>
<p>Then we created a test suite:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">tests</span> <span class="o">=</span> <span class="s2">&quot;test suite for sum&quot;</span> <span class="o">&gt;:::</span> <span class="o">[</span>
  <span class="s2">&quot;empty&quot;</span> <span class="o">&gt;::</span> <span class="o">(</span><span class="k">fun</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">assert_equal</span> <span class="mi">0</span> <span class="o">(</span><span class="n">sum</span> <span class="bp">[]</span><span class="o">));</span>
  <span class="s2">&quot;singleton&quot;</span> <span class="o">&gt;::</span> <span class="o">(</span><span class="k">fun</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">assert_equal</span> <span class="mi">1</span> <span class="o">(</span><span class="n">sum</span> <span class="o">[</span><span class="mi">1</span><span class="o">]));</span>
  <span class="s2">&quot;two_elements&quot;</span> <span class="o">&gt;::</span> <span class="o">(</span><span class="k">fun</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">assert_equal</span> <span class="mi">3</span> <span class="o">(</span><span class="n">sum</span> <span class="o">[</span><span class="mi">1</span><span class="o">;</span> <span class="mi">2</span><span class="o">]));</span>
<span class="o">]</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">&gt;:::</span></code> operator is another custom OUnit operator. It goes between the name
of the test suite and the list of test cases in that suite.</p>
<p>Then we ran the test suite:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="o">_</span> <span class="o">=</span> <span class="n">run_test_tt_main</span> <span class="n">tests</span>
</pre></div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">run_test_tt_main</span></code> is provided by OUnit. It runs a test suite and
prints the results of which test cases passed vs. which failed to standard
output. The use of <code class="docutils literal notranslate"><span class="pre">let</span> <span class="pre">_</span> <span class="pre">=</span> </code> here indicates that we don’t care what value the
function returns; it just gets discarded.</p>
</section>
<section id="improving-ounit-output">
<h2><span class="section-number">3.3.3. </span>Improving OUnit Output<a class="headerlink" href="#improving-ounit-output" title="Permalink to this heading">#</a></h2>
<p>In our example with the buggy implementation of <code class="docutils literal notranslate"><span class="pre">sum</span></code>, we got the following
output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">==============================================================================</span>
<span class="n">Error</span><span class="p">:</span> <span class="n">test</span> <span class="n">suite</span> <span class="k">for</span> <span class="nb">sum</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="n">two_elements</span><span class="o">.</span>
<span class="o">...</span>
<span class="ow">not</span> <span class="n">equal</span>
<span class="o">------------------------------------------------------------------------------</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">equal</span></code> in the OUnit output means that <code class="docutils literal notranslate"><span class="pre">assert_equal</span></code> discovered the two
values passed to it in that test case were not equal. That’s not so informative:
we’d like to know <em>why</em> they’re not equal. In particular, we’d like to know what
the actual output produced by <code class="docutils literal notranslate"><span class="pre">sum</span></code> was for that test case. To find out, we need
to pass an additional argument to <code class="docutils literal notranslate"><span class="pre">assert_equal</span></code>. That argument, whose label is
<code class="docutils literal notranslate"><span class="pre">printer</span></code>, should be a function that can transform the outputs to strings. In
this case, the outputs are integers, so <code class="docutils literal notranslate"><span class="pre">string_of_int</span></code> from the <code class="docutils literal notranslate"><span class="pre">Stdlib</span></code> module
will suffice. We modify the test suite as follows:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">tests</span> <span class="o">=</span> <span class="s2">&quot;test suite for sum&quot;</span> <span class="o">&gt;:::</span> <span class="o">[</span>
  <span class="s2">&quot;empty&quot;</span> <span class="o">&gt;::</span> <span class="o">(</span><span class="k">fun</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">assert_equal</span> <span class="mi">0</span> <span class="o">(</span><span class="n">sum</span> <span class="bp">[]</span><span class="o">)</span> <span class="o">~</span><span class="n">printer</span><span class="o">:</span><span class="n">string_of_int</span><span class="o">);</span>
  <span class="s2">&quot;singleton&quot;</span> <span class="o">&gt;::</span> <span class="o">(</span><span class="k">fun</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">assert_equal</span> <span class="mi">1</span> <span class="o">(</span><span class="n">sum</span> <span class="o">[</span><span class="mi">1</span><span class="o">])</span> <span class="o">~</span><span class="n">printer</span><span class="o">:</span><span class="n">string_of_int</span><span class="o">);</span>
  <span class="s2">&quot;two_elements&quot;</span> <span class="o">&gt;::</span> <span class="o">(</span><span class="k">fun</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">assert_equal</span> <span class="mi">3</span> <span class="o">(</span><span class="n">sum</span> <span class="o">[</span><span class="mi">1</span><span class="o">;</span> <span class="mi">2</span><span class="o">])</span> <span class="o">~</span><span class="n">printer</span><span class="o">:</span><span class="n">string_of_int</span><span class="o">);</span>
<span class="o">]</span>
</pre></div>
</div>
<p>And now we get more informative output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">==============================================================================</span>
<span class="n">Error</span><span class="p">:</span> <span class="n">test</span> <span class="n">suite</span> <span class="k">for</span> <span class="nb">sum</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="n">two_elements</span><span class="o">.</span>
<span class="o">...</span>
<span class="n">expected</span><span class="p">:</span> <span class="mi">3</span> <span class="n">but</span> <span class="n">got</span><span class="p">:</span> <span class="mi">4</span>
<span class="o">------------------------------------------------------------------------------</span>
</pre></div>
</div>
<p>That output means that the test named <code class="docutils literal notranslate"><span class="pre">two_elements</span></code> asserted the equality of
<code class="docutils literal notranslate"><span class="pre">3</span></code> and <code class="docutils literal notranslate"><span class="pre">4</span></code>. The expected output was <code class="docutils literal notranslate"><span class="pre">3</span></code> because that was the first input to
<code class="docutils literal notranslate"><span class="pre">assert_equal</span></code>, and that function’s specification says that in
<code class="docutils literal notranslate"><span class="pre">assert_equal</span> <span class="pre">x</span> <span class="pre">y</span></code>, the output you (as the tester) are expecting to get should
be <code class="docutils literal notranslate"><span class="pre">x</span></code>, and the output the function being tested actually produces should be
<code class="docutils literal notranslate"><span class="pre">y</span></code>.</p>
<p>Notice how our test suite is accumulating a lot of redundant code. In
particular, we had to add the <code class="docutils literal notranslate"><span class="pre">printer</span></code> argument to several lines. Let’s improve
that code by factoring out a function that constructs test cases:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">make_sum_test</span> <span class="n">name</span> <span class="n">expected_output</span> <span class="n">input</span> <span class="o">=</span>
  <span class="n">name</span> <span class="o">&gt;::</span> <span class="o">(</span><span class="k">fun</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">assert_equal</span> <span class="n">expected_output</span> <span class="o">(</span><span class="n">sum</span> <span class="n">input</span><span class="o">)</span> <span class="o">~</span><span class="n">printer</span><span class="o">:</span><span class="n">string_of_int</span><span class="o">)</span>

<span class="k">let</span> <span class="n">tests</span> <span class="o">=</span> <span class="s2">&quot;test suite for sum&quot;</span> <span class="o">&gt;:::</span> <span class="o">[</span>
  <span class="n">make_sum_test</span> <span class="s2">&quot;empty&quot;</span> <span class="mi">0</span> <span class="bp">[]</span><span class="o">;</span>
  <span class="n">make_sum_test</span> <span class="s2">&quot;singleton&quot;</span> <span class="mi">1</span> <span class="o">[</span><span class="mi">1</span><span class="o">];</span>
  <span class="n">make_sum_test</span> <span class="s2">&quot;two_elements&quot;</span> <span class="mi">3</span> <span class="o">[</span><span class="mi">1</span><span class="o">;</span> <span class="mi">2</span><span class="o">];</span>
<span class="o">]</span>
</pre></div>
</div>
<p>For output types that are more complicated than integers, you will end up
needing to write your own functions to pass to <code class="docutils literal notranslate"><span class="pre">printer</span></code>. This is similar to
writing <code class="docutils literal notranslate"><span class="pre">toString()</span></code> methods in Java: for complicated types you invent yourself,
the language doesn’t know how to render them as strings. You have to provide the
code that does it.</p>
</section>
<section id="testing-for-exceptions">
<h2><span class="section-number">3.3.4. </span>Testing for Exceptions<a class="headerlink" href="#testing-for-exceptions" title="Permalink to this heading">#</a></h2>
<p>We have a little more of OCaml to learn before we can see how to test for
exceptions. You can peek ahead to <a class="reference internal" href="exceptions.html"><span class="doc std std-doc">the section on exceptions</span></a> if you
want to know now.</p>
</section>
<section id="test-driven-development">
<h2><span class="section-number">3.3.5. </span>Test-Driven Development<a class="headerlink" href="#test-driven-development" title="Permalink to this heading">#</a></h2>
<p>Testing doesn’t have to happen strictly after you write code. In <em>test-driven
development</em> (TDD), testing comes first! It emphasizes <em>incremental</em> development
of code: there is always something that can be tested. Testing is not something
that happens after implementation; instead, <em>continuous testing</em> is used to
catch errors early. Thus, it is important to develop unit tests immediately when
the code is written. Automating test suites is crucial so that continuous
testing requires essentially no effort.</p>
<p>Here’s an example of TDD. We deliberately choose an exceedingly simple function
to implement, so that the process is clear. Suppose we are working with a data
type for days:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">type</span> <span class="n">day</span> <span class="o">=</span> <span class="nc">Sunday</span> <span class="o">|</span> <span class="nc">Monday</span> <span class="o">|</span> <span class="nc">Tuesday</span> <span class="o">|</span> <span class="nc">Wednesday</span> <span class="o">|</span> <span class="nc">Thursday</span> <span class="o">|</span> <span class="nc">Friday</span> <span class="o">|</span> <span class="nc">Saturday</span>
</pre></div>
</div>
<p>And we want to write a function <code class="docutils literal notranslate"><span class="pre">next_weekday</span> <span class="pre">:</span> <span class="pre">day</span> <span class="pre">-&gt;</span> <span class="pre">day</span></code> that returns
the next weekday after a given day. We start by writing the most basic,
broken version of that function we can:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">next_weekday</span> <span class="n">d</span> <span class="o">=</span> <span class="n">failwith</span> <span class="s2">&quot;Unimplemented&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The built-in function <code class="docutils literal notranslate"><span class="pre">failwith</span></code> raises an exception along with the error
message passed to the function.</p>
</div>
<p>Then we write the simplest unit test we can imagine. For example, we know that
the next weekday after Monday is Tuesday. So we add a test:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">tests</span> <span class="o">=</span> <span class="s2">&quot;test suite for next_weekday&quot;</span> <span class="o">&gt;:::</span> <span class="o">[</span>
  <span class="s2">&quot;tue_after_mon&quot;</span>  <span class="o">&gt;::</span> <span class="o">(</span><span class="k">fun</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">assert_equal</span> <span class="nc">Tuesday</span> <span class="o">(</span><span class="n">next_weekday</span> <span class="nc">Monday</span><span class="o">));</span>
<span class="o">]</span>
</pre></div>
</div>
<p>Then we run the OUnit test suite. It fails, as expected. That’s good! Now we
have a concrete goal, to make that unit test pass. We revise <code class="docutils literal notranslate"><span class="pre">next_weekday</span></code> to
make that happen:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">next_weekday</span> <span class="n">d</span> <span class="o">=</span>
  <span class="k">match</span> <span class="n">d</span> <span class="k">with</span>
  <span class="o">|</span> <span class="nc">Monday</span> <span class="o">-&gt;</span> <span class="nc">Tuesday</span>
  <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">failwith</span> <span class="s2">&quot;Unimplemented&quot;</span>
</pre></div>
</div>
<p>We compile and run the test; it passes. Time to add some more tests. The
simplest remaining possibilities are tests involving just weekdays, rather than
weekends. So let’s add tests for weekdays.</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">tests</span> <span class="o">=</span> <span class="s2">&quot;test suite for next_weekday&quot;</span> <span class="o">&gt;:::</span> <span class="o">[</span>
  <span class="s2">&quot;tue_after_mon&quot;</span>  <span class="o">&gt;::</span> <span class="o">(</span><span class="k">fun</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">assert_equal</span> <span class="nc">Tuesday</span> <span class="o">(</span><span class="n">next_weekday</span> <span class="nc">Monday</span><span class="o">));</span>
  <span class="s2">&quot;wed_after_tue&quot;</span>  <span class="o">&gt;::</span> <span class="o">(</span><span class="k">fun</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">assert_equal</span> <span class="nc">Wednesday</span> <span class="o">(</span><span class="n">next_weekday</span> <span class="nc">Tuesday</span><span class="o">));</span>
  <span class="s2">&quot;thu_after_wed&quot;</span>  <span class="o">&gt;::</span> <span class="o">(</span><span class="k">fun</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">assert_equal</span> <span class="nc">Thursday</span><span class="o">(</span><span class="n">next_weekday</span> <span class="nc">Wednesday</span><span class="o">));</span>
  <span class="s2">&quot;fri_after_thu&quot;</span>  <span class="o">&gt;::</span> <span class="o">(</span><span class="k">fun</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">assert_equal</span> <span class="nc">Friday</span> <span class="o">(</span><span class="n">next_weekday</span> <span class="nc">Thursday</span><span class="o">));</span>
<span class="o">]</span>
</pre></div>
</div>
<p>We compile and run the tests; many fail. That’s good! We add new
functionality:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span>  <span class="k">let</span> <span class="n">next_weekday</span> <span class="n">d</span> <span class="o">=</span>
    <span class="k">match</span> <span class="n">d</span> <span class="k">with</span>
    <span class="o">|</span> <span class="nc">Monday</span> <span class="o">-&gt;</span> <span class="nc">Tuesday</span>
    <span class="o">|</span> <span class="nc">Tuesday</span> <span class="o">-&gt;</span> <span class="nc">Wednesday</span>
    <span class="o">|</span> <span class="nc">Wednesday</span> <span class="o">-&gt;</span> <span class="nc">Thursday</span>
    <span class="o">|</span> <span class="nc">Thursday</span> <span class="o">-&gt;</span> <span class="nc">Friday</span>
    <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">failwith</span> <span class="s2">&quot;Unimplemented&quot;</span>
</pre></div>
</div>
<p>We compile and run the tests; they pass. At this point we could move on to
handling weekends, but we should first notice something about the tests we’ve
written: they involve repeating a lot of code. In fact, we probably wrote them
by copying-and-pasting the first test, then modifying it for the next three.
That’s a sign that we should <em>refactor</em> the code. (As we did before with the
<code class="docutils literal notranslate"><span class="pre">sum</span></code> function we were testing.)</p>
<p>Let’s abstract a function that creates test cases for <code class="docutils literal notranslate"><span class="pre">next_weekday</span></code>:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">make_next_weekday_test</span> <span class="n">name</span> <span class="n">expected_output</span> <span class="n">input</span> <span class="o">=</span>
  <span class="n">name</span> <span class="o">&gt;::</span> <span class="o">(</span><span class="k">fun</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">assert_equal</span> <span class="n">expected_output</span> <span class="o">(</span><span class="n">next_weekday</span> <span class="n">input</span><span class="o">))</span>

<span class="k">let</span> <span class="n">tests</span> <span class="o">=</span> <span class="s2">&quot;test suite for next_weekday&quot;</span> <span class="o">&gt;:::</span> <span class="o">[</span>
  <span class="n">make_next_weekday_test</span> <span class="s2">&quot;tue_after_mon&quot;</span> <span class="nc">Tuesday</span> <span class="nc">Monday</span><span class="o">;</span>
  <span class="n">make_next_weekday_test</span> <span class="s2">&quot;wed_after_tue&quot;</span> <span class="nc">Wednesday</span> <span class="nc">Tuesday</span><span class="o">;</span>
  <span class="n">make_next_weekday_test</span> <span class="s2">&quot;thu_after_wed&quot;</span> <span class="nc">Thursday</span> <span class="nc">Wednesday</span><span class="o">;</span>
  <span class="n">make_next_weekday_test</span> <span class="s2">&quot;fri_after_thu&quot;</span> <span class="nc">Friday</span> <span class="nc">Thursday</span><span class="o">;</span>
<span class="o">]</span>
</pre></div>
</div>
<p>Now we finish the testing and implementation by handling weekends. First we add
some test cases:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span>  <span class="o">...</span>
  <span class="n">make_next_weekday_test</span> <span class="s2">&quot;mon_after_fri&quot;</span> <span class="nc">Monday</span> <span class="nc">Friday</span><span class="o">;</span>
  <span class="n">make_next_weekday_test</span> <span class="s2">&quot;mon_after_sat&quot;</span> <span class="nc">Monday</span> <span class="nc">Saturday</span><span class="o">;</span>
  <span class="n">make_next_weekday_test</span> <span class="s2">&quot;mon_after_sun&quot;</span> <span class="nc">Monday</span> <span class="nc">Sunday</span><span class="o">;</span>
  <span class="o">...</span>
</pre></div>
</div>
<p>Then we finish the function:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">next_weekday</span> <span class="n">d</span> <span class="o">=</span>
  <span class="k">match</span> <span class="n">d</span> <span class="k">with</span>
  <span class="o">|</span> <span class="nc">Monday</span> <span class="o">-&gt;</span> <span class="nc">Tuesday</span>
  <span class="o">|</span> <span class="nc">Tuesday</span> <span class="o">-&gt;</span> <span class="nc">Wednesday</span>
  <span class="o">|</span> <span class="nc">Wednesday</span> <span class="o">-&gt;</span> <span class="nc">Thursday</span>
  <span class="o">|</span> <span class="nc">Thursday</span> <span class="o">-&gt;</span> <span class="nc">Friday</span>
  <span class="o">|</span> <span class="nc">Friday</span> <span class="o">-&gt;</span> <span class="nc">Monday</span>
  <span class="o">|</span> <span class="nc">Saturday</span> <span class="o">-&gt;</span> <span class="nc">Monday</span>
  <span class="o">|</span> <span class="nc">Sunday</span> <span class="o">-&gt;</span> <span class="nc">Monday</span>
</pre></div>
</div>
<p>Of course, most people could write that function without errors even if they
didn’t use TDD. But rarely do we implement functions that are so simple.</p>
<p><strong>Process.</strong> Let’s review the process of TDD:</p>
<ul class="simple">
<li><p>Write a failing unit test case. Run the test suite to prove that the test case
fails.</p></li>
<li><p>Implement just enough functionality to make the test case pass. Run the test
suite to prove that the test case passes.</p></li>
<li><p>Improve code as needed. In the example above we refactored the test suite, but
often we’ll need to refactor the functionality being implemented.</p></li>
<li><p>Repeat until you are satisfied that the test suite provides evidence that your
implementation is correct.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "cs3110/textbook",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapters/data"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="variants.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">3.2. </span>Variants</p>
      </div>
    </a>
    <a class="right-next"
       href="records_tuples.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">3.4. </span>Records and Tuples</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#an-example-of-ounit">3.3.1. An Example of OUnit</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#explanation-of-the-ounit-example">3.3.2. Explanation of the OUnit Example</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#improving-ounit-output">3.3.3. Improving OUnit Output</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-for-exceptions">3.3.4. Testing for Exceptions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-driven-development">3.3.5. Test-Driven Development</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Michael R. Clarkson et al.
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=bd9e20870c6007c4c509"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=bd9e20870c6007c4c509"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>