

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>7.10. Exercises &#8212; OCaml Programming: Correct + Efficient + Beautiful</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=bd9e20870c6007c4c509" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=bd9e20870c6007c4c509" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=bd9e20870c6007c4c509"></script>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/conc/exercises';</script>
    <link rel="shortcut icon" href="../../_static/op.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="8. Correctness" href="../correctness/intro.html" />
    <link rel="prev" title="7.9. Summary" href="summary.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <header>


  <div class="bd-header-announcement container-fluid bd-header-announcement">
    <div class="bd-header-announcement__content">Using this book as part of a course? Please <a style="color:white" href="https://docs.google.com/forms/d/e/1FAIpQLSfEW65AJPBnk732zZZM9CFpWMobWUkym6Nf-pgslRqqwoWYIA/viewform?usp=preview">let us know</a>!</div>
  </div>

  
    <div class="bd-header navbar navbar-expand-lg bd-navbar">
    </div>
  
  </header>

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../cover.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/op_title.png" class="logo__image only-light" alt="OCaml Programming: Correct + Efficient + Beautiful - Home"/>
    <script>document.write(`<img src="../../_static/op_title.png" class="logo__image only-dark" alt="OCaml Programming: Correct + Efficient + Beautiful - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Preface</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../preface/about.html">About This Book</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preface/install.html">Installing OCaml</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../intro/intro.html">1. Better Programming Through OCaml</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro/past.html">1.1. The Past of OCaml</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/present.html">1.2. The Present of OCaml</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/future.html">1.3. Look to Your Future</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/3110.html">1.4. A Brief History of CS 3110</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/summary.html">1.5. Summary</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../basics/intro.html">2. The Basics of OCaml</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../basics/toplevel.html">2.1. The OCaml Toplevel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/compiling.html">2.2. Compiling OCaml Programs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/expressions.html">2.3. Expressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/functions.html">2.4. Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/documentation.html">2.5. Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/printing.html">2.6. Printing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/debugging.html">2.7. Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/summary.html">2.8. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/exercises.html">2.9. Exercises</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">OCaml Programming</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../data/intro.html">3. Data and Types</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../data/lists.html">3.1. Lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/variants.html">3.2. Variants</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/ounit.html">3.3. Unit Testing with OUnit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/records_tuples.html">3.4. Records and Tuples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/pattern_matching_advanced.html">3.5. Advanced Pattern Matching</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/type_synonym.html">3.6. Type Synonyms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/options.html">3.7. Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/assoc_list.html">3.8. Association Lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/algebraic_data_types.html">3.9. Algebraic Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/exceptions.html">3.10. Exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/trees.html">3.11. Example: Trees</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/nats.html">3.12. Example: Natural Numbers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/summary.html">3.13. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/exercises.html">3.14. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../hop/intro.html">4. Higher-Order Programming</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../hop/higher_order.html">4.1. Higher-Order Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/map.html">4.2. Map</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/filter.html">4.3. Filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/fold.html">4.4. Fold</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/beyond_lists.html">4.5. Beyond Lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/pipelining.html">4.6. Pipelining</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/currying.html">4.7. Currying</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/summary.html">4.8. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/exercises.html">4.9. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../modules/intro.html">5. Modular Programming</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/module_systems.html">5.1. Module Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/modules.html">5.2. Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/toplevel.html">5.3. Modules and the Toplevel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/encapsulation.html">5.4. Encapsulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/compilation_units.html">5.5. Compilation Units</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/functional_data_structures.html">5.6. Functional Data Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/module_type_constraints.html">5.7. Module Type Constraints</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/includes.html">5.8. Includes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/functors.html">5.9. Functors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/summary.html">5.10. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/exercises.html">5.11. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../mut/intro.html">6. Mutability</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../mut/refs.html">6.1. Refs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mut/mutable_fields.html">6.2. Mutable Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mut/arrays.html">6.3. Arrays and Loops</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mut/summary.html">6.4. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mut/exercises.html">6.5. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="intro.html">7. Concurrency</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="concurrency.html">7.1. Concurrency</a></li>
<li class="toctree-l2"><a class="reference internal" href="promises.html">7.2. Promises</a></li>
<li class="toctree-l2"><a class="reference internal" href="impl_promises.html">7.3. Implementing Promises</a></li>
<li class="toctree-l2"><a class="reference internal" href="io_promises.html">7.4. Asynchronous Input and Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="callbacks.html">7.5. Callbacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="impl_callbacks.html">7.6. Implementing Callbacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="full_promises_impl.html">7.7. The Full Promises Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="monads.html">7.8. Monads</a></li>
<li class="toctree-l2"><a class="reference internal" href="summary.html">7.9. Summary</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">7.10. Exercises</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Correctness and Efficiency</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../correctness/intro.html">8. Correctness</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../correctness/specifications.html">8.1. Specifications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/function_docs.html">8.2. Function Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/module_docs.html">8.3. Module Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/test_debug.html">8.4. Testing and Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/black_glass_box.html">8.5. Black-box and Glass-box Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/randomized.html">8.6. Randomized Testing with QCheck</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/proving_correctness.html">8.7. Proving Correctness</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/structural_induction.html">8.8. Structural Induction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/eq_spec.html">8.9. Equational Specification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/summary.html">8.10. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/exercises.html">8.11. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ds/intro.html">9. Data Structures</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ds/hash_tables.html">9.1. Hash Tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/amortized.html">9.2. Amortized Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/rb.html">9.3. Red-Black Trees</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/sequence.html">9.4. Sequences</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/memoization.html">9.5. Memoization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/parrays.html">9.6. Persistent Arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/twothree.html">9.7. Two-Three Trees</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/summary.html">9.8. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/exercises.html">9.9. Exercises</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Language Implementation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../interp/intro.html">10. Interpreters</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../interp/calculator.html">10.1. Example: Calculator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/parsing.html">10.2. Parsing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/substitution.html">10.3. Substitution Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/environment.html">10.4. Environment Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/typecheck.html">10.5. Type Checking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/inference.html">10.6. Type Inference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/summary.html">10.7. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/exercises.html">10.8. Exercises</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Lagniappe</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../adv/curry-howard.html">The Curry-Howard Correspondence</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../appendix/bigoh.html">Big-Oh Notation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/vm.html">Virtual Machine</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/cs3110/textbook" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/cs3110/textbook/edit/main/src/chapters/conc/exercises.md" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/cs3110/textbook/issues/new?title=Issue%20on%20page%20%2Fchapters/conc/exercises.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/chapters/conc/exercises.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Exercises</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="exercises">
<h1><span class="section-number">7.10. </span>Exercises<a class="headerlink" href="#exercises" title="Permalink to this heading">#</a></h1>
<p>Solutions to most exercises are <a href="https://github.com/cs3110/textbook-solutions">available</a>.
We are happy to add or correct solutions. Please make contributions through GitHub.</p>
<!--------------------------------------------------------------------------->
<hr class="docutils" />
<p><strong>Exercise: promise and resolve [★★]</strong></p>
<p>Use the finished version of the <code class="docutils literal notranslate"><span class="pre">Promise</span></code> module we developed to do the
following: create an integer promise and resolver, bind a function on the
promise to print the contents of the promise, then resolve the promise. Only
after the promise is resolved should the printing occur.</p>
<!--------------------------------------------------------------------------->
<hr class="docutils" />
<p><strong>Exercise: promise and resolve lwt [★★]</strong></p>
<p>Repeat the above exercise, but use the Lwt library instead of our own Promise
library. Make sure to use Lwt’s I/O functions (e.g., <code class="docutils literal notranslate"><span class="pre">Lwt_io.printf</span></code>).</p>
<!--------------------------------------------------------------------------->
<hr class="docutils" />
<p><strong>Exercise: map via bind [★]</strong></p>
<p>Use the finished version of the <code class="docutils literal notranslate"><span class="pre">Promise</span></code> module we developed to also implement the <code class="docutils literal notranslate"><span class="pre">map</span></code> operator. Review the text for a description of the behavior of <code class="docutils literal notranslate"><span class="pre">map</span> <span class="pre">p</span> <span class="pre">f</span></code>. You may call <code class="docutils literal notranslate"><span class="pre">bind</span></code> in your implementation of <code class="docutils literal notranslate"><span class="pre">map</span></code>. Hint: use <code class="docutils literal notranslate"><span class="pre">return</span></code>.</p>
<!--------------------------------------------------------------------------->
<hr class="docutils" />
<p><strong>Exercise: map anew [★★]</strong></p>
<p>Use the finished version of the <code class="docutils literal notranslate"><span class="pre">Promise</span></code> module we developed to also implement the <code class="docutils literal notranslate"><span class="pre">map</span></code> operator. Review the text for a description of the behavior of <code class="docutils literal notranslate"><span class="pre">map</span> <span class="pre">p</span> <span class="pre">f</span></code>. You may use the code we developed for <code class="docutils literal notranslate"><span class="pre">bind</span></code> as a template, but you may not call <code class="docutils literal notranslate"><span class="pre">bind</span></code> in your implementation of <code class="docutils literal notranslate"><span class="pre">map</span></code>.</p>
<!--------------------------------------------------------------------------->
<hr class="docutils" />
<p><strong>Exercise: timing challenge 1 [★★]</strong></p>
<p>Here is a function that produces a time delay.  We can use it
to simulate an I/O call that takes a long time to complete.</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="c">(** [delay s] is a promise that resolves after about [s] seconds. *)</span>
<span class="k">let</span> <span class="n">delay</span> <span class="o">(</span><span class="n">sec</span> <span class="o">:</span> <span class="kt">float</span><span class="o">)</span> <span class="o">:</span> <span class="kt">unit</span> <span class="nn">Lwt</span><span class="p">.</span><span class="n">t</span> <span class="o">=</span>
  <span class="nn">Lwt_unix</span><span class="p">.</span><span class="n">sleep</span> <span class="n">sec</span>
</pre></div>
</div>
<p>Write a function <code class="docutils literal notranslate"><span class="pre">delay_then_print</span> <span class="pre">:</span> <span class="pre">unit</span> <span class="pre">-&gt;</span> <span class="pre">unit</span> <span class="pre">Lwt.t</span></code> that delays for three
seconds then prints <code class="docutils literal notranslate"><span class="pre">&quot;done&quot;</span></code>.</p>
<!--------------------------------------------------------------------------->
<hr class="docutils" />
<p><strong>Exercise: timing challenge 2 [★★★]</strong></p>
<p>What happens when <code class="docutils literal notranslate"><span class="pre">timing2</span> <span class="pre">()</span></code> is run? How long does it take to run? Make a
prediction, then run the code to find out.</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">delay</span> <span class="n">n</span> <span class="o">=</span> <span class="nn">Lwt_unix</span><span class="p">.</span><span class="n">sleep</span> <span class="n">n</span>

<span class="k">let</span> <span class="n">timing2</span> <span class="bp">()</span> <span class="o">=</span>
  <span class="k">let</span><span class="o">%</span><span class="n">lwt</span> <span class="bp">()</span> <span class="o">=</span> <span class="n">delay</span> <span class="mi">1</span><span class="o">.</span> <span class="k">in</span>
  <span class="k">let</span><span class="o">%</span><span class="n">lwt</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Lwt_io</span><span class="p">.</span><span class="n">printl</span> <span class="s2">&quot;1&quot;</span> <span class="k">in</span>
  <span class="k">let</span><span class="o">%</span><span class="n">lwt</span> <span class="bp">()</span> <span class="o">=</span> <span class="n">delay</span> <span class="mi">10</span><span class="o">.</span> <span class="k">in</span>
  <span class="k">let</span><span class="o">%</span><span class="n">lwt</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Lwt_io</span><span class="p">.</span><span class="n">printl</span> <span class="s2">&quot;2&quot;</span> <span class="k">in</span>
  <span class="k">let</span><span class="o">%</span><span class="n">lwt</span> <span class="bp">()</span> <span class="o">=</span> <span class="n">delay</span> <span class="mi">20</span><span class="o">.</span> <span class="k">in</span>
  <span class="k">let</span><span class="o">%</span><span class="n">lwt</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Lwt_io</span><span class="p">.</span><span class="n">printl</span> <span class="s2">&quot;3&quot;</span> <span class="k">in</span>
  <span class="nn">Lwt_io</span><span class="p">.</span><span class="n">printl</span> <span class="s2">&quot;all done&quot;</span>

<span class="k">let</span> <span class="o">_</span> <span class="o">=</span> <span class="n">timing2</span> <span class="bp">()</span>
<span class="k">let</span> <span class="o">_</span> <span class="o">=</span> <span class="nn">Lwt_main</span><span class="p">.</span><span class="n">run</span> <span class="o">(</span><span class="n">delay</span> <span class="mi">35</span><span class="o">.)</span>
</pre></div>
</div>
<!--------------------------------------------------------------------------->
<hr class="docutils" />
<p><strong>Exercise: timing challenge 3 [★★★]</strong></p>
<p>What happens when <code class="docutils literal notranslate"><span class="pre">timing3</span> <span class="pre">()</span></code> is run? How long does it take to run? Make a
prediction, then run the code to find out.</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">open</span> <span class="nn">Lwt</span><span class="p">.</span><span class="nc">Infix</span>

<span class="k">let</span> <span class="n">delay</span> <span class="n">n</span> <span class="o">=</span> <span class="nn">Lwt_unix</span><span class="p">.</span><span class="n">sleep</span> <span class="n">n</span>

<span class="k">let</span> <span class="n">timing3</span> <span class="bp">()</span> <span class="o">=</span>
  <span class="k">let</span> <span class="o">_</span><span class="n">t1</span> <span class="o">=</span> <span class="k">let</span><span class="o">%</span><span class="n">lwt</span> <span class="bp">()</span> <span class="o">=</span> <span class="n">delay</span> <span class="mi">1</span><span class="o">.</span> <span class="k">in</span> <span class="nn">Lwt_io</span><span class="p">.</span><span class="n">printl</span> <span class="s2">&quot;1&quot;</span> <span class="k">in</span>
  <span class="k">let</span> <span class="o">_</span><span class="n">t2</span> <span class="o">=</span> <span class="k">let</span><span class="o">%</span><span class="n">lwt</span> <span class="bp">()</span> <span class="o">=</span> <span class="n">delay</span> <span class="mi">10</span><span class="o">.</span> <span class="k">in</span> <span class="nn">Lwt_io</span><span class="p">.</span><span class="n">printl</span> <span class="s2">&quot;2&quot;</span> <span class="k">in</span>
  <span class="k">let</span> <span class="o">_</span><span class="n">t3</span> <span class="o">=</span> <span class="k">let</span><span class="o">%</span><span class="n">lwt</span> <span class="bp">()</span> <span class="o">=</span> <span class="n">delay</span> <span class="mi">20</span><span class="o">.</span> <span class="k">in</span> <span class="nn">Lwt_io</span><span class="p">.</span><span class="n">printl</span> <span class="s2">&quot;3&quot;</span> <span class="k">in</span>
  <span class="nn">Lwt_io</span><span class="p">.</span><span class="n">printl</span> <span class="s2">&quot;all done&quot;</span>

<span class="k">let</span> <span class="o">_</span> <span class="o">=</span> <span class="n">timing3</span> <span class="bp">()</span>
<span class="k">let</span> <span class="o">_</span> <span class="o">=</span> <span class="nn">Lwt_main</span><span class="p">.</span><span class="n">run</span> <span class="o">(</span><span class="n">delay</span> <span class="mi">35</span><span class="o">.)</span>
</pre></div>
</div>
<!--------------------------------------------------------------------------->
<hr class="docutils" />
<p><strong>Exercise: timing challenge 4 [★★★]</strong></p>
<p>What happens when <code class="docutils literal notranslate"><span class="pre">timing4</span> <span class="pre">()</span></code> is run? How long does it take to run? Make a
prediction, then run the code to find out.</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">open</span> <span class="nn">Lwt</span><span class="p">.</span><span class="nc">Infix</span>

<span class="k">let</span> <span class="n">delay</span> <span class="n">n</span> <span class="o">=</span> <span class="nn">Lwt_unix</span><span class="p">.</span><span class="n">sleep</span> <span class="n">n</span>

<span class="k">let</span> <span class="n">timing4</span> <span class="bp">()</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">t1</span> <span class="o">=</span> <span class="k">let</span><span class="o">%</span><span class="n">lwt</span> <span class="bp">()</span> <span class="o">=</span> <span class="n">delay</span> <span class="mi">1</span><span class="o">.</span> <span class="k">in</span> <span class="nn">Lwt_io</span><span class="p">.</span><span class="n">printl</span> <span class="s2">&quot;1&quot;</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">t2</span> <span class="o">=</span> <span class="k">let</span><span class="o">%</span><span class="n">lwt</span> <span class="bp">()</span> <span class="o">=</span> <span class="n">delay</span> <span class="mi">10</span><span class="o">.</span> <span class="k">in</span> <span class="nn">Lwt_io</span><span class="p">.</span><span class="n">printl</span> <span class="s2">&quot;2&quot;</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">t3</span> <span class="o">=</span> <span class="k">let</span><span class="o">%</span><span class="n">lwt</span> <span class="bp">()</span> <span class="o">=</span> <span class="n">delay</span> <span class="mi">20</span><span class="o">.</span> <span class="k">in</span> <span class="nn">Lwt_io</span><span class="p">.</span><span class="n">printl</span> <span class="s2">&quot;3&quot;</span> <span class="k">in</span>
  <span class="k">let</span><span class="o">%</span><span class="n">lwt</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Lwt</span><span class="p">.</span><span class="n">join</span> <span class="o">[</span><span class="n">t1</span><span class="o">;</span> <span class="n">t2</span><span class="o">;</span> <span class="n">t3</span><span class="o">]</span> <span class="k">in</span>
  <span class="nn">Lwt_io</span><span class="p">.</span><span class="n">printl</span> <span class="s2">&quot;all done&quot;</span>

<span class="k">let</span> <span class="o">_</span> <span class="o">=</span> <span class="n">timing4</span> <span class="bp">()</span>
<span class="k">let</span> <span class="o">_</span> <span class="o">=</span> <span class="nn">Lwt_main</span><span class="p">.</span><span class="n">run</span> <span class="o">(</span><span class="n">delay</span> <span class="mi">35</span><span class="o">.)</span>
</pre></div>
</div>
<!--------------------------------------------------------------------------->
<hr class="docutils" />
<p><strong>Exercise: file monitor [★★★★]</strong></p>
<p>Write an Lwt program that monitors the contents of a file named “log”.
Specifically, your program should open the file, continually read a line from
the file, and as each line becomes available, print the line to stdout. When you
reach the end of the file (EOF), your program should terminate cleanly without
any exceptions.</p>
<p>Here is starter code:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">open</span> <span class="nc">Lwt_io</span>
<span class="k">open</span> <span class="nc">Lwt_unix</span>

<span class="c">(** [log ()] is a promise for an [input_channel] that reads from</span>
<span class="c">    the file named &quot;log&quot;. *)</span>
<span class="k">let</span> <span class="n">log</span> <span class="bp">()</span> <span class="o">:</span> <span class="n">input_channel</span> <span class="nn">Lwt</span><span class="p">.</span><span class="n">t</span> <span class="o">=</span>
  <span class="k">let</span><span class="o">%</span><span class="n">lwt</span> <span class="n">fd</span> <span class="o">=</span> <span class="n">openfile</span> <span class="s2">&quot;log&quot;</span> <span class="o">[</span><span class="nc">O_RDONLY</span><span class="o">]</span> <span class="mi">0</span> <span class="k">in</span>
  <span class="nn">Lwt</span><span class="p">.</span><span class="n">return</span> <span class="o">(</span><span class="n">of_fd</span> <span class="o">~</span><span class="n">mode</span><span class="o">:</span><span class="n">input</span> <span class="n">fd</span><span class="o">)</span>

<span class="c">(** [loop ic] reads one line from [ic], prints it to stdout,</span>
<span class="c">    then calls itself recursively. It is an infinite loop. *)</span>
<span class="k">let</span> <span class="k">rec</span> <span class="n">loop</span> <span class="o">(</span><span class="n">ic</span> <span class="o">:</span> <span class="n">input_channel</span><span class="o">)</span> <span class="o">=</span>
  <span class="n">failwith</span> <span class="s2">&quot;TODO&quot;</span>
  <span class="c">(* hint: use [Lwt_io.read_line] and [Lwt_io.printlf] *)</span>

<span class="c">(** [monitor ()] monitors the file named &quot;log&quot;. *)</span>
<span class="k">let</span> <span class="n">monitor</span> <span class="bp">()</span> <span class="o">:</span> <span class="kt">unit</span> <span class="nn">Lwt</span><span class="p">.</span><span class="n">t</span> <span class="o">=</span>
  <span class="nn">Lwt</span><span class="p">.</span><span class="n">bind</span> <span class="o">(</span><span class="n">log</span> <span class="bp">()</span><span class="o">)</span> <span class="n">loop</span>

<span class="c">(** [handler] is a helper function for [main]. If its input is</span>
<span class="c">    [End_of_file], it handles cleanly exiting the program by</span>
<span class="c">    returning the unit promise. Any other input is re-raised</span>
<span class="c">    with [Lwt.fail]. *)</span>
<span class="k">let</span> <span class="n">handler</span> <span class="o">:</span> <span class="n">exn</span> <span class="o">-&gt;</span> <span class="kt">unit</span> <span class="nn">Lwt</span><span class="p">.</span><span class="n">t</span> <span class="o">=</span>
  <span class="n">failwith</span> <span class="s2">&quot;TODO&quot;</span>

<span class="k">let</span> <span class="n">main</span> <span class="bp">()</span> <span class="o">:</span> <span class="kt">unit</span> <span class="nn">Lwt</span><span class="p">.</span><span class="n">t</span> <span class="o">=</span>
  <span class="nn">Lwt</span><span class="p">.</span><span class="n">catch</span> <span class="n">monitor</span> <span class="n">handler</span>

<span class="k">let</span> <span class="o">_</span> <span class="o">=</span> <span class="nn">Lwt_main</span><span class="p">.</span><span class="n">run</span> <span class="o">(</span><span class="n">main</span> <span class="bp">()</span><span class="o">)</span>
</pre></div>
</div>
<p>Complete <code class="docutils literal notranslate"><span class="pre">loop</span></code> and <code class="docutils literal notranslate"><span class="pre">handler</span></code>. You might find the
<a class="reference external" href="https://ocsigen.org/lwt/">Lwt manual</a> to be useful.</p>
<p>To compile your code, put it in a file named <code class="docutils literal notranslate"><span class="pre">monitor.ml</span></code>. Create a dune file
for it:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>(executable
 (name monitor)
 (libraries lwt.unix))
</pre></div>
</div>
<p>And run it as usual:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>dune<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>./monitor.exe
</pre></div>
</div>
<p>To simulate a file to which lines are being added over time, open a new terminal
window and enter the following commands:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>mkfifo<span class="w"> </span>log
<span class="gp">$ </span>cat<span class="w"> </span>&gt;log
</pre></div>
</div>
<p>Now anything you type into the terminal window (after pressing return) will be
added to the file named <code class="docutils literal notranslate"><span class="pre">log</span></code>. That will enable you to interactively test your
program.</p>
<!--------------------------------------------------------------------------->
<hr class="docutils" />
<p><strong>Exercise: add opt [★★]</strong></p>
<p>Here are the definitions for the maybe monad:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="k">type</span> <span class="nc">Monad</span> <span class="o">=</span> <span class="k">sig</span>
  <span class="k">type</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span>
  <span class="k">val</span> <span class="n">return</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span>
  <span class="k">val</span> <span class="o">(</span> <span class="o">&gt;&gt;=</span> <span class="o">)</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">b</span> <span class="n">t</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">b</span> <span class="n">t</span>
<span class="k">end</span>

<span class="k">module</span> <span class="nc">Maybe</span> <span class="o">:</span> <span class="nc">Monad</span> <span class="o">=</span>
<span class="k">struct</span>
  <span class="k">type</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">=</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">option</span>

  <span class="k">let</span> <span class="n">return</span> <span class="n">x</span> <span class="o">=</span> <span class="nc">Some</span> <span class="n">x</span>

  <span class="k">let</span> <span class="o">(</span> <span class="o">&gt;&gt;=</span> <span class="o">)</span> <span class="n">m</span> <span class="n">f</span> <span class="o">=</span>
    <span class="k">match</span> <span class="n">m</span> <span class="k">with</span>
    <span class="o">|</span> <span class="nc">Some</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">f</span> <span class="n">x</span>
    <span class="o">|</span> <span class="nc">None</span> <span class="o">-&gt;</span> <span class="nc">None</span>

<span class="k">end</span>
</pre></div>
</div>
<p>Implement <code class="docutils literal notranslate"><span class="pre">add</span> <span class="pre">:</span> <span class="pre">int</span> <span class="pre">Maybe.t</span> <span class="pre">-&gt;</span> <span class="pre">int</span> <span class="pre">Maybe.t</span> <span class="pre">-&gt;</span> <span class="pre">int</span> <span class="pre">Maybe.t</span></code>. If either of the
inputs is <code class="docutils literal notranslate"><span class="pre">None</span></code>, then the output should be <code class="docutils literal notranslate"><span class="pre">None</span></code>. Otherwise, if the inputs are
<code class="docutils literal notranslate"><span class="pre">Some</span> <span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">Some</span> <span class="pre">b</span></code> then the output should be <code class="docutils literal notranslate"><span class="pre">Some</span> <span class="pre">(a+b)</span></code>. The definition of
<code class="docutils literal notranslate"><span class="pre">add</span></code> must be located outside of <code class="docutils literal notranslate"><span class="pre">Maybe</span></code>, as shown above, which means that your
solution may not use the constructors <code class="docutils literal notranslate"><span class="pre">None</span></code> or <code class="docutils literal notranslate"><span class="pre">Some</span></code> in its code.</p>
<!--------------------------------------------------------------------------->
<hr class="docutils" />
<p><strong>Exercise: fmap and join [★★]</strong></p>
<p>Here is an extended signature for monads that adds two new operations:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="k">type</span> <span class="nc">ExtMonad</span> <span class="o">=</span> <span class="k">sig</span>
  <span class="k">type</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span>
  <span class="k">val</span> <span class="n">return</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span>
  <span class="k">val</span> <span class="o">(</span> <span class="o">&gt;&gt;=</span> <span class="o">)</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">b</span> <span class="n">t</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">b</span> <span class="n">t</span>
  <span class="k">val</span> <span class="o">(</span> <span class="o">&gt;&gt;|</span> <span class="o">)</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">b</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">b</span> <span class="n">t</span>
  <span class="k">val</span> <span class="n">join</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Just as the infix operator <code class="docutils literal notranslate"><span class="pre">&gt;&gt;=</span></code> is known as <code class="docutils literal notranslate"><span class="pre">bind</span></code>, the infix operator <code class="docutils literal notranslate"><span class="pre">&gt;&gt;|</span></code> is
known as <code class="docutils literal notranslate"><span class="pre">fmap</span></code>. The two operators differ only in the return type of their
function argument.</p>
<p>Using the box metaphor, <code class="docutils literal notranslate"><span class="pre">&gt;&gt;|</span></code> takes a boxed value, and a function that only
knows how to work on unboxed values, extracts the value from the box, runs the
function on it, and boxes up that output as its own return value.</p>
<p>Also using the box metaphor, <code class="docutils literal notranslate"><span class="pre">join</span></code> takes a value that is wrapped in two boxes
and removes one of the boxes.</p>
<p>It’s possible to implement <code class="docutils literal notranslate"><span class="pre">&gt;&gt;|</span></code> and <code class="docutils literal notranslate"><span class="pre">join</span></code> directly with pattern matching (as
we already implemented <code class="docutils literal notranslate"><span class="pre">&gt;&gt;=</span></code>). It’s also possible to implement them without
pattern matching.</p>
<p>For this exercise, do the former: implement <code class="docutils literal notranslate"><span class="pre">&gt;&gt;|</span></code> and <code class="docutils literal notranslate"><span class="pre">join</span></code> as part of the
<code class="docutils literal notranslate"><span class="pre">Maybe</span></code> monad, and do not use <code class="docutils literal notranslate"><span class="pre">&gt;&gt;=</span></code> or <code class="docutils literal notranslate"><span class="pre">return</span></code> in the body of <code class="docutils literal notranslate"><span class="pre">&gt;&gt;|</span></code> or <code class="docutils literal notranslate"><span class="pre">join</span></code>.</p>
<!--------------------------------------------------------------------------->
<hr class="docutils" />
<p><strong>Exercise: fmap and join again [★★]</strong></p>
<p>Solve the previous exercise again.  This time, you must use <code class="docutils literal notranslate"><span class="pre">&gt;&gt;=</span></code> and <code class="docutils literal notranslate"><span class="pre">return</span></code>
to implement <code class="docutils literal notranslate"><span class="pre">&gt;&gt;|</span></code> and <code class="docutils literal notranslate"><span class="pre">join</span></code>, and you may not use <code class="docutils literal notranslate"><span class="pre">Some</span></code> or <code class="docutils literal notranslate"><span class="pre">None</span></code> in the body
of <code class="docutils literal notranslate"><span class="pre">&gt;&gt;|</span></code> and <code class="docutils literal notranslate"><span class="pre">join</span></code>.</p>
<!--------------------------------------------------------------------------->
<hr class="docutils" />
<p><strong>Exercise: bind from fmap+join [★★★]</strong></p>
<p>The previous exercise demonstrates that <code class="docutils literal notranslate"><span class="pre">&gt;&gt;|</span></code> and <code class="docutils literal notranslate"><span class="pre">join</span></code> can be implemented
entirely in terms of <code class="docutils literal notranslate"><span class="pre">&gt;&gt;=</span></code> (and <code class="docutils literal notranslate"><span class="pre">return</span></code>), without needing to know anything
about the representation type <code class="docutils literal notranslate"><span class="pre">'a</span> <span class="pre">t</span></code> of the monad.</p>
<p>It’s actually possible to go the other direction. That is, <code class="docutils literal notranslate"><span class="pre">&gt;&gt;=</span></code> can be
implemented using just <code class="docutils literal notranslate"><span class="pre">&gt;&gt;|</span></code> and <code class="docutils literal notranslate"><span class="pre">join</span></code>, without needing to know anything about
the representation type <code class="docutils literal notranslate"><span class="pre">'a</span> <span class="pre">t</span></code>.</p>
<p>Prove that this is so by completing the following code:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="k">type</span> <span class="nc">FmapJoinMonad</span> <span class="o">=</span> <span class="k">sig</span>
  <span class="k">type</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span>
  <span class="k">val</span> <span class="o">(</span> <span class="o">&gt;&gt;|</span> <span class="o">)</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">b</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">b</span> <span class="n">t</span>
  <span class="k">val</span> <span class="n">join</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span>
  <span class="k">val</span> <span class="n">return</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span>
<span class="k">end</span>

<span class="k">module</span> <span class="k">type</span> <span class="nc">BindMonad</span> <span class="o">=</span> <span class="k">sig</span>
  <span class="k">type</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span>
  <span class="k">val</span> <span class="n">return</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span>
  <span class="k">val</span> <span class="o">(</span> <span class="o">&gt;&gt;=</span> <span class="o">)</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">b</span> <span class="n">t</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">b</span> <span class="n">t</span>
<span class="k">end</span>

<span class="k">module</span> <span class="nc">MakeMonad</span> <span class="o">(</span><span class="nc">M</span> <span class="o">:</span> <span class="nc">FmapJoinMonad</span><span class="o">)</span> <span class="o">:</span> <span class="nc">BindMonad</span> <span class="o">=</span> <span class="k">struct</span>
  <span class="c">(* TODO *)</span>
<span class="k">end</span>
</pre></div>
</div>
<p><em>Hint: let the types be your guide.</em></p>
<!--------------------------------------------------------------------------->
<hr class="docutils" />
<p><strong>Exercise: list monad [★★★]</strong></p>
<p>We’ve seen three examples of monads already; let’s examine a fourth, the <em>list
monad</em>. The “something more” that it does is to upgrade functions to work on
lists instead of just single values. (Note, there is no notion of concurrency
intended here. It’s not that the list monad runs functions concurrently on every
element of a list. The Lwt monad does, however, provide that kind of
functionality.)</p>
<p>For example, suppose you have these functions:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">inc</span> <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>
<span class="k">let</span> <span class="n">pm</span> <span class="n">x</span> <span class="o">=</span> <span class="o">[</span><span class="n">x</span><span class="o">;</span> <span class="o">-</span><span class="n">x</span><span class="o">]</span>
</pre></div>
</div>
<p>Then the list monad could be used to apply those functions to every
element of a list and return the result as a list. For example,</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[1;</span> <span class="pre">2;</span> <span class="pre">3]</span> <span class="pre">&gt;&gt;|</span> <span class="pre">inc</span></code> is <code class="docutils literal notranslate"><span class="pre">[2;</span> <span class="pre">3;</span> <span class="pre">4]</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[1;</span> <span class="pre">2;</span> <span class="pre">3]</span> <span class="pre">&gt;&gt;=</span> <span class="pre">pm</span></code> is <code class="docutils literal notranslate"><span class="pre">[1;</span> <span class="pre">-1;</span> <span class="pre">2;</span> <span class="pre">-2;</span> <span class="pre">3;</span> <span class="pre">-3]</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[1;</span> <span class="pre">2;</span> <span class="pre">3]</span> <span class="pre">&gt;&gt;=</span> <span class="pre">pm</span> <span class="pre">&gt;&gt;|</span> <span class="pre">inc</span></code> is <code class="docutils literal notranslate"><span class="pre">[2;</span> <span class="pre">0;</span> <span class="pre">3;</span> <span class="pre">-1;</span> <span class="pre">4;</span> <span class="pre">-2]</span></code>.</p></li>
</ul>
<p>One way to think about this is that the list monad operators take a list of
inputs to a function, run the function on all those inputs, and give you back
the combined list of outputs.</p>
<p>Complete the following definition of the list monad:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="k">type</span> <span class="nc">ExtMonad</span> <span class="o">=</span> <span class="k">sig</span>
  <span class="k">type</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span>
  <span class="k">val</span> <span class="n">return</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span>
  <span class="k">val</span> <span class="o">(</span> <span class="o">&gt;&gt;=</span> <span class="o">)</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">b</span> <span class="n">t</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">b</span> <span class="n">t</span>
  <span class="k">val</span> <span class="o">(</span> <span class="o">&gt;&gt;|</span> <span class="o">)</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">b</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">b</span> <span class="n">t</span>
  <span class="k">val</span> <span class="n">join</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span>
<span class="k">end</span>

<span class="k">module</span> <span class="nc">ListMonad</span> <span class="o">:</span> <span class="nc">ExtMonad</span> <span class="o">=</span> <span class="k">struct</span>
  <span class="k">type</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">=</span> <span class="k">&#39;</span><span class="n">a</span> <span class="kt">list</span>

  <span class="c">(* TODO *)</span>
<span class="k">end</span>
</pre></div>
</div>
<p><em>Hints:</em> Leave <code class="docutils literal notranslate"><span class="pre">&gt;&gt;=</span></code> for last.  Let the types be your guide.  There are
two very useful list library functions that can help you.</p>
<!--------------------------------------------------------------------------->
<hr class="docutils" />
<p><strong>Exercise: trivial monad laws [★★★]</strong></p>
<p>Here is the world’s most trivial monad. All it does is wrap a value inside a
constructor.</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="nc">Trivial</span> <span class="o">:</span> <span class="nc">Monad</span> <span class="o">=</span> <span class="k">struct</span>
  <span class="k">type</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">=</span> <span class="nc">Wrap</span> <span class="k">of</span> <span class="k">&#39;</span><span class="n">a</span>
  <span class="k">let</span> <span class="n">return</span> <span class="n">x</span> <span class="o">=</span> <span class="nc">Wrap</span> <span class="n">x</span>
  <span class="k">let</span> <span class="o">(</span> <span class="o">&gt;&gt;=</span> <span class="o">)</span> <span class="o">(</span><span class="nc">Wrap</span> <span class="n">x</span><span class="o">)</span> <span class="n">f</span> <span class="o">=</span> <span class="n">f</span> <span class="n">x</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Prove that the three monad laws, as formulated using <code class="docutils literal notranslate"><span class="pre">&gt;&gt;=</span></code> and <code class="docutils literal notranslate"><span class="pre">return</span></code>, hold
for the trivial monad.</p>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "cs3110/textbook",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapters/conc"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="summary.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">7.9. </span>Summary</p>
      </div>
    </a>
    <a class="right-next"
       href="../correctness/intro.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">8. </span>Correctness</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Michael R. Clarkson et al.
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2026.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=bd9e20870c6007c4c509"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=bd9e20870c6007c4c509"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>