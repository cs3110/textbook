

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>6.3. Module Documentation &#8212; OCaml Programming: Correct + Efficient + Beautiful</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=bd9e20870c6007c4c509" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=bd9e20870c6007c4c509" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=bd9e20870c6007c4c509"></script>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/correctness/module_docs';</script>
    <link rel="shortcut icon" href="../../_static/op.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="6.4. Testing and Debugging" href="test_debug.html" />
    <link rel="prev" title="6.2. Function Documentation" href="function_docs.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <header>
  
    <div class="bd-header navbar navbar-expand-lg bd-navbar">
    </div>
  
  </header>

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../cover.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/op_title.png" class="logo__image only-light" alt="OCaml Programming: Correct + Efficient + Beautiful - Home"/>
    <script>document.write(`<img src="../../_static/op_title.png" class="logo__image only-dark" alt="OCaml Programming: Correct + Efficient + Beautiful - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Preface</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../preface/about.html">About This Book</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preface/install.html">Installing OCaml</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../intro/intro.html">1. Better Programming Through OCaml</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro/past.html">1.1. The Past of OCaml</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/present.html">1.2. The Present of OCaml</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/future.html">1.3. Look to Your Future</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/3110.html">1.4. A Brief History of CS 3110</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/summary.html">1.5. Summary</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../basics/intro.html">2. The Basics of OCaml</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../basics/toplevel.html">2.1. The OCaml Toplevel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/compiling.html">2.2. Compiling OCaml Programs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/expressions.html">2.3. Expressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/functions.html">2.4. Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/documentation.html">2.5. Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/printing.html">2.6. Printing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/debugging.html">2.7. Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/summary.html">2.8. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/exercises.html">2.9. Exercises</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">OCaml Programming</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../data/intro.html">3. Data and Types</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../data/lists.html">3.1. Lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/variants.html">3.2. Variants</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/ounit.html">3.3. Unit Testing with OUnit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/records_tuples.html">3.4. Records and Tuples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/pattern_matching_advanced.html">3.5. Advanced Pattern Matching</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/type_synonym.html">3.6. Type Synonyms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/options.html">3.7. Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/assoc_list.html">3.8. Association Lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/algebraic_data_types.html">3.9. Algebraic Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/exceptions.html">3.10. Exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/trees.html">3.11. Example: Trees</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/nats.html">3.12. Example: Natural Numbers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/summary.html">3.13. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/exercises.html">3.14. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../hop/intro.html">4. Higher-Order Programming</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../hop/higher_order.html">4.1. Higher-Order Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/map.html">4.2. Map</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/filter.html">4.3. Filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/fold.html">4.4. Fold</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/beyond_lists.html">4.5. Beyond Lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/pipelining.html">4.6. Pipelining</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/currying.html">4.7. Currying</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/summary.html">4.8. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/exercises.html">4.9. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../modules/intro.html">5. Modular Programming</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/module_systems.html">5.1. Module Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/modules.html">5.2. Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/toplevel.html">5.3. Modules and the Toplevel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/encapsulation.html">5.4. Encapsulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/compilation_units.html">5.5. Compilation Units</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/functional_data_structures.html">5.6. Functional Data Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/module_type_constraints.html">5.7. Module Type Constraints</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/includes.html">5.8. Includes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/functors.html">5.9. Functors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/summary.html">5.10. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/exercises.html">5.11. Exercises</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Correctness and Efficiency</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="intro.html">6. Correctness</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="specifications.html">6.1. Specifications</a></li>
<li class="toctree-l2"><a class="reference internal" href="function_docs.html">6.2. Function Documentation</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">6.3. Module Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_debug.html">6.4. Testing and Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="black_glass_box.html">6.5. Black-box and Glass-box Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="randomized.html">6.6. Randomized Testing with QCheck</a></li>
<li class="toctree-l2"><a class="reference internal" href="proving_correctness.html">6.7. Proving Correctness</a></li>
<li class="toctree-l2"><a class="reference internal" href="structural_induction.html">6.8. Structural Induction</a></li>
<li class="toctree-l2"><a class="reference internal" href="eq_spec.html">6.9. Equational Specification</a></li>
<li class="toctree-l2"><a class="reference internal" href="summary.html">6.10. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="exercises.html">6.11. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../mut/intro.html">7. Mutability</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../mut/refs.html">7.1. Refs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mut/mutable_fields.html">7.2. Mutable Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mut/arrays.html">7.3. Arrays and Loops</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mut/summary.html">7.4. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mut/exercises.html">7.5. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ds/intro.html">8. Data Structures</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ds/hash_tables.html">8.1. Hash Tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/amortized.html">8.2. Amortized Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/rb.html">8.3. Red-Black Trees</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/sequence.html">8.4. Sequences</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/memoization.html">8.5. Memoization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/parrays.html">8.6. Persistent Arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/promises.html">8.7. Promises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/monads.html">8.8. Monads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/summary.html">8.9. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/exercises.html">8.10. Exercises</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Language Implementation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../interp/intro.html">9. Interpreters</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../interp/calculator.html">9.1. Example: Calculator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/parsing.html">9.2. Parsing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/substitution.html">9.3. Substitution Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/environment.html">9.4. Environment Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/typecheck.html">9.5. Type Checking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/inference.html">9.6. Type Inference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/summary.html">9.7. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/exercises.html">9.8. Exercises</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Lagniappe</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../adv/curry-howard.html">The Curry-Howard Correspondence</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../appendix/bigoh.html">Big-Oh Notation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/vm.html">Virtual Machine</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/cs3110/textbook/main?urlpath=tree/src/chapters/correctness/module_docs.md" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/cs3110/textbook" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/cs3110/textbook/edit/main/src/chapters/correctness/module_docs.md" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/cs3110/textbook/issues/new?title=Issue%20on%20page%20%2Fchapters/correctness/module_docs.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/chapters/correctness/module_docs.ipynb" target="_blank"
   class="btn btn-sm btn-download-notebook-button dropdown-item"
   title="Download notebook file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li><a href="../../_sources/chapters/correctness/module_docs.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Module Documentation</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#abstraction-functions">6.3.1. Abstraction Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementing-the-abstraction-function">6.3.2. Implementing the Abstraction Function</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#commutative-diagrams">6.3.3. Commutative Diagrams</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#representation-invariants">6.3.4. Representation Invariants</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementing-the-representation-invariant">6.3.5. Implementing the Representation Invariant</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="module-documentation">
<h1><span class="section-number">6.3. </span>Module Documentation<a class="headerlink" href="#module-documentation" title="Permalink to this heading">#</a></h1>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/4OTspWNefn4" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>The specification of functions provided by a module can be found in its
interface, which is what clients will consult. But what about <em>internal</em>
documentation, which is relevant to those who implement and maintain a module?
The purpose of such implementation comments is to explain to the reader how the
implementation correctly implements its interface.</p>
<div class="admonition-reminder admonition">
<p class="admonition-title">Reminder</p>
<p>It is inappropriate to copy the specifications of functions found in the module
interface into the module implementation. Copying runs the risk of introducing
inconsistency as the program evolves, because programmers don’t keep the copies
in sync. Copying code and specifications is a major source (if not <em>the</em> major
source) of program bugs. In any case, implementers can always look at the
interface for the specification.</p>
</div>
<p>Implementation comments fall into two categories. The first category arises
because a module implementation may define new types and functions that are
purely internal to the module. If their significance is not obvious, these types
and functions should be documented in much the same style that we have suggested
for documenting interfaces. Often, as the code is written, it becomes apparent
that the new types and functions defined in the module form an internal data
abstraction or at least a collection of functionality that makes sense as a
module in its own right. This is a signal that the internal data abstraction
might be moved to a separate module and manipulated only through its operations.</p>
<p>The second category of implementation comments is associated with the use of
<em>data abstraction</em>. Suppose we are implementing an abstraction for a set of
items of type <code class="docutils literal notranslate"><span class="pre">'a</span></code>. The interface might look something like this:</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="c">(** A set is an unordered collection in which multiplicity is ignored. *)</span>
<span class="k">module</span> <span class="k">type</span> <span class="nc">Set</span> <span class="o">=</span> <span class="k">sig</span>

  <span class="c">(** [&#39;a t] represents a set whose elements are of type [&#39;a]. *)</span>
  <span class="k">type</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span>

  <span class="c">(** [empty] is the set containing no elements. *)</span>
  <span class="k">val</span> <span class="n">empty</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span>

  <span class="c">(** [mem x s] is whether [x] is a member of set [s]. *)</span>
  <span class="k">val</span> <span class="n">mem</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="kt">bool</span>

  <span class="c">(** [add x s] is the set containing all the elements of [s]</span>
<span class="c">      as well as [x]. *)</span>
  <span class="k">val</span> <span class="n">add</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span>

  <span class="c">(** [rem x s] is the set containing all the elements of [s],</span>
<span class="c">      minus [x]. *)</span>
  <span class="k">val</span> <span class="n">rem</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span>

  <span class="c">(** [size s] is the cardinality of [s]. *)</span>
  <span class="k">val</span> <span class="n">size</span><span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="kt">int</span>

  <span class="c">(** [union s1 s2] is the set containing all the elements that</span>
<span class="c">      are in either [s1] or [s2]. *)</span>
  <span class="k">val</span> <span class="n">union</span><span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span>

  <span class="c">(** [inter s1 s2] is the set containing all the elements that</span>
<span class="c">      are in both [s1] and [s2]. *)</span>
  <span class="k">val</span> <span class="n">inter</span><span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>module type Set =
  sig
    type &#39;a t
    val empty : &#39;a t
    val mem : &#39;a -&gt; &#39;a t -&gt; bool
    val add : &#39;a -&gt; &#39;a t -&gt; &#39;a t
    val rem : &#39;a -&gt; &#39;a t -&gt; &#39;a t
    val size : &#39;a t -&gt; int
    val union : &#39;a t -&gt; &#39;a t -&gt; &#39;a t
    val inter : &#39;a t -&gt; &#39;a t -&gt; &#39;a t
  end
</pre></div>
</div>
</div>
</details>
</div>
<p>In a real signature for sets, we’d want operations such as <code class="docutils literal notranslate"><span class="pre">map</span></code> and <code class="docutils literal notranslate"><span class="pre">fold</span></code> as
well, but let’s omit these for now for simplicity. There are many ways to
implement this abstraction.</p>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/abtrrowewaw" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>As we’ve seen before, one easy way is as a list:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="c">(** Implementation of sets as lists with duplicates. *)</span>
<span class="k">module</span> <span class="nc">ListSet</span> <span class="o">:</span> <span class="nc">Set</span> <span class="o">=</span> <span class="k">struct</span>
  <span class="k">type</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">=</span> <span class="k">&#39;</span><span class="n">a</span> <span class="kt">list</span>
  <span class="k">let</span> <span class="n">empty</span> <span class="o">=</span> <span class="bp">[]</span>
  <span class="k">let</span> <span class="n">mem</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">mem</span>
  <span class="k">let</span> <span class="n">add</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">cons</span>
  <span class="k">let</span> <span class="n">rem</span> <span class="n">x</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">filter</span> <span class="o">((</span> <span class="o">&lt;&gt;</span> <span class="o">)</span> <span class="n">x</span><span class="o">)</span>
  <span class="k">let</span> <span class="n">size</span> <span class="n">lst</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="o">(</span><span class="n">lst</span> <span class="o">|&gt;</span> <span class="n">sort_uniq</span> <span class="nn">Stdlib</span><span class="p">.</span><span class="n">compare</span> <span class="o">|&gt;</span> <span class="n">length</span><span class="o">)</span>
  <span class="k">let</span> <span class="n">union</span> <span class="n">lst1</span> <span class="n">lst2</span> <span class="o">=</span> <span class="n">lst1</span> <span class="o">@</span> <span class="n">lst2</span>
  <span class="k">let</span> <span class="n">inter</span> <span class="n">lst1</span> <span class="n">lst2</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">filter</span> <span class="o">(</span><span class="k">fun</span> <span class="n">h</span> <span class="o">-&gt;</span> <span class="n">mem</span> <span class="n">h</span> <span class="n">lst2</span><span class="o">)</span> <span class="n">lst1</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>module ListSet : Set
</pre></div>
</div>
</div>
</div>
<p>This implementation has the advantage of simplicity. For small sets that tend
not to have duplicate elements, it will be a fine choice. Its performance will
be poor for large sets or applications with many duplicates but for some
applications that’s not an issue.</p>
<p>Notice that the types of the functions do not need to be written down in the
implementation. They aren’t needed because they’re already present in the
signature, just like the specifications that are also in the signature don’t
need to be replicated in the structure.</p>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/n8irzSGGVao" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>Here is another implementation of <code class="docutils literal notranslate"><span class="pre">Set</span></code> that also uses <code class="docutils literal notranslate"><span class="pre">'a</span> <span class="pre">list</span></code> but requires
the lists to contain no duplicates. This implementation is also correct (and
also slow for large sets). Notice that we are using the same representation
type, yet some important aspects of the implementation (<code class="docutils literal notranslate"><span class="pre">add</span></code>, <code class="docutils literal notranslate"><span class="pre">size</span></code>,
<code class="docutils literal notranslate"><span class="pre">union</span></code>) are quite different.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="c">(** Implementation of sets as lists without duplicates. *)</span>
<span class="k">module</span> <span class="nc">UniqListSet</span> <span class="o">:</span> <span class="nc">Set</span> <span class="o">=</span> <span class="k">struct</span>
  <span class="k">type</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">=</span> <span class="k">&#39;</span><span class="n">a</span> <span class="kt">list</span>
  <span class="k">let</span> <span class="n">empty</span> <span class="o">=</span> <span class="bp">[]</span>
  <span class="k">let</span> <span class="n">mem</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">mem</span>
  <span class="k">let</span> <span class="n">add</span> <span class="n">x</span> <span class="n">lst</span> <span class="o">=</span> <span class="k">if</span> <span class="n">mem</span> <span class="n">x</span> <span class="n">lst</span> <span class="k">then</span> <span class="n">lst</span> <span class="k">else</span> <span class="n">x</span> <span class="o">::</span> <span class="n">lst</span>
  <span class="k">let</span> <span class="n">rem</span> <span class="n">x</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">filter</span> <span class="o">((</span> <span class="o">&lt;&gt;</span> <span class="o">)</span> <span class="n">x</span><span class="o">)</span>
  <span class="k">let</span> <span class="n">size</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">length</span>
  <span class="k">let</span> <span class="n">union</span> <span class="n">lst1</span> <span class="n">lst2</span> <span class="o">=</span> <span class="n">lst1</span> <span class="o">@</span> <span class="n">lst2</span> <span class="o">|&gt;</span> <span class="nn">List</span><span class="p">.</span><span class="n">sort_uniq</span> <span class="nn">Stdlib</span><span class="p">.</span><span class="n">compare</span>
  <span class="k">let</span> <span class="n">inter</span> <span class="n">lst1</span> <span class="n">lst2</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">filter</span> <span class="o">(</span><span class="k">fun</span> <span class="n">h</span> <span class="o">-&gt;</span> <span class="n">mem</span> <span class="n">h</span> <span class="n">lst2</span><span class="o">)</span> <span class="n">lst1</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>module UniqListSet : Set
</pre></div>
</div>
</div>
</div>
<p>An important reason why we introduced the writing of function specifications was
to enable <em>local reasoning</em>: once a function has a spec, we can judge whether
the function does what it is supposed to without looking at the rest of the
program. We can also judge whether the rest of the program works without looking
at the code of the function. However, we cannot reason locally about the
individual functions in the three module implementations just given. The problem
is that we don’t have enough information about the relationship between the
concrete type (<code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">list</span></code>) and the corresponding abstract type (<code class="docutils literal notranslate"><span class="pre">set</span></code>). This
lack of information can be addressed by adding two new kinds of comments to the
implementation: the <em>abstraction function</em> and the <em>representation invariant</em>
for the abstract data type. We turn to discussion of those, next.</p>
<section id="abstraction-functions">
<h2><span class="section-number">6.3.1. </span>Abstraction Functions<a class="headerlink" href="#abstraction-functions" title="Permalink to this heading">#</a></h2>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/ZYYa66804Q4" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>The client of any <code class="docutils literal notranslate"><span class="pre">Set</span></code> implementation should not be able to distinguish it from
any other implementation based on its functional behavior. As far as the client
can tell, the operations act like operations on the mathematical ideal of a set.
In the first implementation, the lists <code class="docutils literal notranslate"><span class="pre">[3;</span> <span class="pre">1]</span></code>, <code class="docutils literal notranslate"><span class="pre">[1;</span> <span class="pre">3]</span></code>, and <code class="docutils literal notranslate"><span class="pre">[1;</span> <span class="pre">1;</span> <span class="pre">3]</span></code> are
distinguishable to the implementer, but not to the client. To the client, they
all represent the abstract set {1, 3} and cannot be distinguished by any of the
operations of the <code class="docutils literal notranslate"><span class="pre">Set</span></code> signature. From the point of view of the client, the
abstract data type describes a set of abstract values and associated operations.
The implementer knows that these abstract values are represented by concrete
values that may contain additional information invisible from the client’s view.
This loss of information is described by the <em>abstraction function</em>, which is a
mapping from the space of concrete values to the abstract space. The abstraction
function for the implementation <code class="docutils literal notranslate"><span class="pre">ListSet</span></code> looks like this:</p>
<p><img alt="af-listset" src="../../_images/abst-fcn2.png" /></p>
<p>Notice that several concrete values may map to a single abstract value;
that is, the abstraction function may be <em>many-to-one</em>. It is also
possible that some concrete values do not map to any abstract value; the
abstraction function may be <em>partial</em>. That is not the case with <code class="docutils literal notranslate"><span class="pre">ListSet</span></code>,
but it might be with other implementations.</p>
<p>The abstraction function is important for deciding whether an
implementation is correct, therefore it belongs as a comment in the
implementation of any abstract data type. For example, in the <code class="docutils literal notranslate"><span class="pre">ListSet</span></code>
module, we could document the abstraction function as follows:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="nc">ListSet</span> <span class="o">:</span> <span class="nc">Set</span> <span class="o">=</span> <span class="k">struct</span>
  <span class="c">(** Abstraction function: The list [[a1; ...; an]] represents the</span>
<span class="c">      set [{b1, ..., bm}], where [[b1; ...; bm]] is the same list as</span>
<span class="c">      [[a1; ...; an]] but with any duplicates removed. The empty list</span>
<span class="c">      [[]] represents the empty set [{}]. *)</span>
  <span class="k">type</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">=</span> <span class="k">&#39;</span><span class="n">a</span> <span class="kt">list</span>
  <span class="o">...</span>
<span class="k">end</span>
</pre></div>
</div>
<p>This comment explicitly points out that the list may contain duplicates, which
is helpful as a reinforcement of the first sentence. Similarly, the case of an
empty list is mentioned explicitly for clarity, although some might consider it
to be redundant.</p>
<p>The abstraction function for the second implementation, which does not allow
duplicates, hints at an important difference. We can write the abstraction
function for this second representation a bit more simply because we know that
the elements are distinct.</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="nc">UniqListSet</span> <span class="o">:</span> <span class="nc">Set</span> <span class="o">=</span> <span class="k">struct</span>
  <span class="c">(** Abstraction function: The list [[a1; ...; an]] represents the set</span>
<span class="c">      [{a1, ..., an}]. The empty list [[]] represents the empty set [{}]. *)</span>
  <span class="k">type</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">=</span> <span class="k">&#39;</span><span class="n">a</span> <span class="kt">list</span>
  <span class="o">...</span>
<span class="k">end</span>
</pre></div>
</div>
</section>
<section id="implementing-the-abstraction-function">
<h2><span class="section-number">6.3.2. </span>Implementing the Abstraction Function<a class="headerlink" href="#implementing-the-abstraction-function" title="Permalink to this heading">#</a></h2>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/ebcnwXuWPI0" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>What would it mean to implement the abstraction function for <code class="docutils literal notranslate"><span class="pre">ListSet</span></code>? We’d
want a function that took an input of type <code class="docutils literal notranslate"><span class="pre">'a</span> <span class="pre">ListSet.t</span></code>. But what should its
output type be? The abstract values are mathematical sets, not OCaml types. If
we did hypothetically have a type <code class="docutils literal notranslate"><span class="pre">'a</span> <span class="pre">set</span></code> that our abstraction function could
return, there would have been little point in developing <code class="docutils literal notranslate"><span class="pre">ListSet</span></code>; we could
have just used that <code class="docutils literal notranslate"><span class="pre">'a</span> <span class="pre">set</span></code> type without doing any work of our own.</p>
<p>On the other hand, we might implement something close to the abstraction
function by converting an input of type <code class="docutils literal notranslate"><span class="pre">'a</span> <span class="pre">ListSet.t</span></code> to a built-in OCaml type
or standard library type:</p>
<ul class="simple">
<li><p>We could convert to a <code class="docutils literal notranslate"><span class="pre">string</span></code>. That would have the advantage of being easily
readable by humans in the toplevel or in debug output. Java programmers use
<code class="docutils literal notranslate"><span class="pre">toString()</span></code> for similar purposes.</p></li>
<li><p>We could convert to <code class="docutils literal notranslate"><span class="pre">'a</span> <span class="pre">list</span></code>. (Actually there’s little conversion to be
done). For data collections this is a convenient choice, since lists can at
least approximately represent many data structures: stacks, queues,
dictionaries, sets, heaps, etc.</p></li>
</ul>
<p>The following functions implement those ideas.  Note that <code class="docutils literal notranslate"><span class="pre">to_string</span></code> has
to take an additional argument <code class="docutils literal notranslate"><span class="pre">string_of_val</span></code> from the client to convert
<code class="docutils literal notranslate"><span class="pre">'a</span></code> to <code class="docutils literal notranslate"><span class="pre">string</span></code>.</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="nc">ListSet</span> <span class="o">:</span> <span class="nc">Set</span> <span class="o">=</span> <span class="k">struct</span>
  <span class="o">...</span>

  <span class="k">let</span> <span class="n">uniq</span> <span class="n">lst</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">sort_uniq</span> <span class="nn">Stdlib</span><span class="p">.</span><span class="n">compare</span> <span class="n">lst</span>

  <span class="k">let</span> <span class="n">to_string</span> <span class="n">string_of_val</span> <span class="n">lst</span> <span class="o">=</span>
    <span class="k">let</span> <span class="n">interior</span> <span class="o">=</span>
      <span class="n">lst</span> <span class="o">|&gt;</span> <span class="n">uniq</span> <span class="o">|&gt;</span> <span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="n">string_of_val</span> <span class="o">|&gt;</span> <span class="nn">String</span><span class="p">.</span><span class="n">concat</span> <span class="s2">&quot;, &quot;</span>
    <span class="k">in</span>
    <span class="s2">&quot;{&quot;</span> <span class="o">^</span> <span class="n">interior</span> <span class="o">^</span> <span class="s2">&quot;}&quot;</span>

  <span class="k">let</span> <span class="n">to_list</span> <span class="o">=</span> <span class="n">uniq</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Installing a custom formatter, as discussed in the
<a class="reference internal" href="../modules/encapsulation.html"><span class="doc std std-doc">section on encapsulation</span></a>, could also be understood as implementing the
abstraction function. But in that case it’s usable only by humans at the
toplevel rather than other code, programmatically.</p>
</section>
<section id="commutative-diagrams">
<h2><span class="section-number">6.3.3. </span>Commutative Diagrams<a class="headerlink" href="#commutative-diagrams" title="Permalink to this heading">#</a></h2>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/PKAgq97NBdg" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>Using the abstraction function, we can now talk about what it means for an
implementation of an abstraction to be <em>correct</em>. It is correct exactly when
every operation that takes place in the concrete space makes sense when mapped
by the abstraction function into the abstract space. This can be visualized as a
<em>commutative diagram</em>:</p>
<p><img alt="commutative-diagram" src="../../_images/commutation.png" /></p>
<p>A commutative diagram means that if we take the two paths around the diagram, we
have to get to the same place. Suppose that we start from a concrete value and
apply the actual implementation of some operation to it to obtain a new concrete
value or values. When viewed abstractly, a concrete result should be an abstract
value that is a possible result of applying the function <em>as described in its
specification</em> to the abstract view of the actual inputs. For example, consider
the union function from the implementation of sets as lists with repeated
elements covered last time. When this function is applied to the concrete pair
[1; 3], [2; 2], it corresponds to the lower-left corner of the diagram. The
result of this operation is the list [2; 2; 1; 3], whose corresponding abstract
value is the set {1, 2, 3}. Note that if we apply the abstraction function AF
to the input lists [1; 3] and [2; 2], we have the sets {1, 3} and {2}. The
commutative diagram requires that in this instance the union of {1, 3} and {2}
is {1, 2, 3}, which is of course true.</p>
</section>
<section id="representation-invariants">
<h2><span class="section-number">6.3.4. </span>Representation Invariants<a class="headerlink" href="#representation-invariants" title="Permalink to this heading">#</a></h2>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/mEtR4YGMRPY" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>The abstraction function explains how information within the module is viewed
abstractly by module clients. But that is not all we need to know to ensure
correctness of the implementation. Consider the <code class="docutils literal notranslate"><span class="pre">size</span></code> function in each of the
two implementations. For <code class="docutils literal notranslate"><span class="pre">ListSet</span></code>, which allows duplicates, we need to be sure
not to double-count duplicate elements:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">size</span> <span class="n">lst</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="o">(</span><span class="n">lst</span> <span class="o">|&gt;</span> <span class="n">sort_uniq</span> <span class="nn">Stdlib</span><span class="p">.</span><span class="n">compare</span> <span class="o">|&gt;</span> <span class="n">length</span><span class="o">)</span>
</pre></div>
</div>
<p>But for <code class="docutils literal notranslate"><span class="pre">UniqListSet</span></code>, in which the lists have no duplicates, the size is just
the length of the list:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">size</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">length</span>
</pre></div>
</div>
<p>How do we know that latter implementation is correct? That is, how do we know
that “lists have no duplicates”? It’s hinted at by the name of the module, and
it can be deduced from the implementation of <code class="docutils literal notranslate"><span class="pre">add</span></code>, but we’ve never carefully
documented it. Right now, the code does not explicitly say that there are no
duplicates.</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">UniqListSet</span></code> representation, not all concrete data items represent
abstract data items. That is, the <em>domain</em> of the abstraction function does not
include all possible lists. There are some lists, such as <code class="docutils literal notranslate"><span class="pre">[1;</span> <span class="pre">1;</span> <span class="pre">2]</span></code>, that
contain duplicates and must never occur in the representation of a set in the
<code class="docutils literal notranslate"><span class="pre">UniqListSet</span></code> implementation; the abstraction function is undefined on such
lists. We need to include a second piece of information, the <em>representation
invariant</em> (or <em>rep invariant</em>, or <em>RI</em>), to determine which concrete data items
are valid representations of abstract data items. For sets represented as lists
without duplicates, we write this as part of the comment together with the
abstraction function:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="nc">UniqListSet</span> <span class="o">:</span> <span class="nc">Set</span> <span class="o">=</span> <span class="k">struct</span>
  <span class="c">(** Abstraction function: the list [[a1; ...; an]] represents the set</span>
<span class="c">      [{a1, ..., an}].  The empty list [[]] represents the empty set [{}].</span>
<span class="c">      Representation invariant: the list contains no duplicates. *)</span>
  <span class="k">type</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">=</span> <span class="k">&#39;</span><span class="n">a</span> <span class="kt">list</span>
  <span class="o">...</span>
<span class="k">end</span>
</pre></div>
</div>
<p>If we think about this issue in terms of the commutative diagram, we see that
there is a crucial property that is necessary to ensure correctness: namely,
that all concrete operations preserve the representation invariant. If this
constraint is broken, functions such as <code class="docutils literal notranslate"><span class="pre">size</span></code> will not return the correct
answer. The relationship between the representation invariant and the
abstraction function is depicted in this figure:</p>
<p><img alt="af-and-ri" src="../../_images/ri-af.png" /></p>
<p>We can use the rep invariant and abstraction function to judge whether the
implementation of a single operation is correct <em>in isolation from the rest of
the functions in the module</em>. A function is correct if these conditions:</p>
<ol class="arabic simple">
<li><p>The function’s preconditions hold of the argument values.</p></li>
<li><p>The concrete representations of the arguments satisfy the rep invariant.</p></li>
</ol>
<p>imply these conditions:</p>
<ol class="arabic simple">
<li><p>All new representation values created satisfy the rep invariant.</p></li>
<li><p>The commutative diagram holds.</p></li>
</ol>
<p>The rep invariant makes it easier to write code that is provably correct,
because it means that we don’t have to write code that works for all possible
incoming concrete representations—only those that satisfy the rep
invariant. For example, in the implementation <code class="docutils literal notranslate"><span class="pre">UniqListSet</span></code>, we do not care what
the code does on lists that contain duplicate elements. However, we do need to
be concerned that on return, we only produce values that satisfy the rep
invariant. As suggested in the figure above, if the rep invariant holds for the
input values, then it should hold for the output values, which is why we call it
an <em>invariant</em>.</p>
</section>
<section id="implementing-the-representation-invariant">
<h2><span class="section-number">6.3.5. </span>Implementing the Representation Invariant<a class="headerlink" href="#implementing-the-representation-invariant" title="Permalink to this heading">#</a></h2>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/4bfh_aONcRc" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>When implementing a complex abstract data type, it is often helpful to write an
internal function that can be used to check that the rep invariant holds of a
given data item. By convention, we will call this function <code class="docutils literal notranslate"><span class="pre">rep_ok</span></code>. If the
module accepts values of the abstract type that are created outside the module,
say by exposing the implementation of the type in the signature, then <code class="docutils literal notranslate"><span class="pre">rep_ok</span></code>
should be applied to these to ensure the representation invariant is satisfied.
In addition, if the implementation creates any new values of the abstract type,
<code class="docutils literal notranslate"><span class="pre">rep_ok</span></code> can be applied to them as a sanity check. With this approach, bugs are
caught early, and a bug in one function is less likely to create the appearance
of a bug in another.</p>
<p>A convenient way to write <code class="docutils literal notranslate"><span class="pre">rep_ok</span></code> is to make it an identity function that just
returns the input value if the rep invariant holds and raises an exception if it
fails.</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="c">(* Checks whether x satisfies the representation invariant. *)</span>
<span class="k">let</span> <span class="n">rep_ok</span> <span class="n">x</span> <span class="o">=</span>
  <span class="k">if</span> <span class="c">(* check the RI holds of x *)</span> <span class="k">then</span> <span class="n">x</span> <span class="k">else</span> <span class="n">failwith</span> <span class="s2">&quot;RI violated&quot;</span>
</pre></div>
</div>
<p>Here is an implementation of <code class="docutils literal notranslate"><span class="pre">Set</span></code> that uses the same data representation as
<code class="docutils literal notranslate"><span class="pre">UniqListSet</span></code>, but includes copious <code class="docutils literal notranslate"><span class="pre">rep_ok</span></code> checks. Note that <code class="docutils literal notranslate"><span class="pre">rep_ok</span></code> is
applied to all input sets and to any set that is ever created. This ensures that
if a bad set representation is created, it will be detected immediately. In case
we somehow missed a check on creation, we also apply <code class="docutils literal notranslate"><span class="pre">rep_ok</span></code> to incoming set
arguments. If there is a bug, these checks will help us quickly figure out where
the rep invariant is being broken.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="c">(** Implementation of sets as lists without duplicates. *)</span>
<span class="k">module</span> <span class="nc">UniqListSet</span> <span class="o">:</span> <span class="nc">Set</span> <span class="o">=</span> <span class="k">struct</span>

  <span class="c">(** Abstraction function: The list [[a1; ...; an]] represents the</span>
<span class="c">      set [{a1, ..., an}]. The empty list [[]] represents the empty set [{}].</span>
<span class="c">      Representation invariant: the list contains no duplicates. *)</span>
  <span class="k">type</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">=</span> <span class="k">&#39;</span><span class="n">a</span> <span class="kt">list</span>

  <span class="k">let</span> <span class="n">rep_ok</span> <span class="n">lst</span> <span class="o">=</span>
    <span class="k">let</span> <span class="n">u</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">sort_uniq</span> <span class="nn">Stdlib</span><span class="p">.</span><span class="n">compare</span> <span class="n">lst</span> <span class="k">in</span>
    <span class="k">match</span> <span class="nn">List</span><span class="p">.</span><span class="n">compare_lengths</span> <span class="n">lst</span> <span class="n">u</span> <span class="k">with</span> <span class="mi">0</span> <span class="o">-&gt;</span> <span class="n">lst</span> <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">failwith</span> <span class="s2">&quot;RI&quot;</span>

  <span class="k">let</span> <span class="n">empty</span> <span class="o">=</span> <span class="bp">[]</span>

  <span class="k">let</span> <span class="n">mem</span> <span class="n">x</span> <span class="n">lst</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">mem</span> <span class="n">x</span> <span class="o">(</span><span class="n">rep_ok</span> <span class="n">lst</span><span class="o">)</span>

  <span class="k">let</span> <span class="n">add</span> <span class="n">x</span> <span class="n">lst</span> <span class="o">=</span> <span class="n">rep_ok</span> <span class="o">(</span><span class="k">if</span> <span class="n">mem</span> <span class="n">x</span> <span class="o">(</span><span class="n">rep_ok</span> <span class="n">lst</span><span class="o">)</span> <span class="k">then</span> <span class="n">lst</span> <span class="k">else</span> <span class="n">x</span> <span class="o">::</span> <span class="n">lst</span><span class="o">)</span>

  <span class="k">let</span> <span class="n">rem</span> <span class="n">x</span> <span class="n">lst</span> <span class="o">=</span> <span class="n">rep_ok</span> <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">filter</span> <span class="o">((</span> <span class="o">&lt;&gt;</span> <span class="o">)</span> <span class="n">x</span><span class="o">)</span> <span class="o">(</span><span class="n">rep_ok</span> <span class="n">lst</span><span class="o">))</span>

  <span class="k">let</span> <span class="n">size</span> <span class="n">lst</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">length</span> <span class="o">(</span><span class="n">rep_ok</span> <span class="n">lst</span><span class="o">)</span>

  <span class="k">let</span> <span class="n">union</span> <span class="n">lst1</span> <span class="n">lst2</span> <span class="o">=</span>
    <span class="n">rep_ok</span>
      <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">fold_left</span>
         <span class="o">(</span><span class="k">fun</span> <span class="n">u</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="k">if</span> <span class="n">mem</span> <span class="n">x</span> <span class="n">lst2</span> <span class="k">then</span> <span class="n">u</span> <span class="k">else</span> <span class="n">x</span> <span class="o">::</span> <span class="n">u</span><span class="o">)</span>
         <span class="o">(</span><span class="n">rep_ok</span> <span class="n">lst2</span><span class="o">)</span> <span class="o">(</span><span class="n">rep_ok</span> <span class="n">lst1</span><span class="o">))</span>

  <span class="k">let</span> <span class="n">inter</span> <span class="n">lst1</span> <span class="n">lst2</span> <span class="o">=</span> <span class="n">rep_ok</span> <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">filter</span> <span class="o">(</span><span class="k">fun</span> <span class="n">h</span> <span class="o">-&gt;</span> <span class="n">mem</span> <span class="n">h</span> <span class="n">lst2</span><span class="o">)</span> <span class="o">(</span><span class="n">rep_ok</span> <span class="n">lst1</span><span class="o">))</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>module UniqListSet : Set
</pre></div>
</div>
</div>
</div>
<p>Calling <code class="docutils literal notranslate"><span class="pre">rep_ok</span></code> on every argument can be too expensive for the production
version of a program. The <code class="docutils literal notranslate"><span class="pre">rep_ok</span></code> above, for example, requires linearithmic
time, which destroys the efficiency of all the previously constant time or
linear time operations. For production code, it may be more appropriate to use a
version of <code class="docutils literal notranslate"><span class="pre">rep_ok</span></code> that only checks the parts of the rep invariant that are
cheap to check. When there is a requirement that there be no run-time cost,
<code class="docutils literal notranslate"><span class="pre">rep_ok</span></code> can be changed to an identity function (or macro) so the compiler
optimizes away the calls to it. However, it is a good idea to keep around the
full code of <code class="docutils literal notranslate"><span class="pre">rep_ok</span></code> so it can be easily reinstated during future debugging:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">rep_ok</span> <span class="n">lst</span> <span class="o">=</span> <span class="n">lst</span>

<span class="k">let</span> <span class="n">rep_ok_expensive</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">u</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">sort_uniq</span> <span class="nn">Stdlib</span><span class="p">.</span><span class="n">compare</span> <span class="n">lst</span> <span class="k">in</span>
  <span class="k">match</span> <span class="nn">List</span><span class="p">.</span><span class="n">compare_lengths</span> <span class="n">lst</span> <span class="n">u</span> <span class="k">with</span> <span class="mi">0</span> <span class="o">-&gt;</span> <span class="n">lst</span> <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">failwith</span> <span class="s2">&quot;RI&quot;</span>
</pre></div>
</div>
<p>Some languages provide support for <em>conditional compilation</em>, which provides
some kind of support for compiling some parts of the codebase but not others.
The OCaml compiler supports a flag <code class="docutils literal notranslate"><span class="pre">noassert</span></code> that disables assertion checking.
So you could implement rep invariant checking with <code class="docutils literal notranslate"><span class="pre">assert</span></code>, and turn it off
with <code class="docutils literal notranslate"><span class="pre">noassert</span></code>. The problem with that is that some portions of your codebase
might <em>require</em> assertion checking to be turned on to work correctly.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "cs3110/textbook",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "ocaml-jupyter"
        },
        kernelOptions: {
            name: "ocaml-jupyter",
            path: "./chapters/correctness"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ocaml-jupyter'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="function_docs.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">6.2. </span>Function Documentation</p>
      </div>
    </a>
    <a class="right-next"
       href="test_debug.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">6.4. </span>Testing and Debugging</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#abstraction-functions">6.3.1. Abstraction Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementing-the-abstraction-function">6.3.2. Implementing the Abstraction Function</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#commutative-diagrams">6.3.3. Commutative Diagrams</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#representation-invariants">6.3.4. Representation Invariants</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementing-the-representation-invariant">6.3.5. Implementing the Representation Invariant</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Michael R. Clarkson et al.
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=bd9e20870c6007c4c509"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=bd9e20870c6007c4c509"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>