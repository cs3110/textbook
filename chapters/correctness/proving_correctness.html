

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>8.7. Proving Correctness &#8212; OCaml Programming: Correct + Efficient + Beautiful</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=bd9e20870c6007c4c509" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=bd9e20870c6007c4c509" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=bd9e20870c6007c4c509"></script>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/correctness/proving_correctness';</script>
    <link rel="shortcut icon" href="../../_static/op.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="8.8. Structural Induction" href="structural_induction.html" />
    <link rel="prev" title="8.6. Randomized Testing with QCheck" href="randomized.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <header>


  <div class="bd-header-announcement container-fluid bd-header-announcement">
    <div class="bd-header-announcement__content">Using this book as part of a course? Please <a style="color:white" href="https://docs.google.com/forms/d/e/1FAIpQLSfEW65AJPBnk732zZZM9CFpWMobWUkym6Nf-pgslRqqwoWYIA/viewform?usp=preview">let us know</a>!</div>
  </div>

  
    <div class="bd-header navbar navbar-expand-lg bd-navbar">
    </div>
  
  </header>

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../cover.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/op_title.png" class="logo__image only-light" alt="OCaml Programming: Correct + Efficient + Beautiful - Home"/>
    <script>document.write(`<img src="../../_static/op_title.png" class="logo__image only-dark" alt="OCaml Programming: Correct + Efficient + Beautiful - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Preface</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../preface/about.html">About This Book</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preface/install.html">Installing OCaml</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../intro/intro.html">1. Better Programming Through OCaml</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro/past.html">1.1. The Past of OCaml</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/present.html">1.2. The Present of OCaml</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/future.html">1.3. Look to Your Future</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/3110.html">1.4. A Brief History of CS 3110</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/summary.html">1.5. Summary</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../basics/intro.html">2. The Basics of OCaml</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../basics/toplevel.html">2.1. The OCaml Toplevel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/compiling.html">2.2. Compiling OCaml Programs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/expressions.html">2.3. Expressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/functions.html">2.4. Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/documentation.html">2.5. Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/printing.html">2.6. Printing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/debugging.html">2.7. Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/summary.html">2.8. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/exercises.html">2.9. Exercises</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">OCaml Programming</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../data/intro.html">3. Data and Types</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../data/lists.html">3.1. Lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/variants.html">3.2. Variants</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/ounit.html">3.3. Unit Testing with OUnit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/records_tuples.html">3.4. Records and Tuples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/pattern_matching_advanced.html">3.5. Advanced Pattern Matching</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/type_synonym.html">3.6. Type Synonyms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/options.html">3.7. Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/assoc_list.html">3.8. Association Lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/algebraic_data_types.html">3.9. Algebraic Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/exceptions.html">3.10. Exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/trees.html">3.11. Example: Trees</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/nats.html">3.12. Example: Natural Numbers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/summary.html">3.13. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/exercises.html">3.14. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../hop/intro.html">4. Higher-Order Programming</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../hop/higher_order.html">4.1. Higher-Order Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/map.html">4.2. Map</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/filter.html">4.3. Filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/fold.html">4.4. Fold</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/beyond_lists.html">4.5. Beyond Lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/pipelining.html">4.6. Pipelining</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/currying.html">4.7. Currying</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/summary.html">4.8. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/exercises.html">4.9. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../modules/intro.html">5. Modular Programming</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/module_systems.html">5.1. Module Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/modules.html">5.2. Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/toplevel.html">5.3. Modules and the Toplevel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/encapsulation.html">5.4. Encapsulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/compilation_units.html">5.5. Compilation Units</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/functional_data_structures.html">5.6. Functional Data Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/module_type_constraints.html">5.7. Module Type Constraints</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/includes.html">5.8. Includes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/functors.html">5.9. Functors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/summary.html">5.10. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/exercises.html">5.11. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../mut/intro.html">6. Mutability</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../mut/refs.html">6.1. Refs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mut/mutable_fields.html">6.2. Mutable Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mut/arrays.html">6.3. Arrays and Loops</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mut/summary.html">6.4. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mut/exercises.html">6.5. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../conc/intro.html">7. Concurrency</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../conc/concurrency.html">7.1. Concurrency</a></li>
<li class="toctree-l2"><a class="reference internal" href="../conc/promises.html">7.2. Promises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../conc/impl_promises.html">7.3. Implementing Promises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../conc/io_promises.html">7.4. Asynchronous Input and Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../conc/callbacks.html">7.5. Callbacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../conc/full_promises_impl.html">7.6. The Full Promises Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../conc/monads.html">7.7. Monads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../conc/summary.html">7.8. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../conc/exercises.html">7.9. Exercises</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Correctness and Efficiency</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="intro.html">8. Correctness</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="specifications.html">8.1. Specifications</a></li>
<li class="toctree-l2"><a class="reference internal" href="function_docs.html">8.2. Function Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="module_docs.html">8.3. Module Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_debug.html">8.4. Testing and Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="black_glass_box.html">8.5. Black-box and Glass-box Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="randomized.html">8.6. Randomized Testing with QCheck</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">8.7. Proving Correctness</a></li>
<li class="toctree-l2"><a class="reference internal" href="structural_induction.html">8.8. Structural Induction</a></li>
<li class="toctree-l2"><a class="reference internal" href="eq_spec.html">8.9. Equational Specification</a></li>
<li class="toctree-l2"><a class="reference internal" href="summary.html">8.10. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="exercises.html">8.11. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ds/intro.html">9. Data Structures</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ds/hash_tables.html">9.1. Hash Tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/amortized.html">9.2. Amortized Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/rb.html">9.3. Red-Black Trees</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/sequence.html">9.4. Sequences</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/memoization.html">9.5. Memoization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/parrays.html">9.6. Persistent Arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/summary.html">9.7. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds/exercises.html">9.8. Exercises</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Language Implementation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../interp/intro.html">10. Interpreters</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../interp/calculator.html">10.1. Example: Calculator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/parsing.html">10.2. Parsing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/substitution.html">10.3. Substitution Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/environment.html">10.4. Environment Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/typecheck.html">10.5. Type Checking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/inference.html">10.6. Type Inference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/summary.html">10.7. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/exercises.html">10.8. Exercises</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Lagniappe</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../adv/curry-howard.html">The Curry-Howard Correspondence</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../appendix/bigoh.html">Big-Oh Notation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/vm.html">Virtual Machine</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/cs3110/textbook/main?urlpath=tree/src/chapters/correctness/proving_correctness.md" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/cs3110/textbook" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/cs3110/textbook/edit/main/src/chapters/correctness/proving_correctness.md" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/cs3110/textbook/issues/new?title=Issue%20on%20page%20%2Fchapters/correctness/proving_correctness.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/chapters/correctness/proving_correctness.ipynb" target="_blank"
   class="btn btn-sm btn-download-notebook-button dropdown-item"
   title="Download notebook file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li><a href="../../_sources/chapters/correctness/proving_correctness.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Proving Correctness</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#equality">8.7.1. Equality</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#equational-reasoning">8.7.2. Equational Reasoning</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#induction-on-natural-numbers">8.7.3. Induction on Natural Numbers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#programs-as-specifications">8.7.4. Programs as Specifications</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recursion-vs-iteration">8.7.5. Recursion vs. Iteration</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#termination">8.7.6. Termination</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="proving-correctness">
<h1><span class="section-number">8.7. </span>Proving Correctness<a class="headerlink" href="#proving-correctness" title="Permalink to this heading">#</a></h1>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/48GBq4koKPs" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>Testing provides evidence of correctness, but not full assurance. Even after
extensive black-box and glass-box testing, maybe there’s still some test case
the programmer failed to invent, and that test case would reveal a fault in the
program.</p>
<blockquote class="epigraph">
<div><p>Program testing can be used to show the presence of bugs, but never to show their absence.</p>
<p class="attribution">—Edsger W. Dijkstra</p>
</div></blockquote>
<p>The point is not that testing is useless! It can be quite effective. But it is a
kind of <em>inductive reasoning</em>, in which evidence (i.e., passing tests)
accumulates in support of a conclusion (i.e., correctness of the program)
without absolutely guaranteeing the validity of that conclusion. (Note that the
word “inductive” here is being used in a different sense than the proof
technique known as induction.) To get that guarantee, we turn to <em>deductive
reasoning</em>, in which we proceed from premises and rules about logic to a valid
conclusion. In other words, we prove the correctness of the program. Our goal,
next, is to learn some techniques for such correctness proofs. These techniques
are known as <em>formal methods</em> because of their use of logical formalism.</p>
<p><em>Correctness</em> here means that the program produces the right output
according to a <em>specification</em>. Specifications are usually provided in the
documentation of a function (hence the name “specification comment”): they
describe the program’s precondition and postcondition. Postconditions, as we
have been writing them, have the form <code class="docutils literal notranslate"><span class="pre">[f</span> <span class="pre">x]</span> <span class="pre">is</span> <span class="pre">&quot;...a</span> <span class="pre">description</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">output</span> <span class="pre">in</span> <span class="pre">terms</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">input</span> <span class="pre">[x]...&quot;</span></code>. For example, the specification of a factorial
function could be:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="c">(** [fact n] is [n!]. Requires: [n &gt;= 0]. *)</span>
<span class="k">let</span> <span class="k">rec</span> <span class="n">fact</span> <span class="n">n</span> <span class="o">=</span> <span class="o">...</span>
</pre></div>
</div>
<p>The postcondition is asserting an equality between the output of the function
and some English description of a computation on the input. <em>Formal
verification</em> is the task for proving that the implementation of the function
satisfies its specification.</p>
<p>Equalities are one of the fundamental ways we think about correctness of
functional programs. The absence of mutable state makes it possible to reason
straightforwardly about whether two expressions are equal. It’s difficult to do
that in an imperative language, because those expressions might have side
effects that change the state.</p>
<section id="equality">
<h2><span class="section-number">8.7.1. </span>Equality<a class="headerlink" href="#equality" title="Permalink to this heading">#</a></h2>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/zjDUrMdVC5U" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>When are two expressions equal?  Two possible answers are:</p>
<ul class="simple">
<li><p>When they are syntactically identical.</p></li>
<li><p>When they are semantically equivalent: they produce the same value.</p></li>
</ul>
<p>For example, are <code class="docutils literal notranslate"><span class="pre">42</span></code> and <code class="docutils literal notranslate"><span class="pre">41+1</span></code> equal? The syntactic answer would say they are
not, because they involve different tokens. The semantic answer would say they
are: they both produce the value <code class="docutils literal notranslate"><span class="pre">42</span></code>.</p>
<p>What about functions: are <code class="docutils literal notranslate"><span class="pre">fun</span> <span class="pre">x</span> <span class="pre">-&gt;</span> <span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">fun</span> <span class="pre">y</span> <span class="pre">-&gt;</span> <span class="pre">y</span></code> equal? Syntactically
they are different. But semantically, they both produce a value that is the
identity function: when they are applied to an input, they will both produce the
same output. That is, <code class="docutils literal notranslate"><span class="pre">(fun</span> <span class="pre">x</span> <span class="pre">-&gt;</span> <span class="pre">x)</span> <span class="pre">z</span> <span class="pre">=</span> <span class="pre">z</span></code>, and <code class="docutils literal notranslate"><span class="pre">(fun</span> <span class="pre">y</span> <span class="pre">-&gt;</span> <span class="pre">y)</span> <span class="pre">z</span> <span class="pre">=</span> <span class="pre">z</span></code>. If it is
the case that for all inputs two functions produce the same output, we will
consider the functions to be equal:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>if (forall x, f x = g x), then f = g.
</pre></div>
</div>
<p>That definition of equality for functions is known as the <em>Axiom of
Extensionality</em> in some branches of mathematics; henceforth we’ll refer to it
simply as “extensionality”.</p>
<p>Here we will adopt the semantic approach. If <code class="docutils literal notranslate"><span class="pre">e1</span></code> and <code class="docutils literal notranslate"><span class="pre">e2</span></code> evaluate to the same
value <code class="docutils literal notranslate"><span class="pre">v</span></code>, then we write <code class="docutils literal notranslate"><span class="pre">e1</span> <span class="pre">=</span> <span class="pre">e2</span></code>. We are using <code class="docutils literal notranslate"><span class="pre">=</span></code> here in a mathematical
sense of equality, not as the OCaml polymorphic equality operator. For example,
we allow <code class="docutils literal notranslate"><span class="pre">(fun</span> <span class="pre">x</span> <span class="pre">-&gt;</span> <span class="pre">x)</span> <span class="pre">=</span> <span class="pre">(fun</span> <span class="pre">y</span> <span class="pre">-&gt;</span> <span class="pre">y)</span></code>, even though OCaml’s operator would raise
an exception and refuse to compare functions.</p>
<p>We’re also going to restrict ourselves to expressions that are well-typed, pure
(meaning they have no side effects), and total (meaning they don’t have
exceptions or infinite loops).</p>
</section>
<section id="equational-reasoning">
<h2><span class="section-number">8.7.2. </span>Equational Reasoning<a class="headerlink" href="#equational-reasoning" title="Permalink to this heading">#</a></h2>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/MjpZJA1jIqU" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>Consider these functions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">twice</span> <span class="n">f</span> <span class="n">x</span> <span class="o">=</span> <span class="n">f</span> <span class="o">(</span><span class="n">f</span> <span class="n">x</span><span class="o">)</span>
<span class="k">let</span> <span class="n">compose</span> <span class="n">f</span> <span class="n">g</span> <span class="n">x</span> <span class="o">=</span> <span class="n">f</span> <span class="o">(</span><span class="n">g</span> <span class="n">x</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val twice : (&#39;a -&gt; &#39;a) -&gt; &#39;a -&gt; &#39;a = &lt;fun&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val compose : (&#39;a -&gt; &#39;b) -&gt; (&#39;c -&gt; &#39;a) -&gt; &#39;c -&gt; &#39;b = &lt;fun&gt;
</pre></div>
</div>
</div>
</div>
<p>We know from the rules of OCaml evaluation that <code class="docutils literal notranslate"><span class="pre">twice</span> <span class="pre">h</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">h</span> <span class="pre">(h</span> <span class="pre">x)</span></code>, and
likewise, <code class="docutils literal notranslate"><span class="pre">compose</span> <span class="pre">h</span> <span class="pre">h</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">h</span> <span class="pre">(h</span> <span class="pre">x)</span></code>. Thus we have:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="n">twice</span> <span class="n">h</span> <span class="n">x</span> <span class="o">=</span> <span class="n">h</span> <span class="o">(</span><span class="n">h</span> <span class="n">x</span><span class="o">)</span> <span class="o">=</span> <span class="n">compose</span> <span class="n">h</span> <span class="n">h</span> <span class="n">x</span>
</pre></div>
</div>
<p>Therefore, we can conclude that <code class="docutils literal notranslate"><span class="pre">twice</span> <span class="pre">h</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">compose</span> <span class="pre">h</span> <span class="pre">h</span> <span class="pre">x</span></code>. And by
extensionality we can simplify that equality: Since <code class="docutils literal notranslate"><span class="pre">twice</span> <span class="pre">h</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">compose</span> <span class="pre">h</span> <span class="pre">h</span> <span class="pre">x</span></code>
holds for all <code class="docutils literal notranslate"><span class="pre">x</span></code>, we can conclude <code class="docutils literal notranslate"><span class="pre">twice</span> <span class="pre">h</span> <span class="pre">=</span> <span class="pre">compose</span> <span class="pre">h</span> <span class="pre">h</span></code>.</p>
<p>As another example, suppose we define an infix operator for function
composition:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="o">(</span> <span class="o">&lt;&lt;</span> <span class="o">)</span> <span class="o">=</span> <span class="n">compose</span>
</pre></div>
</div>
<p>Then we can prove that composition is associative, using equational reasoning:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Theorem: (f &lt;&lt; g) &lt;&lt; h  =  f &lt;&lt; (g &lt;&lt; h)

Proof: By extensionality, we need to show
  ((f &lt;&lt; g) &lt;&lt; h) x  =  (f &lt;&lt; (g &lt;&lt; h)) x
for an arbitrary x.

  ((f &lt;&lt; g) &lt;&lt; h) x
= (f &lt;&lt; g) (h x)
= f (g (h x))

and

  (f &lt;&lt; (g &lt;&lt; h)) x
= f ((g &lt;&lt; h) x)
= f (g (h x))

So ((f &lt;&lt; g) &lt;&lt; h) x = f (g (h x)) = (f &lt;&lt; (g &lt;&lt; h)) x.

QED
</pre></div>
</div>
<p>All of the steps in the equational proof above follow from evaluation.
Another format for writing the proof would provide hints as to why
each step is valid:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>  ((f &lt;&lt; g) &lt;&lt; h) x
=   { evaluation of &lt;&lt; }
  (f &lt;&lt; g) (h x)
=   { evaluation of &lt;&lt; }
  f (g (h x))

and

  (f &lt;&lt; (g &lt;&lt; h)) x
=   { evaluation of &lt;&lt; }
  f ((g &lt;&lt; h) x)
=   { evaluation of &lt;&lt; }
  f (g (h x))
</pre></div>
</div>
</section>
<section id="induction-on-natural-numbers">
<h2><span class="section-number">8.7.3. </span>Induction on Natural Numbers<a class="headerlink" href="#induction-on-natural-numbers" title="Permalink to this heading">#</a></h2>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/By4VSmpzuHw" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>The following function sums the non-negative integers up to <code class="docutils literal notranslate"><span class="pre">n</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="k">rec</span> <span class="n">sumto</span> <span class="n">n</span> <span class="o">=</span>
  <span class="k">if</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">n</span> <span class="o">+</span> <span class="n">sumto</span> <span class="o">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val sumto : int -&gt; int = &lt;fun&gt;
</pre></div>
</div>
</div>
</div>
<p>You might recall that the same summation can be expressed in closed form as
<code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">*</span> <span class="pre">(n</span> <span class="pre">+</span> <span class="pre">1)</span> <span class="pre">/</span> <span class="pre">2</span></code>. To prove that <code class="docutils literal notranslate"><span class="pre">forall</span> <span class="pre">n</span> <span class="pre">&gt;=</span> <span class="pre">0,</span> <span class="pre">sumto</span> <span class="pre">n</span> <span class="pre">=</span> <span class="pre">n</span> <span class="pre">*</span> <span class="pre">(n</span> <span class="pre">+</span> <span class="pre">1)</span> <span class="pre">/</span> <span class="pre">2</span></code>, we
will need <em>mathematical induction</em>.</p>
<p>Recall that induction on the natural numbers (i.e., the non-negative integers)
is formulated as follows:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>forall properties P,
  if P(0),
  and if forall k, P(k) implies P(k + 1),
  then forall n, P(n)
</pre></div>
</div>
<p>That is called the <em>induction principle</em> for natural numbers. The <em>base case</em> is
to prove <code class="docutils literal notranslate"><span class="pre">P(0)</span></code>, and the <em>inductive case</em> is to prove that <code class="docutils literal notranslate"><span class="pre">P(k</span> <span class="pre">+</span> <span class="pre">1)</span></code> holds
under the assumption of the <em>inductive hypothesis</em> <code class="docutils literal notranslate"><span class="pre">P(k)</span></code>.</p>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/JRNxlQYOLyw" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>Let’s use induction to prove the correctness of <code class="docutils literal notranslate"><span class="pre">sumto</span></code>.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Claim: sumto n = n * (n + 1) / 2

Proof: by induction on n.
P(n) = sumto n = n * (n + 1) / 2

Base case: n = 0
Show: sumto 0 = 0 * (0 + 1) / 2

  sumto 0
=   { evaluation }
  0
=   { algebra }
  0 * (0 + 1) / 2

Inductive case: n = k + 1
Show: sumto (k + 1) = (k + 1) * ((k + 1) + 1) / 2
IH: sumto k = k * (k + 1) / 2

  sumto (k + 1)
=   { evaluation }
  k + 1 + sumto k
=   { IH }
  k + 1 + k * (k + 1) / 2
=   { algebra }
  (k + 1) * (k + 2) / 2

QED
</pre></div>
</div>
<p>Note that we have been careful in each of the cases to write out what we need to
show, as well as to write down the inductive hypothesis. It is important to show
all this work.</p>
<p>Suppose we now define:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">sumto_closed</span> <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="o">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">/</span> <span class="mi">2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val sumto_closed : int -&gt; int = &lt;fun&gt;
</pre></div>
</div>
</div>
</div>
<p>Then as a corollary to our previous claim, by extensionality we can conclude</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>sumto_closed = sumto
</pre></div>
</div>
<p>Technically that equality holds only inputs that are natural numbers. But since
all our examples henceforth will be for naturals, not integers per se, we will
elide stating any preconditions or restrictions regarding natural numbers.</p>
</section>
<section id="programs-as-specifications">
<h2><span class="section-number">8.7.4. </span>Programs as Specifications<a class="headerlink" href="#programs-as-specifications" title="Permalink to this heading">#</a></h2>
<p>We have just proved the correctness of an efficient implementation relative to
an inefficient implementation. The inefficient implementation, <code class="docutils literal notranslate"><span class="pre">sumto</span></code>, serves
as a specification for the efficient implementation, <code class="docutils literal notranslate"><span class="pre">sumto_closed</span></code>.</p>
<p>That technique is common in verifying functional programs: write an obviously
correct implementation that is lacking in some desired property, such as
efficiency, then prove that a better implementation is equal to the original.</p>
<p>Let’s do another example of this kind of verification. This time, well use the
factorial function.</p>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/htMNllWnLzg" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>The simple, obviously correct implementation of factorial would be:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="k">rec</span> <span class="n">fact</span> <span class="n">n</span> <span class="o">=</span>
  <span class="k">if</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">then</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">n</span> <span class="o">*</span> <span class="n">fact</span> <span class="o">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val fact : int -&gt; int = &lt;fun&gt;
</pre></div>
</div>
</div>
</div>
<p>A tail-recursive implementation would be more efficient about stack space:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="k">rec</span> <span class="n">facti</span> <span class="n">acc</span> <span class="n">n</span> <span class="o">=</span>
  <span class="k">if</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">then</span> <span class="n">acc</span> <span class="k">else</span> <span class="n">facti</span> <span class="o">(</span><span class="n">acc</span> <span class="o">*</span> <span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span>

<span class="k">let</span> <span class="n">fact_tr</span> <span class="n">n</span> <span class="o">=</span> <span class="n">facti</span> <span class="mi">1</span> <span class="n">n</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val facti : int -&gt; int -&gt; int = &lt;fun&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val fact_tr : int -&gt; int = &lt;fun&gt;
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">i</span></code> in the name <code class="docutils literal notranslate"><span class="pre">facti</span></code> stands for <em>iterative</em>. We call this an iterative
implementation because it strongly resembles how the same computation would be
expressed using a loop (that is, an iteration construct) in an imperative
language. For example, in Java we might write:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">facti</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">acc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">acc</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<span class="w">    </span><span class="n">n</span><span class="o">--</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">acc</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Both the OCaml and Java implementation of <code class="docutils literal notranslate"><span class="pre">facti</span></code> share these features:</p>
<ul class="simple">
<li><p>they start <code class="docutils literal notranslate"><span class="pre">acc</span></code> at <code class="docutils literal notranslate"><span class="pre">1</span></code></p></li>
<li><p>they check whether <code class="docutils literal notranslate"><span class="pre">n</span></code> is <code class="docutils literal notranslate"><span class="pre">0</span></code></p></li>
<li><p>they multiply <code class="docutils literal notranslate"><span class="pre">acc</span></code> by <code class="docutils literal notranslate"><span class="pre">n</span></code></p></li>
<li><p>they decrement <code class="docutils literal notranslate"><span class="pre">n</span></code></p></li>
<li><p>they return the accumulator, <code class="docutils literal notranslate"><span class="pre">acc</span></code></p></li>
</ul>
<p>Let’s try to prove that <code class="docutils literal notranslate"><span class="pre">fact_tr</span></code> correctly implements the same computation as
<code class="docutils literal notranslate"><span class="pre">fact</span></code>.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Claim: forall n, fact n = fact_tr n

Since fact_tr n = facti 1 n, it suffices to show fact n = facti 1 n.

Proof: by induction on n.
P(n) = fact n = facti 1 n

Base case: n = 0
Show: fact 0 = facti 1 0

  fact 0
=   { evaluation }
  1
=   { evaluation }
  facti 1 0

Inductive case: n = k + 1
Show: fact (k + 1) = facti 1 (k + 1)
IH: fact k = facti 1 k

  fact (k + 1)
=   { evaluation }
  (k + 1) * fact k
=   { IH }
  (k + 1) * facti 1 k

  facti 1 (k + 1)
=   { evaluation }
  facti (1 * (k + 1)) k
=   { evaluation }
  facti (k + 1) k

Unfortunately, we&#39;re stuck.  Neither side of what we want to show
can be manipulated any further.

ABORT
</pre></div>
</div>
<p>We know that <code class="docutils literal notranslate"><span class="pre">facti</span> <span class="pre">(k</span> <span class="pre">+</span> <span class="pre">1)</span> <span class="pre">k</span></code> and <code class="docutils literal notranslate"><span class="pre">(k</span> <span class="pre">+</span> <span class="pre">1)</span> <span class="pre">*</span> <span class="pre">facti</span> <span class="pre">1</span> <span class="pre">k</span></code> should yield the same
value. But the IH allows us only to use <code class="docutils literal notranslate"><span class="pre">1</span></code> as the second argument to <code class="docutils literal notranslate"><span class="pre">facti</span></code>,
instead of a bigger argument like <code class="docutils literal notranslate"><span class="pre">k</span> <span class="pre">+</span> <span class="pre">1</span></code>. So our proof went astray the moment
we used the IH. We need a stronger inductive hypothesis!</p>
<p>So let’s strengthen the claim we are making. Instead of showing that
<code class="docutils literal notranslate"><span class="pre">fact</span> <span class="pre">n</span> <span class="pre">=</span> <span class="pre">facti</span> <span class="pre">1</span> <span class="pre">n</span></code>, we’ll try to show <code class="docutils literal notranslate"><span class="pre">forall</span> <span class="pre">p,</span> <span class="pre">p</span> <span class="pre">*</span> <span class="pre">fact</span> <span class="pre">n</span> <span class="pre">=</span> <span class="pre">facti</span> <span class="pre">p</span> <span class="pre">n</span></code>. That
generalizes the <code class="docutils literal notranslate"><span class="pre">k</span> <span class="pre">+</span> <span class="pre">1</span></code> we were stuck on to an arbitrary quantity <code class="docutils literal notranslate"><span class="pre">p</span></code>.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Claim: forall n, forall p . p * fact n = facti p n

Proof: by induction on n.
P(n) = forall p, p * fact n = facti p n

Base case:  n = 0
Show: forall p,  p * fact 0 = facti p 0

  p * fact 0
=   { evaluation and algebra }
  p
=   { evaluation }
  facti p 0

Inductive case: n = k + 1
Show: forall p,  p * fact (k + 1) = facti p (k + 1)
IH: forall p,  p * fact k = facti p k

  p * fact (k + 1)
=   { evaluation }
  p * (k + 1) * fact k
=   { IH, instantiating its p as p * (k + 1) }
  facti (p * (k + 1)) k

  facti p (k + 1)
=   { evaluation }
  facti (p * (k + 1)) k

QED

Claim: forall n, fact n = fact_tr n

Proof:

  fact n
=   { algebra }
  1 * fact n
=   { previous claim }
  facti 1 n
=   { evaluation }
  fact_tr n

QED
</pre></div>
</div>
<p>That finishes our proof that the efficient, tail-recursive function <code class="docutils literal notranslate"><span class="pre">fact_tr</span></code> is
equivalent to the simple, recursive function <code class="docutils literal notranslate"><span class="pre">fact</span></code>. In essence, we have proved
the correctness of <code class="docutils literal notranslate"><span class="pre">fact_tr</span></code> using <code class="docutils literal notranslate"><span class="pre">fact</span></code> as its specification.</p>
</section>
<section id="recursion-vs-iteration">
<h2><span class="section-number">8.7.5. </span>Recursion vs. Iteration<a class="headerlink" href="#recursion-vs-iteration" title="Permalink to this heading">#</a></h2>
<p>We added an accumulator as an extra argument to make the factorial function be
tail recursive. That’s a trick we’ve seen before. Let’s abstract and see how to
do it in general.</p>
<p>Suppose we have a recursive function over integers:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="k">rec</span> <span class="n">f_r</span> <span class="n">n</span> <span class="o">=</span>
  <span class="k">if</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">then</span> <span class="n">i</span> <span class="k">else</span> <span class="n">op</span> <span class="n">n</span> <span class="o">(</span><span class="n">f_r</span> <span class="o">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="o">))</span>
</pre></div>
</div>
<p>Here, the <code class="docutils literal notranslate"><span class="pre">r</span></code> in <code class="docutils literal notranslate"><span class="pre">f_r</span></code> is meant to suggest that <code class="docutils literal notranslate"><span class="pre">f_r</span></code> is a recursive function.
The <code class="docutils literal notranslate"><span class="pre">i</span></code> and <code class="docutils literal notranslate"><span class="pre">op</span></code> are pieces of the function that are meant to be replaced by
some concrete value <code class="docutils literal notranslate"><span class="pre">i</span></code> and operator <code class="docutils literal notranslate"><span class="pre">op</span></code>. For example, with the factorial
function, we have:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="n">f_r</span> <span class="o">=</span> <span class="n">fact</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">op</span> <span class="o">=</span> <span class="o">(</span> <span class="o">*</span> <span class="o">)</span>
</pre></div>
</div>
<p>Such a function can be made tail recursive by rewriting it as follows:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="k">rec</span> <span class="n">f_i</span> <span class="n">acc</span> <span class="n">n</span> <span class="o">=</span>
  <span class="k">if</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">then</span> <span class="n">acc</span>
  <span class="k">else</span> <span class="n">f_i</span> <span class="o">(</span><span class="n">op</span> <span class="n">acc</span> <span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span>

<span class="k">let</span> <span class="n">f_tr</span> <span class="o">=</span> <span class="n">f_i</span> <span class="n">i</span>
</pre></div>
</div>
<p>Here, the <code class="docutils literal notranslate"><span class="pre">i</span></code> in <code class="docutils literal notranslate"><span class="pre">f_i</span></code> is meant to suggest that <code class="docutils literal notranslate"><span class="pre">f_i</span></code> is an iterative function,
and <code class="docutils literal notranslate"><span class="pre">i</span></code> and <code class="docutils literal notranslate"><span class="pre">op</span></code> are the same as in the recursive version of the function. For
example, with factorial we have:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="n">f_i</span> <span class="o">=</span> <span class="n">fact_i</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">op</span> <span class="o">=</span> <span class="o">(</span> <span class="o">*</span> <span class="o">)</span>
<span class="n">f_tr</span> <span class="o">=</span> <span class="n">fact_tr</span>
</pre></div>
</div>
<p>We can prove that <code class="docutils literal notranslate"><span class="pre">f_r</span></code> and <code class="docutils literal notranslate"><span class="pre">f_tr</span></code> compute the same function. During the proof,
next, we will discover certain conditions that must hold of <code class="docutils literal notranslate"><span class="pre">i</span></code> and <code class="docutils literal notranslate"><span class="pre">op</span></code> to make
the transformation to tail recursion be correct.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Theorem: f_r = f_tr

Proof:  By extensionality, it suffices to show that forall n, f_r n = f_tr n.

As in the previous proof for fact, we will need a strengthened induction
hypothesis. So we first prove this lemma, which quantifies over all accumulators
that could be input to f_i, rather than only i:

  Lemma: forall n, forall acc, op acc (f_r n) = f_i acc n

  Proof of Lemma: by induction on n.
  P(n) = forall acc, op acc (f_r n) = f_i acc n

  Base: n = 0
  Show: forall acc, op acc (f_r 0) = f_i acc 0

    op acc (f_r 0)
  =   { evaluation }
    op acc i
  =   { if we assume forall x, op x i = x }
    acc

    f_i acc 0
  =   { evaluation }
    acc

  Inductive case: n = k + 1
  Show: forall acc, op acc (f_r (k + 1)) = f_i acc (k + 1)
  IH: forall acc, op acc (f_r k) = f_i acc k

    op acc (f_r (k + 1))
  =   { evaluation }
    op acc (op (k + 1) (f_r k))
  =   { if we assume forall x y z, op x (op y z) = op (op x y) z }
    op (op acc (k + 1)) (f_r k)

    f_i acc (k + 1)
  =   { evaluation }
    f_i (op acc (k + 1)) k
  =   { IH, instantiating acc as op acc (k + 1)}
    op (op acc (k + 1)) (f_r k)

  QED

The proof then follows almost immediately from the lemma:

  f_r n
=   { if we assume forall x, op i x = x }
  op i (f_r n)
=   { lemma, instantiating acc as i }
  f_i i n
=   { evaluation }
  f_tr n

QED
</pre></div>
</div>
<p>Along the way we made three assumptions about i and op:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">forall</span> <span class="pre">x,</span> <span class="pre">op</span> <span class="pre">x</span> <span class="pre">i</span> <span class="pre">=</span> <span class="pre">x</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">op</span> <span class="pre">x</span> <span class="pre">(op</span> <span class="pre">y</span> <span class="pre">z)</span> <span class="pre">=</span> <span class="pre">op</span> <span class="pre">(op</span> <span class="pre">x</span> <span class="pre">y)</span> <span class="pre">z</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">forall</span> <span class="pre">x,</span> <span class="pre">op</span> <span class="pre">i</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">x</span></code></p></li>
</ol>
<p>The first and third say that <code class="docutils literal notranslate"><span class="pre">i</span></code> is an <em>identity</em> of <code class="docutils literal notranslate"><span class="pre">op</span></code>: using it on the left
or right side leaves the other argument <code class="docutils literal notranslate"><span class="pre">x</span></code> unchanged. The second says that <code class="docutils literal notranslate"><span class="pre">op</span></code>
is <em>associative</em>. Both those assumptions held for the values we used in the
factorial functions:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">op</span></code> is multiplication, which is associative.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">i</span></code> is <code class="docutils literal notranslate"><span class="pre">1</span></code>, which is an identity of multiplication: multiplication by 1 leaves
the other argument unchanged.</p></li>
</ul>
<p>So our transformation from a recursive to a tail-recursive function is valid as
long as the operator applied in the recursive call is associative, and the value
returned in the base case is an identity of that operator.</p>
<p>Returning to the <code class="docutils literal notranslate"><span class="pre">sumto</span></code> function, we can apply the theorem we just proved to
immediately get a tail-recursive version:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="k">rec</span> <span class="n">sumto_r</span> <span class="n">n</span> <span class="o">=</span>
  <span class="k">if</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">n</span> <span class="o">+</span> <span class="n">sumto_r</span> <span class="o">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val sumto_r : int -&gt; int = &lt;fun&gt;
</pre></div>
</div>
</div>
</div>
<p>Here, the operator is addition, which is associative; and the base case is zero,
which is an identity of addition. Therefore our theorem applies, and we can use
it to produce the tail-recursive version without even having to think about it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="k">rec</span> <span class="n">sumto_i</span> <span class="n">acc</span> <span class="n">n</span> <span class="o">=</span>
  <span class="k">if</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">then</span> <span class="n">acc</span> <span class="k">else</span> <span class="n">sumto_i</span> <span class="o">(</span><span class="n">acc</span> <span class="o">+</span> <span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span>

<span class="k">let</span> <span class="n">sumto_tr</span> <span class="o">=</span> <span class="n">sumto_i</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val sumto_i : int -&gt; int -&gt; int = &lt;fun&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val sumto_tr : int -&gt; int = &lt;fun&gt;
</pre></div>
</div>
</div>
</div>
<p>We already know that <code class="docutils literal notranslate"><span class="pre">sumto_tr</span></code> is correct, thanks to our theorem.</p>
</section>
<section id="termination">
<h2><span class="section-number">8.7.6. </span>Termination<a class="headerlink" href="#termination" title="Permalink to this heading">#</a></h2>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/Xy7GTfEfIK4" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>Sometimes correctness of programs is further divided into:</p>
<ul class="simple">
<li><p><strong>partial correctness</strong>: meaning that <em>if</em> a program terminates, then its
output is correct; and</p></li>
<li><p><strong>total correctness</strong>: meaning that a program <em>does</em> terminate, <em>and</em> its
output is correct.</p></li>
</ul>
<p>Total correctness is therefore the conjunction of partial correctness and
termination. Thus far, we have been proving partial correctness.</p>
<p>To prove that a program terminates is difficult. Indeed, it is impossible in
general for an algorithm to do so: a computer can’t precisely decide whether a
program will terminate. (Look up the “halting problem” for more details.) But, a
smart human sometimes can do so.</p>
<p>There is a simple heuristic that can be used to show that a recursive function
terminates:</p>
<ul class="simple">
<li><p>All recursive calls are on a “smaller” input, and</p></li>
<li><p>all base cases are terminating.</p></li>
</ul>
<p>For example, consider the factorial function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="k">rec</span> <span class="n">fact</span> <span class="n">n</span> <span class="o">=</span>
  <span class="k">if</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">then</span> <span class="mi">1</span>
  <span class="k">else</span> <span class="n">n</span> <span class="o">*</span> <span class="n">fact</span> <span class="o">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val fact : int -&gt; int = &lt;fun&gt;
</pre></div>
</div>
</div>
</div>
<p>The base case, <code class="docutils literal notranslate"><span class="pre">1</span></code>, obviously terminates. The recursive call is on <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">-</span> <span class="pre">1</span></code>,
which is a smaller input than the original <code class="docutils literal notranslate"><span class="pre">n</span></code>. So <code class="docutils literal notranslate"><span class="pre">fact</span></code> always terminates (as
long as its input is a natural number).</p>
<p>The same reasoning applies to all the other functions we’ve discussed above.</p>
<p>To make this more precise, we need a notion of what it means to be smaller.
Suppose we have a binary relation <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> on inputs. Despite the notation, this
relation need not be the less-than relation on integers—although that will
work for <code class="docutils literal notranslate"><span class="pre">fact</span></code>. Also suppose that it is never possible to create an infinite
sequence <code class="docutils literal notranslate"><span class="pre">x0</span> <span class="pre">&gt;</span> <span class="pre">x1</span> <span class="pre">&gt;</span> <span class="pre">x2</span> <span class="pre">&gt;</span> <span class="pre">x3</span> <span class="pre">...</span></code> of elements using this relation. (Where of
course <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">&gt;</span> <span class="pre">b</span></code> if and only if <code class="docutils literal notranslate"><span class="pre">b</span> <span class="pre">&lt;</span> <span class="pre">a</span></code>.) That is, there are no infinite
descending chains of elements: once you pick a starting element <code class="docutils literal notranslate"><span class="pre">x0</span></code>, there can
be only a finite number of “descents” according to the <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> relation before you
bottom out and hit a base case. This property of <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> makes it a <em>well-founded
relation</em>.</p>
<p>So, a recursive function terminates if all its recursive calls are on elements
that are smaller according to <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>. Why? Because there can be only a finite
number of calls before a base case is reached, and base cases must terminate.</p>
<p>The usual <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> relation is well-founded on the natural numbers, because
eventually any chain must reach the base case of 0. But it is not well-founded
on the integers, which can get just keep getting smaller: <code class="docutils literal notranslate"><span class="pre">-1</span> <span class="pre">&gt;</span> <span class="pre">-2</span> <span class="pre">&gt;</span> <span class="pre">-3</span> <span class="pre">&gt;</span> <span class="pre">...</span></code>.</p>
<p>Here’s an interesting function for which the usual <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> relation doesn’t suffice
to prove termination:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="k">rec</span> <span class="n">ack</span> <span class="o">=</span> <span class="k">function</span>
  <span class="o">|</span> <span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">n</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
  <span class="o">|</span> <span class="o">(</span><span class="n">m</span><span class="o">,</span> <span class="mi">0</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">ack</span> <span class="o">(</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span>
  <span class="o">|</span> <span class="o">(</span><span class="n">m</span><span class="o">,</span> <span class="n">n</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">ack</span> <span class="o">(</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="o">,</span> <span class="n">ack</span> <span class="o">(</span><span class="n">m</span><span class="o">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="o">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val ack : int * int -&gt; int = &lt;fun&gt;
</pre></div>
</div>
</div>
</div>
<p>This is known as <em>Ackermann’s function</em>. It grows faster than any exponential
function. Try running <code class="docutils literal notranslate"><span class="pre">ack</span> <span class="pre">(1,</span> <span class="pre">1)</span></code>, <code class="docutils literal notranslate"><span class="pre">ack</span> <span class="pre">(2,</span> <span class="pre">1)</span></code>, <code class="docutils literal notranslate"><span class="pre">ack</span> <span class="pre">(3,</span> <span class="pre">1)</span></code>, then <code class="docutils literal notranslate"><span class="pre">ack</span> <span class="pre">(4,</span> <span class="pre">1)</span></code> to get a sense of that. It also is a famous example of a function that can
be implemented with <code class="docutils literal notranslate"><span class="pre">while</span></code> loops but not with <code class="docutils literal notranslate"><span class="pre">for</span></code> loops. Nonetheless, it does
terminate.</p>
<p>To show that, the base case is easy: when the input is <code class="docutils literal notranslate"><span class="pre">(0,</span> <span class="pre">_)</span></code>, the function
terminates. But in other cases, it makes a recursive call, and we need to define
an appropriate <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> relation. It turns out <em>lexicographic ordering</em> on pairs
works. Define <code class="docutils literal notranslate"><span class="pre">(a,</span> <span class="pre">b)</span> <span class="pre">&lt;</span> <span class="pre">(c,</span> <span class="pre">d)</span></code> if:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">&lt;</span> <span class="pre">c</span></code>, or</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">=</span> <span class="pre">c</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span> <span class="pre">&lt;</span> <span class="pre">d</span></code>.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> order in those two cases is the usual <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> on natural numbers.</p>
<p>In the first recursive call, <code class="docutils literal notranslate"><span class="pre">(m</span> <span class="pre">-</span> <span class="pre">1,</span> <span class="pre">1)</span> <span class="pre">&lt;</span> <span class="pre">(m,</span> <span class="pre">0)</span></code> by the first case of the
definition of <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, because <code class="docutils literal notranslate"><span class="pre">m</span> <span class="pre">-</span> <span class="pre">1</span> <span class="pre">&lt;</span> <span class="pre">m</span></code>. In the nested recursive call
<code class="docutils literal notranslate"><span class="pre">ack</span> <span class="pre">(m</span> <span class="pre">-</span> <span class="pre">1,</span> <span class="pre">ack</span> <span class="pre">(m,</span> <span class="pre">n</span> <span class="pre">-</span> <span class="pre">1))</span></code>, both cases are needed:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">(m,</span> <span class="pre">n</span> <span class="pre">-</span> <span class="pre">1)</span> <span class="pre">&lt;</span> <span class="pre">(m,</span> <span class="pre">n)</span></code> because <code class="docutils literal notranslate"><span class="pre">m</span> <span class="pre">=</span> <span class="pre">m</span></code> and <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">-</span> <span class="pre">1</span> <span class="pre">&lt;</span> <span class="pre">n</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">(m</span> <span class="pre">-</span> <span class="pre">1,</span> <span class="pre">_)</span> <span class="pre">&lt;</span> <span class="pre">(m,</span> <span class="pre">n)</span></code> because <code class="docutils literal notranslate"><span class="pre">m</span> <span class="pre">-</span> <span class="pre">1</span> <span class="pre">&lt;</span> <span class="pre">m</span></code>.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "cs3110/textbook",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "ocaml-jupyter"
        },
        kernelOptions: {
            name: "ocaml-jupyter",
            path: "./chapters/correctness"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ocaml-jupyter'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="randomized.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">8.6. </span>Randomized Testing with QCheck</p>
      </div>
    </a>
    <a class="right-next"
       href="structural_induction.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">8.8. </span>Structural Induction</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#equality">8.7.1. Equality</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#equational-reasoning">8.7.2. Equational Reasoning</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#induction-on-natural-numbers">8.7.3. Induction on Natural Numbers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#programs-as-specifications">8.7.4. Programs as Specifications</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recursion-vs-iteration">8.7.5. Recursion vs. Iteration</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#termination">8.7.6. Termination</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Michael R. Clarkson et al.
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=bd9e20870c6007c4c509"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=bd9e20870c6007c4c509"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>