

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>8.1. Hash Tables &#8212; OCaml Programming: Correct + Efficient + Beautiful</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=bd9e20870c6007c4c509" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=bd9e20870c6007c4c509" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=bd9e20870c6007c4c509"></script>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/ds/hash_tables';</script>
    <link rel="shortcut icon" href="../../_static/op.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="8.2. Amortized Analysis" href="amortized.html" />
    <link rel="prev" title="8. Data Structures" href="intro.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <header>
  
    <div class="bd-header navbar navbar-expand-lg bd-navbar">
    </div>
  
  </header>

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../cover.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/op_title.png" class="logo__image only-light" alt="OCaml Programming: Correct + Efficient + Beautiful - Home"/>
    <script>document.write(`<img src="../../_static/op_title.png" class="logo__image only-dark" alt="OCaml Programming: Correct + Efficient + Beautiful - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Preface</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../preface/about.html">About This Book</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preface/install.html">Installing OCaml</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../intro/intro.html">1. Better Programming Through OCaml</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro/past.html">1.1. The Past of OCaml</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/present.html">1.2. The Present of OCaml</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/future.html">1.3. Look to Your Future</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/3110.html">1.4. A Brief History of CS 3110</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/summary.html">1.5. Summary</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../basics/intro.html">2. The Basics of OCaml</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../basics/toplevel.html">2.1. The OCaml Toplevel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/compiling.html">2.2. Compiling OCaml Programs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/expressions.html">2.3. Expressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/functions.html">2.4. Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/documentation.html">2.5. Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/printing.html">2.6. Printing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/debugging.html">2.7. Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/summary.html">2.8. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/exercises.html">2.9. Exercises</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">OCaml Programming</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../data/intro.html">3. Data and Types</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../data/lists.html">3.1. Lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/variants.html">3.2. Variants</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/ounit.html">3.3. Unit Testing with OUnit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/records_tuples.html">3.4. Records and Tuples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/pattern_matching_advanced.html">3.5. Advanced Pattern Matching</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/type_synonym.html">3.6. Type Synonyms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/options.html">3.7. Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/assoc_list.html">3.8. Association Lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/algebraic_data_types.html">3.9. Algebraic Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/exceptions.html">3.10. Exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/trees.html">3.11. Example: Trees</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/nats.html">3.12. Example: Natural Numbers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/summary.html">3.13. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/exercises.html">3.14. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../hop/intro.html">4. Higher-Order Programming</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../hop/higher_order.html">4.1. Higher-Order Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/map.html">4.2. Map</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/filter.html">4.3. Filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/fold.html">4.4. Fold</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/beyond_lists.html">4.5. Beyond Lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/pipelining.html">4.6. Pipelining</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/currying.html">4.7. Currying</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/summary.html">4.8. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hop/exercises.html">4.9. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../modules/intro.html">5. Modular Programming</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/module_systems.html">5.1. Module Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/modules.html">5.2. Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/toplevel.html">5.3. Modules and the Toplevel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/encapsulation.html">5.4. Encapsulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/compilation_units.html">5.5. Compilation Units</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/functional_data_structures.html">5.6. Functional Data Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/module_type_constraints.html">5.7. Module Type Constraints</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/includes.html">5.8. Includes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/functors.html">5.9. Functors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/summary.html">5.10. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/exercises.html">5.11. Exercises</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Correctness and Efficiency</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../correctness/intro.html">6. Correctness</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../correctness/specifications.html">6.1. Specifications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/function_docs.html">6.2. Function Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/module_docs.html">6.3. Module Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/test_debug.html">6.4. Testing and Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/black_glass_box.html">6.5. Black-box and Glass-box Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/randomized.html">6.6. Randomized Testing with QCheck</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/proving_correctness.html">6.7. Proving Correctness</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/structural_induction.html">6.8. Structural Induction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/eq_spec.html">6.9. Equational Specification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/summary.html">6.10. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correctness/exercises.html">6.11. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../mut/intro.html">7. Mutability</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../mut/refs.html">7.1. Refs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mut/mutable_fields.html">7.2. Mutable Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mut/arrays.html">7.3. Arrays and Loops</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mut/summary.html">7.4. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mut/exercises.html">7.5. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="intro.html">8. Data Structures</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">8.1. Hash Tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="amortized.html">8.2. Amortized Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="rb.html">8.3. Red-Black Trees</a></li>
<li class="toctree-l2"><a class="reference internal" href="sequence.html">8.4. Sequences</a></li>
<li class="toctree-l2"><a class="reference internal" href="memoization.html">8.5. Memoization</a></li>
<li class="toctree-l2"><a class="reference internal" href="parrays.html">8.6. Persistent Arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="promises.html">8.7. Promises</a></li>
<li class="toctree-l2"><a class="reference internal" href="monads.html">8.8. Monads</a></li>
<li class="toctree-l2"><a class="reference internal" href="summary.html">8.9. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="exercises.html">8.10. Exercises</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Language Implementation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../interp/intro.html">9. Interpreters</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../interp/calculator.html">9.1. Example: Calculator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/parsing.html">9.2. Parsing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/substitution.html">9.3. Substitution Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/environment.html">9.4. Environment Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/typecheck.html">9.5. Type Checking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/inference.html">9.6. Type Inference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/summary.html">9.7. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interp/exercises.html">9.8. Exercises</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Lagniappe</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../adv/curry-howard.html">The Curry-Howard Correspondence</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../appendix/bigoh.html">Big-Oh Notation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/vm.html">Virtual Machine</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/cs3110/textbook/main?urlpath=tree/src/chapters/ds/hash_tables.md" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/cs3110/textbook" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/cs3110/textbook/edit/main/src/chapters/ds/hash_tables.md" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/cs3110/textbook/issues/new?title=Issue%20on%20page%20%2Fchapters/ds/hash_tables.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/chapters/ds/hash_tables.ipynb" target="_blank"
   class="btn btn-sm btn-download-notebook-button dropdown-item"
   title="Download notebook file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li><a href="../../_sources/chapters/ds/hash_tables.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Hash Tables</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#maps">8.1.1. Maps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#maps-as-association-lists">8.1.2. Maps as Association Lists</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#maps-as-arrays">8.1.3. Maps as Arrays</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#maps-as-hash-tables">8.1.4. Maps as Hash Tables</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#chaining-representation">8.1.4.1. Chaining Representation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#resizing">8.1.4.2. Resizing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation">8.1.4.3. Implementation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hash-functions">8.1.5. Hash Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#standard-library-hashtbl">8.1.6. Standard Library <code class="docutils literal notranslate"><span class="pre">Hashtbl</span></code></a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="hash-tables">
<h1><span class="section-number">8.1. </span>Hash Tables<a class="headerlink" href="#hash-tables" title="Permalink to this heading">#</a></h1>
<p>The <em>hash table</em> is a widely used data structure whose performance relies upon
mutability. The implementation of a hash table is quite involved compared to
other data structures we’ve implemented so far. We’ll build it up slowly, so
that the need for and use of each piece can be appreciated.</p>
<section id="maps">
<h2><span class="section-number">8.1.1. </span>Maps<a class="headerlink" href="#maps" title="Permalink to this heading">#</a></h2>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/hr8SmQK8ld8" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/I5E_BPkE_fE" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>Hash tables implement the <em>map</em> data abstraction. A map binds <em>keys</em> to
<em>values</em>. This abstraction is so useful that it goes by many other names, among
them <em>associative array</em>, <em>dictionary</em>, and <em>symbol table</em>. We’ll write maps
abstractly (i.e, mathematically; not actually OCaml syntax) as { <span class="math notranslate nohighlight">\(k_1 : v_1,
k_2: v_2, \ldots, k_n : v_n\)</span> }. Each <span class="math notranslate nohighlight">\(k : v\)</span> is a <em>binding</em> of key <span class="math notranslate nohighlight">\(k\)</span> to value
<span class="math notranslate nohighlight">\(v\)</span>. Here are a couple of examples:</p>
<ul class="simple">
<li><p>A map binding a course number to something about it: {3110 : “Fun”, 2110 :
“OO”}.</p></li>
<li><p>A map binding a university name to the year it was chartered: {“Harvard” :
1636, “Princeton” : 1746, “Penn”: 1740, “Cornell” : 1865}.</p></li>
</ul>
<p>The order in which the bindings are abstractly written does not matter, so the
first example might also be written {2110 : “OO”, 3110 : “Fun”}. That’s why we
use set braces—they suggest that the bindings are a set, with no ordering
implied.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As that notation suggests, maps and sets are very similar. Data structures that
can implement a set can also implement a map, and vice-versa:</p>
<ul class="simple">
<li><p>Given a map data structure, we can treat the keys as elements of a set, and
simply ignore the values which the keys are bound to. This admittedly wastes a
little space, because we never need the values.</p></li>
<li><p>Given a set data structure, we can store key–value pairs as the
elements. Searching for elements (hence insertion and removal) might become
more expensive, because the set abstraction is unlikely to support searching
for keys by themselves.</p></li>
</ul>
</div>
<p>Here is an interface for maps:</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="k">type</span> <span class="nc">Map</span> <span class="o">=</span> <span class="k">sig</span>

  <span class="c">(** [(&#39;k, &#39;v) t] is the type of maps that bind keys of type</span>
<span class="c">      [&#39;k] to values of type [&#39;v]. *)</span>
  <span class="k">type</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">k</span><span class="o">,</span> <span class="k">&#39;</span><span class="n">v</span><span class="o">)</span> <span class="n">t</span>

  <span class="c">(** [insert k v m] is the same map as [m], but with an additional</span>
<span class="c">      binding from [k] to [v].  If [k] was already bound in [m],</span>
<span class="c">      that binding is replaced by the binding to [v] in the new map. *)</span>
  <span class="k">val</span> <span class="n">insert</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">k</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">v</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">k</span><span class="o">,</span> <span class="k">&#39;</span><span class="n">v</span><span class="o">)</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">k</span><span class="o">,</span> <span class="k">&#39;</span><span class="n">v</span><span class="o">)</span> <span class="n">t</span>

  <span class="c">(** [find k m] is [Some v] if [k] is bound to [v] in [m],</span>
<span class="c">      and [None] if not. *)</span>
  <span class="k">val</span> <span class="n">find</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">k</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">k</span><span class="o">,</span> <span class="k">&#39;</span><span class="n">v</span><span class="o">)</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">v</span> <span class="n">option</span>

  <span class="c">(** [remove k m] is the same map as [m], but without any binding of [k].</span>
<span class="c">      If [k] was not bound in [m], then the map is unchanged. *)</span>
  <span class="k">val</span> <span class="n">remove</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">k</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">k</span><span class="o">,</span> <span class="k">&#39;</span><span class="n">v</span><span class="o">)</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">k</span><span class="o">,</span> <span class="k">&#39;</span><span class="n">v</span><span class="o">)</span> <span class="n">t</span>

  <span class="c">(** [empty] is the empty map. *)</span>
  <span class="k">val</span> <span class="n">empty</span> <span class="o">:</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">k</span><span class="o">,</span> <span class="k">&#39;</span><span class="n">v</span><span class="o">)</span> <span class="n">t</span>

  <span class="c">(** [of_list lst] is a map containing the same bindings as</span>
<span class="c">      association list [lst].</span>
<span class="c">      Requires: [lst] does not contain any duplicate keys. *)</span>
  <span class="k">val</span> <span class="n">of_list</span> <span class="o">:</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">k</span> <span class="o">*</span> <span class="k">&#39;</span><span class="n">v</span><span class="o">)</span> <span class="kt">list</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">k</span><span class="o">,</span> <span class="k">&#39;</span><span class="n">v</span><span class="o">)</span> <span class="n">t</span>

  <span class="c">(** [bindings m] is an association list containing the same</span>
<span class="c">      bindings as [m]. There are no duplicates in the list. *)</span>
  <span class="k">val</span> <span class="n">bindings</span> <span class="o">:</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">k</span><span class="o">,</span> <span class="k">&#39;</span><span class="n">v</span><span class="o">)</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">k</span> <span class="o">*</span> <span class="k">&#39;</span><span class="n">v</span><span class="o">)</span> <span class="kt">list</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>module type Map =
  sig
    type (&#39;k, &#39;v) t
    val insert : &#39;k -&gt; &#39;v -&gt; (&#39;k, &#39;v) t -&gt; (&#39;k, &#39;v) t
    val find : &#39;k -&gt; (&#39;k, &#39;v) t -&gt; &#39;v option
    val remove : &#39;k -&gt; (&#39;k, &#39;v) t -&gt; (&#39;k, &#39;v) t
    val empty : (&#39;k, &#39;v) t
    val of_list : (&#39;k * &#39;v) list -&gt; (&#39;k, &#39;v) t
    val bindings : (&#39;k, &#39;v) t -&gt; (&#39;k * &#39;v) list
  end
</pre></div>
</div>
</div>
</details>
</div>
<p>Next, we’re going to examine three implementations of maps based on</p>
<ul class="simple">
<li><p>association lists,</p></li>
<li><p>arrays, and</p></li>
<li><p>a combination of the above known as a <em>hash table with chaining</em>.</p></li>
</ul>
<p>Each implementation will need a slightly different interface, because of
constraints resulting from the underlying representation type. In each case
we’ll pay close attention to the AF, RI, and efficiency of the operations.</p>
</section>
<section id="maps-as-association-lists">
<h2><span class="section-number">8.1.2. </span>Maps as Association Lists<a class="headerlink" href="#maps-as-association-lists" title="Permalink to this heading">#</a></h2>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/6JUcwUgAHl8" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>The simplest implementation of a map in OCaml is as an association list. We’ve
seen that representation twice so far <a class="reference internal" href="../data/assoc_list.html"><span class="doc std std-doc">[1]</span></a> <a class="reference internal" href="../modules/functional_data_structures.html"><span class="doc std std-doc">[2]</span></a>. Here
is an implementation of <code class="docutils literal notranslate"><span class="pre">Map</span></code> using it:</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="nc">ListMap</span> <span class="o">:</span> <span class="nc">Map</span> <span class="o">=</span> <span class="k">struct</span>
  <span class="c">(** AF: [[(k1, v1); (k2, v2); ...; (kn, vn)]] is the map {k1 : v1, k2 : v2,</span>
<span class="c">      ..., kn : vn}. If a key appears more than once in the list, then in the</span>
<span class="c">      map it is bound to the left-most occurrence in the list. For example,</span>
<span class="c">      [[(k, v1); (k, v2)]] represents {k : v1}. The empty list represents</span>
<span class="c">      the empty map.</span>
<span class="c">      RI: none. *)</span>
  <span class="k">type</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">k</span><span class="o">,</span> <span class="k">&#39;</span><span class="n">v</span><span class="o">)</span> <span class="n">t</span> <span class="o">=</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">k</span> <span class="o">*</span> <span class="k">&#39;</span><span class="n">v</span><span class="o">)</span> <span class="kt">list</span>

  <span class="c">(** Efficiency: O(1). *)</span>
  <span class="k">let</span> <span class="n">insert</span> <span class="n">k</span> <span class="n">v</span> <span class="n">m</span> <span class="o">=</span> <span class="o">(</span><span class="n">k</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="o">::</span> <span class="n">m</span>

  <span class="c">(** Efficiency: O(n). *)</span>
  <span class="k">let</span> <span class="n">find</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">assoc_opt</span>

  <span class="c">(** Efficiency: O(n). *)</span>
  <span class="k">let</span> <span class="n">remove</span> <span class="n">k</span> <span class="n">lst</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">filter</span> <span class="o">(</span><span class="k">fun</span> <span class="o">(</span><span class="n">k&#39;</span><span class="o">,</span> <span class="o">_)</span> <span class="o">-&gt;</span> <span class="n">k</span> <span class="o">&lt;&gt;</span> <span class="n">k&#39;</span><span class="o">)</span> <span class="n">lst</span>

  <span class="c">(** Efficiency: O(1). *)</span>
  <span class="k">let</span> <span class="n">empty</span> <span class="o">=</span> <span class="bp">[]</span>

  <span class="c">(** Efficiency: O(1). *)</span>
  <span class="k">let</span> <span class="n">of_list</span> <span class="n">lst</span> <span class="o">=</span> <span class="n">lst</span>

  <span class="c">(** [keys m] is a list of the keys in [m], without</span>
<span class="c">      any duplicates.</span>
<span class="c">      Efficiency: O(n log n). *)</span>
  <span class="k">let</span> <span class="n">keys</span> <span class="n">m</span> <span class="o">=</span> <span class="n">m</span> <span class="o">|&gt;</span> <span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="n">fst</span> <span class="o">|&gt;</span> <span class="nn">List</span><span class="p">.</span><span class="n">sort_uniq</span> <span class="nn">Stdlib</span><span class="p">.</span><span class="n">compare</span>

  <span class="c">(** [binding m k] is [(k, v)], where [v] is the value that [k]</span>
<span class="c">      binds in [m].</span>
<span class="c">      Requires: [k] is a key in [m].</span>
<span class="c">      Efficiency: O(n). *)</span>
  <span class="k">let</span> <span class="n">binding</span> <span class="n">m</span> <span class="n">k</span> <span class="o">=</span> <span class="o">(</span><span class="n">k</span><span class="o">,</span> <span class="nn">List</span><span class="p">.</span><span class="n">assoc</span> <span class="n">k</span> <span class="n">m</span><span class="o">)</span>

  <span class="c">(** Efficiency: O(n log n) + O(n) * O(n), which is O(n^2). *)</span>
  <span class="k">let</span> <span class="n">bindings</span> <span class="n">m</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="o">(</span><span class="n">binding</span> <span class="n">m</span><span class="o">)</span> <span class="o">(</span><span class="n">keys</span> <span class="n">m</span><span class="o">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>module ListMap : Map
</pre></div>
</div>
</div>
</details>
</div>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/yZkQhcIM0OA" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/5aZNbVTXmtE" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/bKFfD3oHKTE" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/ek2Obhfx064" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
</section>
<section id="maps-as-arrays">
<h2><span class="section-number">8.1.3. </span>Maps as Arrays<a class="headerlink" href="#maps-as-arrays" title="Permalink to this heading">#</a></h2>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/cUEN8sFVkS4" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p><em>Mutable maps</em> are maps whose bindings may be mutated. The interface for a
mutable map therefore differs from an immutable map. Insertion and removal
operations for a mutable map therefore return <code class="docutils literal notranslate"><span class="pre">unit</span></code>, because they do not
produce a new map but instead mutate an existing map.</p>
<p>An array can be used to represent a mutable map whose keys are integers. A
binding from a key to a value is stored by using the key as an index into the
array, and storing the binding at that index. For example, we could use an array
to map office numbers to their occupants:</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Office</p></th>
<th class="head"><p>Occupant</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>459</p></td>
<td><p>Fan</p></td>
</tr>
<tr class="row-odd"><td><p>460</p></td>
<td><p>Gries</p></td>
</tr>
<tr class="row-even"><td><p>461</p></td>
<td><p>Clarkson</p></td>
</tr>
<tr class="row-odd"><td><p>462</p></td>
<td><p>Muhlberger</p></td>
</tr>
<tr class="row-even"><td><p>463</p></td>
<td><p><em>does not exist</em></p></td>
</tr>
</tbody>
</table>
<p>This kind of map is called a <em>direct address table</em>. Since arrays have a fixed
size, the implementer now needs to know the client’s desire for the <em>capacity</em>
of the table (i.e., the number of bindings that can be stored in it) whenever an
empty table is created. That leads to the following interface:</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="k">type</span> <span class="nc">DirectAddressMap</span> <span class="o">=</span> <span class="k">sig</span>
  <span class="c">(** [t] is the type of maps that bind keys of type int to values of</span>
<span class="c">      type [&#39;v]. *)</span>
  <span class="k">type</span> <span class="k">&#39;</span><span class="n">v</span> <span class="n">t</span>

  <span class="c">(** [insert k v m] mutates map [m] to bind [k] to [v]. If [k] was</span>
<span class="c">      already bound in [m], that binding is replaced by the binding to</span>
<span class="c">      [v] in the new map. Requires: [k] is in bounds for [m]. *)</span>
  <span class="k">val</span> <span class="n">insert</span> <span class="o">:</span> <span class="kt">int</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">v</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">v</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="kt">unit</span>

  <span class="c">(** [find k m] is [Some v] if [k] is bound to [v] in [m], and [None]</span>
<span class="c">      if not. Requires: [k] is in bounds for [m]. *)</span>
  <span class="k">val</span> <span class="n">find</span> <span class="o">:</span> <span class="kt">int</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">v</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">v</span> <span class="n">option</span>

  <span class="c">(** [remove k m] mutates [m] to remove any binding of [k]. If [k] was</span>
<span class="c">      not bound in [m], then the map is unchanged. Requires: [k] is in</span>
<span class="c">      bounds for [m]. *)</span>
  <span class="k">val</span> <span class="n">remove</span> <span class="o">:</span> <span class="kt">int</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">v</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="kt">unit</span>

  <span class="c">(** [create c] creates a map with capacity [c]. Keys [0] through [c-1]</span>
<span class="c">      are _in bounds_ for the map. *)</span>
  <span class="k">val</span> <span class="n">create</span> <span class="o">:</span> <span class="kt">int</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">v</span> <span class="n">t</span>

  <span class="c">(** [of_list c lst] is a map containing the same bindings as</span>
<span class="c">      association list [lst] and with capacity [c]. Requires: [lst] does</span>
<span class="c">      not contain any duplicate keys, and every key in [lst] is in</span>
<span class="c">      bounds for capacity [c]. *)</span>
  <span class="k">val</span> <span class="n">of_list</span> <span class="o">:</span> <span class="kt">int</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="kt">int</span> <span class="o">*</span> <span class="k">&#39;</span><span class="n">v</span><span class="o">)</span> <span class="kt">list</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">v</span> <span class="n">t</span>

  <span class="c">(** [bindings m] is an association list containing the same bindings</span>
<span class="c">      as [m]. There are no duplicate keys in the list. *)</span>
  <span class="k">val</span> <span class="n">bindings</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">v</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="kt">int</span> <span class="o">*</span> <span class="k">&#39;</span><span class="n">v</span><span class="o">)</span> <span class="kt">list</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>module type DirectAddressMap =
  sig
    type &#39;v t
    val insert : int -&gt; &#39;v -&gt; &#39;v t -&gt; unit
    val find : int -&gt; &#39;v t -&gt; &#39;v option
    val remove : int -&gt; &#39;v t -&gt; unit
    val create : int -&gt; &#39;v t
    val of_list : int -&gt; (int * &#39;v) list -&gt; &#39;v t
    val bindings : &#39;v t -&gt; (int * &#39;v) list
  end
</pre></div>
</div>
</div>
</details>
</div>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/eDd9i-imDYo" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>Here is an implementation of that interface:</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="nc">ArrayMap</span> <span class="o">:</span> <span class="nc">DirectAddressMap</span> <span class="o">=</span> <span class="k">struct</span>
  <span class="c">(** AF: [[|Some v0; Some v1; ... |]] represents {0 : v0, 1 : v1, ...}.</span>
<span class="c">      If element [i] of the array is instead [None], then [i] is not</span>
<span class="c">      bound in the map.</span>
<span class="c">      RI: None. *)</span>
  <span class="k">type</span> <span class="k">&#39;</span><span class="n">v</span> <span class="n">t</span> <span class="o">=</span> <span class="k">&#39;</span><span class="n">v</span> <span class="n">option</span> <span class="kt">array</span>

  <span class="c">(** Efficiency: O(1). *)</span>
  <span class="k">let</span> <span class="n">insert</span> <span class="n">k</span> <span class="n">v</span> <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">.(</span><span class="n">k</span><span class="o">)</span> <span class="o">&lt;-</span> <span class="nc">Some</span> <span class="n">v</span>

  <span class="c">(** Efficiency: O(1). *)</span>
  <span class="k">let</span> <span class="n">find</span> <span class="n">k</span> <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">.(</span><span class="n">k</span><span class="o">)</span>

  <span class="c">(** Efficiency: O(1). *)</span>
  <span class="k">let</span> <span class="n">remove</span> <span class="n">k</span> <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">.(</span><span class="n">k</span><span class="o">)</span> <span class="o">&lt;-</span> <span class="nc">None</span>

  <span class="c">(** Efficiency: O(c). *)</span>
  <span class="k">let</span> <span class="n">create</span> <span class="n">c</span> <span class="o">=</span> <span class="nn">Array</span><span class="p">.</span><span class="n">make</span> <span class="n">c</span> <span class="nc">None</span>

  <span class="c">(** Efficiency: O(c). *)</span>
  <span class="k">let</span> <span class="n">of_list</span> <span class="n">c</span> <span class="n">lst</span> <span class="o">=</span>
    <span class="c">(* O(c) *)</span>
    <span class="k">let</span> <span class="n">a</span> <span class="o">=</span> <span class="n">create</span> <span class="n">c</span> <span class="k">in</span>
    <span class="c">(* O(c) * O(1) = O(c) *)</span>
    <span class="nn">List</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="k">fun</span> <span class="o">(</span><span class="n">k</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">insert</span> <span class="n">k</span> <span class="n">v</span> <span class="n">a</span><span class="o">)</span> <span class="n">lst</span><span class="o">;</span>
    <span class="n">a</span>

  <span class="c">(** Efficiency: O(c). *)</span>
  <span class="k">let</span> <span class="n">bindings</span> <span class="n">a</span> <span class="o">=</span>
    <span class="k">let</span> <span class="n">bs</span> <span class="o">=</span> <span class="n">ref</span> <span class="bp">[]</span> <span class="k">in</span>
    <span class="c">(* O(1) *)</span>
    <span class="k">let</span> <span class="n">add_binding</span> <span class="n">k</span> <span class="n">v</span> <span class="o">=</span>
      <span class="k">match</span> <span class="n">v</span> <span class="k">with</span> <span class="nc">None</span> <span class="o">-&gt;</span> <span class="bp">()</span> <span class="o">|</span> <span class="nc">Some</span> <span class="n">v</span> <span class="o">-&gt;</span> <span class="n">bs</span> <span class="o">:=</span> <span class="o">(</span><span class="n">k</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="o">::</span> <span class="o">!</span><span class="n">bs</span>
    <span class="k">in</span>
    <span class="c">(* O(c) *)</span>
    <span class="nn">Array</span><span class="p">.</span><span class="n">iteri</span> <span class="n">add_binding</span> <span class="n">a</span><span class="o">;</span>
    <span class="o">!</span><span class="n">bs</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>module ArrayMap : DirectAddressMap
</pre></div>
</div>
</div>
</details>
</div>
<p>Its efficiency is great! The <code class="docutils literal notranslate"><span class="pre">insert</span></code>, <code class="docutils literal notranslate"><span class="pre">find</span></code>, and <code class="docutils literal notranslate"><span class="pre">remove</span></code> operations are
constant time. But that comes at the expense of forcing keys to be integers.
Moreover, they need to be small integers (or at least integers from a small
range), otherwise the arrays we use will need to be huge.</p>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/mrpti_Guevs" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
</section>
<section id="maps-as-hash-tables">
<h2><span class="section-number">8.1.4. </span>Maps as Hash Tables<a class="headerlink" href="#maps-as-hash-tables" title="Permalink to this heading">#</a></h2>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/NyZ07rpq7tk" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>Arrays offer constant time performance, but come with severe restrictions on
keys. Association lists don’t place those restrictions on keys, but they also
don’t offer constant time performance. Is there a way to get the best of both
worlds? Yes (more or less)! <em>Hash tables</em> are the solution.</p>
<p>The key idea is that we assume the existence of a <em>hash function</em> <code class="docutils literal notranslate"><span class="pre">hash</span> <span class="pre">:</span> <span class="pre">'a</span> <span class="pre">-&gt;</span> <span class="pre">int</span></code> that can convert any key to a non-negative integer. Then we can use that
function to index into an array, as we did with direct address tables. Of
course, we want the hash function itself to run in constant time, otherwise the
operations that use it would not be efficient.</p>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/8IJpySZ5iLM" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>That leads to the following interface, in which the client of the hash table has
to pass in a hash function when a table is created:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="k">type</span> <span class="nc">TableMap</span> <span class="o">=</span> <span class="k">sig</span>
  <span class="c">(** [(&#39;k, &#39;v) t] is the type of mutable table-based maps that bind</span>
<span class="c">      keys of type [&#39;k] to values of type [&#39;v]. *)</span>
  <span class="k">type</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">k</span><span class="o">,</span> <span class="k">&#39;</span><span class="n">v</span><span class="o">)</span> <span class="n">t</span>

  <span class="c">(** [insert k v m] mutates map [m] to bind [k] to [v]. If [k] was</span>
<span class="c">      already bound in [m], that binding is replaced by the binding to</span>
<span class="c">      [v]. *)</span>
  <span class="k">val</span> <span class="n">insert</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">k</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">v</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">k</span><span class="o">,</span> <span class="k">&#39;</span><span class="n">v</span><span class="o">)</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="kt">unit</span>

  <span class="c">(** [find k m] is [Some v] if [m] binds [k] to [v], and [None] if [m]</span>
<span class="c">      does not bind [k]. *)</span>
  <span class="k">val</span> <span class="n">find</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">k</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">k</span><span class="o">,</span> <span class="k">&#39;</span><span class="n">v</span><span class="o">)</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">v</span> <span class="n">option</span>

  <span class="c">(** [remove k m] mutates [m] to remove any binding of [k]. If [k] was</span>
<span class="c">      not bound in [m], the map is unchanged. *)</span>
  <span class="k">val</span> <span class="n">remove</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">k</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">k</span><span class="o">,</span> <span class="k">&#39;</span><span class="n">v</span><span class="o">)</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="kt">unit</span>

  <span class="c">(** [create hash c] creates a new table map with capacity [c] that</span>
<span class="c">      will use [hash] as the function to convert keys to integers.</span>
<span class="c">      Requires: The output of [hash] is always non-negative, and [hash]</span>
<span class="c">      runs in constant time. *)</span>
  <span class="k">val</span> <span class="n">create</span> <span class="o">:</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">k</span> <span class="o">-&gt;</span> <span class="kt">int</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="kt">int</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">k</span><span class="o">,</span> <span class="k">&#39;</span><span class="n">v</span><span class="o">)</span> <span class="n">t</span>

  <span class="c">(** [bindings m] is an association list containing the same bindings</span>
<span class="c">      as [m]. *)</span>
  <span class="k">val</span> <span class="n">bindings</span> <span class="o">:</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">k</span><span class="o">,</span> <span class="k">&#39;</span><span class="n">v</span><span class="o">)</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">k</span> <span class="o">*</span> <span class="k">&#39;</span><span class="n">v</span><span class="o">)</span> <span class="kt">list</span>

  <span class="c">(** [of_list hash lst] creates a map with the same bindings as [lst],</span>
<span class="c">      using [hash] as the hash function. Requires: [lst] does not</span>
<span class="c">      contain any duplicate keys. *)</span>
  <span class="k">val</span> <span class="n">of_list</span> <span class="o">:</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">k</span> <span class="o">-&gt;</span> <span class="kt">int</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">k</span> <span class="o">*</span> <span class="k">&#39;</span><span class="n">v</span><span class="o">)</span> <span class="kt">list</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">k</span><span class="o">,</span> <span class="k">&#39;</span><span class="n">v</span><span class="o">)</span> <span class="n">t</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>module type TableMap =
  sig
    type (&#39;k, &#39;v) t
    val insert : &#39;k -&gt; &#39;v -&gt; (&#39;k, &#39;v) t -&gt; unit
    val find : &#39;k -&gt; (&#39;k, &#39;v) t -&gt; &#39;v option
    val remove : &#39;k -&gt; (&#39;k, &#39;v) t -&gt; unit
    val create : (&#39;k -&gt; int) -&gt; int -&gt; (&#39;k, &#39;v) t
    val bindings : (&#39;k, &#39;v) t -&gt; (&#39;k * &#39;v) list
    val of_list : (&#39;k -&gt; int) -&gt; (&#39;k * &#39;v) list -&gt; (&#39;k, &#39;v) t
  end
</pre></div>
</div>
</div>
</div>
<p>One immediate problem with this idea is what to do if the output of the hash is
not within the bounds of the array. It’s easy to solve this: if <code class="docutils literal notranslate"><span class="pre">a</span></code> is the
length of the array then computing <code class="docutils literal notranslate"><span class="pre">(hash</span> <span class="pre">k)</span> <span class="pre">mod</span> <span class="pre">a</span></code> will return an index that is
within bounds.</p>
<p>Another problem is what to do if the hash function is not <em>injective</em>, meaning
that it is not one-to-one. Then multiple keys could <em>collide</em> and need to be
stored at the same index in the array. That’s okay! We deliberately allow that.
But it does mean we need a strategy for what to do when keys collide.</p>
<p>There are two well-known strategies for dealing with collisions. One is to store
multiple bindings at each array index. The array elements are called <em>buckets</em>.
Typically, the bucket is implemented as a linked list. This strategy is known by
many names, including <em>chaining</em>, <em>closed addressing</em>, and <em>open hashing</em>. We’ll
use <strong>chaining</strong> as the name. To check whether an element is in the hash table,
the key is first hashed to find the correct bucket to look in. Then, the linked
list is scanned to see if the desired element is present. If the linked list is
short, this scan is very quick. An element is added or removed by hashing it to
find the correct bucket. Then, the bucket is checked to see if the element is
there, and finally the element is added or removed appropriately from the bucket
in the usual way for linked lists.</p>
<p>The other strategy is to store bindings at places other than their proper
location according to the hash. When adding a new binding to the hash table
would create a collision, the insert operation instead finds an empty location
in the array to put the binding. This strategy is (confusingly) known as
<em>probing</em>, <em>open addressing</em>, and <em>closed hashing</em>. We’ll use <strong>probing</strong> as the
name. A simple way to find an empty location is to search ahead through the
array indices with a fixed stride (often 1), looking for an unused entry; this
<em>linear probing</em> strategy tends to produce a lot of clustering of elements in
the table, leading to bad performance. A better strategy is to use a second hash
function to compute the probing interval; this strategy is called <em>double
hashing</em>. Regardless of how probing is implemented, however, the time required
to search for or add an element grows rapidly as the hash table fills up.</p>
<p>Chaining has often been preferred over probing in software implementations,
because it’s easy to implement the linked lists in software. Hardware
implementations have often used probing, when the size of the table is fixed by
circuitry. But some modern software implementations are re-examining the
performance benefits of probing.</p>
<section id="chaining-representation">
<h3><span class="section-number">8.1.4.1. </span>Chaining Representation<a class="headerlink" href="#chaining-representation" title="Permalink to this heading">#</a></h3>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/LOWAC3WOl6Q" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>Here is a representation type for a hash table that uses chaining:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">type</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">k</span><span class="o">,</span> <span class="k">&#39;</span><span class="n">v</span><span class="o">)</span> <span class="n">t</span> <span class="o">=</span> <span class="o">{</span>
  <span class="n">hash</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">k</span> <span class="o">-&gt;</span> <span class="kt">int</span><span class="o">;</span>
  <span class="k">mutable</span> <span class="n">size</span> <span class="o">:</span> <span class="kt">int</span><span class="o">;</span>
  <span class="k">mutable</span> <span class="n">buckets</span> <span class="o">:</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">k</span> <span class="o">*</span> <span class="k">&#39;</span><span class="n">v</span><span class="o">)</span> <span class="kt">list</span> <span class="kt">array</span>
<span class="o">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">buckets</span></code> array has elements that are association lists, which store the
bindings. The <code class="docutils literal notranslate"><span class="pre">hash</span></code> function is used to determine which bucket a key goes into.
The <code class="docutils literal notranslate"><span class="pre">size</span></code> is used to keep track of the number of bindings currently in the
table, since that would be expensive to compute by iterating over <code class="docutils literal notranslate"><span class="pre">buckets</span></code>.</p>
<p>Here are the AF and RI:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="p">(</span><span class="o">**</span> <span class="n">AF</span><span class="p">:</span>  <span class="n">If</span> <span class="p">[</span><span class="n">buckets</span><span class="p">]</span> <span class="ow">is</span>
        <span class="p">[</span><span class="o">|</span> <span class="p">[(</span><span class="n">k11</span><span class="p">,</span><span class="n">v11</span><span class="p">);</span> <span class="p">(</span><span class="n">k12</span><span class="p">,</span><span class="n">v12</span><span class="p">);</span> <span class="o">...</span><span class="p">];</span>
           <span class="p">[(</span><span class="n">k21</span><span class="p">,</span><span class="n">v21</span><span class="p">);</span> <span class="p">(</span><span class="n">k22</span><span class="p">,</span><span class="n">v22</span><span class="p">);</span> <span class="o">...</span><span class="p">];</span>
           <span class="o">...</span> <span class="o">|</span><span class="p">]</span>
      <span class="n">that</span> <span class="n">represents</span> <span class="n">the</span> <span class="nb">map</span>
        <span class="p">{</span><span class="n">k11</span><span class="p">:</span><span class="n">v11</span><span class="p">,</span> <span class="n">k12</span><span class="p">:</span><span class="n">v12</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span>
         <span class="n">k21</span><span class="p">:</span><span class="n">v21</span><span class="p">,</span> <span class="n">k22</span><span class="p">:</span><span class="n">v22</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span>  <span class="o">...</span><span class="p">}</span><span class="o">.</span>
      <span class="n">RI</span><span class="p">:</span> <span class="n">No</span> <span class="n">key</span> <span class="n">appears</span> <span class="n">more</span> <span class="n">than</span> <span class="n">once</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">array</span> <span class="p">(</span><span class="n">so</span><span class="p">,</span> <span class="n">no</span>
        <span class="n">duplicate</span> <span class="n">keys</span> <span class="ow">in</span> <span class="n">association</span> <span class="n">lists</span><span class="p">)</span><span class="o">.</span>  <span class="n">All</span> <span class="n">keys</span> <span class="n">are</span>
        <span class="ow">in</span> <span class="n">the</span> <span class="n">right</span> <span class="n">buckets</span><span class="p">:</span> <span class="k">if</span> <span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">in</span> <span class="p">[</span><span class="n">buckets</span><span class="p">]</span> <span class="n">at</span> <span class="n">index</span>
        <span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="n">then</span> <span class="p">[</span><span class="nb">hash</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">b</span><span class="p">]</span><span class="o">.</span> <span class="n">The</span> <span class="n">output</span> <span class="n">of</span> <span class="p">[</span><span class="nb">hash</span><span class="p">]</span> <span class="n">must</span> <span class="n">always</span>
        <span class="n">be</span> <span class="n">non</span><span class="o">-</span><span class="n">negative</span><span class="o">.</span> <span class="p">[</span><span class="nb">hash</span><span class="p">]</span> <span class="n">must</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">constant</span> <span class="n">time</span><span class="o">.</span> <span class="o">*</span><span class="p">)</span>
</pre></div>
</div>
<p>What would the efficiency of <code class="docutils literal notranslate"><span class="pre">insert</span></code>, <code class="docutils literal notranslate"><span class="pre">find</span></code>, and <code class="docutils literal notranslate"><span class="pre">remove</span></code> be for this rep
type? All require</p>
<ul class="simple">
<li><p>hashing the key (constant time),</p></li>
<li><p>indexing into the appropriate bucket (constant time), and</p></li>
<li><p>finding out whether the key is already in the association list (linear in the
number of elements in that list).</p></li>
</ul>
<p>So the efficiency of the hash table depends on the number of elements in each
bucket. That, in turn, is determined by how well the hash function distributes
keys across all the buckets.</p>
<p>A terrible hash function, such as the constant function <code class="docutils literal notranslate"><span class="pre">fun</span> <span class="pre">k</span> <span class="pre">-&gt;</span> <span class="pre">42</span></code>, would put
all keys into same bucket. Then every operation would be linear in the number
<span class="math notranslate nohighlight">\(n\)</span> of bindings in the map—that is, <span class="math notranslate nohighlight">\(O(n)\)</span>. We definitely don’t want
that.</p>
<p>Instead, we want hash functions that distribute keys more or less randomly
across the buckets. Then the expected length of every bucket will be about the
same. If we could arrange that, on average, the bucket length were a constant
<span class="math notranslate nohighlight">\(L\)</span>, then <code class="docutils literal notranslate"><span class="pre">insert</span></code>, <code class="docutils literal notranslate"><span class="pre">find</span></code>, and <code class="docutils literal notranslate"><span class="pre">remove</span></code> would all in expectation run in time
<span class="math notranslate nohighlight">\(O(L)\)</span>.</p>
</section>
<section id="resizing">
<h3><span class="section-number">8.1.4.2. </span>Resizing<a class="headerlink" href="#resizing" title="Permalink to this heading">#</a></h3>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/mn2pDfusFyY" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>How could we arrange buckets to have expected constant length? To answer
that, let’s think about the number of bindings and buckets in the table. Define
the <em>load factor</em> of the table to be</p>
<div class="math notranslate nohighlight">
\[
\frac{\mbox{number of bindings}}{\mbox{number of buckets}}
\]</div>
<p>So a table with 20 bindings and 10 buckets has a load factor of 2, and a table
with 10 bindings and 20 buckets has a load factor of 0.5. The load factor is
therefore the average number of bindings in a bucket. So if we could keep the
load factor constant, we could keep <span class="math notranslate nohighlight">\(L\)</span> constant, thereby keeping the
performance to (expected) constant time.</p>
<p>Toward that end, note that the number of bindings is not under the control of
the hash table implementer—but the number of buckets is. So by changing
the number of buckets, the implementer can change the load factor. A common
strategy is to keep the load factor from approximately 1/2 to 2. Then each
bucket contains only a couple bindings, and expected constant-time performance
is guaranteed.</p>
<p>There’s no way for the implementer to know in advance, though, exactly how many
buckets will be needed. So instead, the implementer will have to <em>resize</em> the
bucket array whenever the load factor gets too high. Typically, the newly
allocated bucket will be of a size to restore the load factor to about 1.</p>
<p>Putting those two ideas together, if the load factor reaches 2, then there are
twice as many bindings as buckets in the table. So by doubling the size of the
array, we can restore the load factor to 1. Similarly, if the load factor
reaches 1/2, then there are twice as many buckets as bindings, and halving the
size of the array will restore the load factor to 1.</p>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/BzusuFH1tNw" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>Resizing the bucket array to become larger is an essential technique for hash
tables. Resizing it to become smaller, though, is not essential. As long as the
load factor is bounded by a constant from above, we can achieve expected
constant bucket length. So not all implementations will reduce the size of the
array. Although doing so would recover some space, it might not be worth the
effort. That’s especially true if the size of the hash table cycles over time:
although sometimes it becomes smaller, eventually it becomes bigger again.</p>
<p>Unfortunately, resizing would seem to ruin our expected constant-time
performance though. Insertion of a binding might cause the load factor to go
over 2, thus causing a resize. When the resize occurs, all the existing bindings
must be rehashed and added to the new bucket array. Thus, insertion has become a
worst-case linear time operation! The same is true for removal, if we resize the
array to become smaller when the load factor is too low.</p>
</section>
<section id="implementation">
<h3><span class="section-number">8.1.4.3. </span>Implementation<a class="headerlink" href="#implementation" title="Permalink to this heading">#</a></h3>
<p>The implementation of a hash table, below, puts together all the pieces we
discussed above.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="nc">HashMap</span> <span class="o">:</span> <span class="nc">TableMap</span> <span class="o">=</span> <span class="k">struct</span>

  <span class="c">(** AF and RI: above. *)</span>
  <span class="k">type</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">k</span><span class="o">,</span> <span class="k">&#39;</span><span class="n">v</span><span class="o">)</span> <span class="n">t</span> <span class="o">=</span> <span class="o">{</span>
    <span class="n">hash</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">k</span> <span class="o">-&gt;</span> <span class="kt">int</span><span class="o">;</span>
    <span class="k">mutable</span> <span class="n">size</span> <span class="o">:</span> <span class="kt">int</span><span class="o">;</span>
    <span class="k">mutable</span> <span class="n">buckets</span> <span class="o">:</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">k</span> <span class="o">*</span> <span class="k">&#39;</span><span class="n">v</span><span class="o">)</span> <span class="kt">list</span> <span class="kt">array</span>
  <span class="o">}</span>

  <span class="c">(** [capacity tab] is the number of buckets in [tab].</span>
<span class="c">      Efficiency: O(1). *)</span>
  <span class="k">let</span> <span class="n">capacity</span> <span class="o">{</span><span class="n">buckets</span><span class="o">}</span> <span class="o">=</span>
    <span class="nn">Array</span><span class="p">.</span><span class="n">length</span> <span class="n">buckets</span>

  <span class="c">(** [load_factor tab] is the load factor of [tab], i.e., the number of</span>
<span class="c">      bindings divided by the number of buckets. *)</span>
  <span class="k">let</span> <span class="n">load_factor</span> <span class="n">tab</span> <span class="o">=</span>
    <span class="n">float_of_int</span> <span class="n">tab</span><span class="o">.</span><span class="n">size</span> <span class="o">/.</span> <span class="n">float_of_int</span> <span class="o">(</span><span class="n">capacity</span> <span class="n">tab</span><span class="o">)</span>

  <span class="c">(** Efficiency: O(n). *)</span>
  <span class="k">let</span> <span class="n">create</span> <span class="n">hash</span> <span class="n">n</span> <span class="o">=</span>
    <span class="o">{</span><span class="n">hash</span><span class="o">;</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">buckets</span> <span class="o">=</span> <span class="nn">Array</span><span class="p">.</span><span class="n">make</span> <span class="n">n</span> <span class="bp">[]</span><span class="o">}</span>

  <span class="c">(** [index k tab] is the index at which key [k] should be stored in the</span>
<span class="c">      buckets of [tab].</span>
<span class="c">      Efficiency: O(1). *)</span>
  <span class="k">let</span> <span class="n">index</span> <span class="n">k</span> <span class="n">tab</span> <span class="o">=</span>
    <span class="o">(</span><span class="n">tab</span><span class="o">.</span><span class="n">hash</span> <span class="n">k</span><span class="o">)</span> <span class="ow">mod</span> <span class="o">(</span><span class="n">capacity</span> <span class="n">tab</span><span class="o">)</span>

  <span class="c">(** [insert_no_resize k v tab] inserts a binding from [k] to [v] in [tab]</span>
<span class="c">      and does not resize the table, regardless of what happens to the</span>
<span class="c">      load factor.</span>
<span class="c">      Efficiency: expected O(L). *)</span>
  <span class="k">let</span> <span class="n">insert_no_resize</span> <span class="n">k</span> <span class="n">v</span> <span class="n">tab</span> <span class="o">=</span>
    <span class="k">let</span> <span class="n">b</span> <span class="o">=</span> <span class="n">index</span> <span class="n">k</span> <span class="n">tab</span> <span class="k">in</span> <span class="c">(* O(1) *)</span>
    <span class="k">let</span> <span class="n">old_bucket</span> <span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">buckets</span><span class="o">.(</span><span class="n">b</span><span class="o">)</span> <span class="k">in</span>
    <span class="n">tab</span><span class="o">.</span><span class="n">buckets</span><span class="o">.(</span><span class="n">b</span><span class="o">)</span> <span class="o">&lt;-</span> <span class="o">(</span><span class="n">k</span><span class="o">,</span><span class="n">v</span><span class="o">)</span> <span class="o">::</span> <span class="nn">List</span><span class="p">.</span><span class="n">remove_assoc</span> <span class="n">k</span> <span class="n">old_bucket</span><span class="o">;</span> <span class="c">(* O(L) *)</span>
    <span class="k">if</span> <span class="n">not</span> <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">mem_assoc</span> <span class="n">k</span> <span class="n">old_bucket</span><span class="o">)</span> <span class="k">then</span>
      <span class="n">tab</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;-</span> <span class="n">tab</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
    <span class="bp">()</span>

  <span class="c">(** [rehash tab new_capacity] replaces the buckets array of [tab] with a new</span>
<span class="c">      array of size [new_capacity], and re-inserts all the bindings of [tab]</span>
<span class="c">      into the new array.  The keys are re-hashed, so the bindings will</span>
<span class="c">      likely land in different buckets.</span>
<span class="c">      Efficiency: O(n), where n is the number of bindings. *)</span>
  <span class="k">let</span> <span class="n">rehash</span> <span class="n">tab</span> <span class="n">new_capacity</span> <span class="o">=</span>
    <span class="c">(* insert [(k, v)] into [tab] *)</span>
    <span class="k">let</span> <span class="n">rehash_binding</span> <span class="o">(</span><span class="n">k</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="o">=</span>
      <span class="n">insert_no_resize</span> <span class="n">k</span> <span class="n">v</span> <span class="n">tab</span>
    <span class="k">in</span>
    <span class="c">(* insert all bindings of bucket into [tab] *)</span>
    <span class="k">let</span> <span class="n">rehash_bucket</span> <span class="n">bucket</span> <span class="o">=</span>
      <span class="nn">List</span><span class="p">.</span><span class="n">iter</span> <span class="n">rehash_binding</span> <span class="n">bucket</span>
    <span class="k">in</span>
    <span class="k">let</span> <span class="n">old_buckets</span> <span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">buckets</span> <span class="k">in</span>
    <span class="n">tab</span><span class="o">.</span><span class="n">buckets</span> <span class="o">&lt;-</span> <span class="nn">Array</span><span class="p">.</span><span class="n">make</span> <span class="n">new_capacity</span> <span class="bp">[]</span><span class="o">;</span> <span class="c">(* O(n) *)</span>
    <span class="n">tab</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;-</span> <span class="mi">0</span><span class="o">;</span>
    <span class="c">(* [rehash_binding] is called by [rehash_bucket] once for every binding *)</span>
    <span class="nn">Array</span><span class="p">.</span><span class="n">iter</span> <span class="n">rehash_bucket</span> <span class="n">old_buckets</span> <span class="c">(* expected O(n) *)</span>

  <span class="c">(* [resize_if_needed tab] resizes and rehashes [tab] if the load factor</span>
<span class="c">     is too big or too small.  Load factors are allowed to range from</span>
<span class="c">     1/2 to 2. *)</span>
  <span class="k">let</span> <span class="n">resize_if_needed</span> <span class="n">tab</span> <span class="o">=</span>
    <span class="k">let</span> <span class="n">lf</span> <span class="o">=</span> <span class="n">load_factor</span> <span class="n">tab</span> <span class="k">in</span>
    <span class="k">if</span> <span class="n">lf</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="o">.</span><span class="mi">0</span> <span class="k">then</span>
      <span class="n">rehash</span> <span class="n">tab</span> <span class="o">(</span><span class="n">capacity</span> <span class="n">tab</span> <span class="o">*</span> <span class="mi">2</span><span class="o">)</span>
    <span class="k">else</span> <span class="k">if</span> <span class="n">lf</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">.</span><span class="mi">5</span> <span class="k">then</span>
      <span class="n">rehash</span> <span class="n">tab</span> <span class="o">(</span><span class="n">capacity</span> <span class="n">tab</span> <span class="o">/</span> <span class="mi">2</span><span class="o">)</span>
    <span class="k">else</span> <span class="bp">()</span>

  <span class="c">(** Efficiency: O(n). *)</span>
  <span class="k">let</span> <span class="n">insert</span> <span class="n">k</span> <span class="n">v</span> <span class="n">tab</span> <span class="o">=</span>
    <span class="n">insert_no_resize</span> <span class="n">k</span> <span class="n">v</span> <span class="n">tab</span><span class="o">;</span> <span class="c">(* O(L) *)</span>
    <span class="n">resize_if_needed</span> <span class="n">tab</span> <span class="c">(* O(n) *)</span>

  <span class="c">(** Efficiency: expected O(L). *)</span>
  <span class="k">let</span> <span class="n">find</span> <span class="n">k</span> <span class="n">tab</span> <span class="o">=</span>
    <span class="nn">List</span><span class="p">.</span><span class="n">assoc_opt</span> <span class="n">k</span> <span class="n">tab</span><span class="o">.</span><span class="n">buckets</span><span class="o">.(</span><span class="n">index</span> <span class="n">k</span> <span class="n">tab</span><span class="o">)</span>

  <span class="c">(** [remove_no_resize k tab] removes [k] from [tab] and does not trigger</span>
<span class="c">      a resize, regardless of what happens to the load factor.</span>
<span class="c">      Efficiency: expected O(L). *)</span>
  <span class="k">let</span> <span class="n">remove_no_resize</span> <span class="n">k</span> <span class="n">tab</span> <span class="o">=</span>
    <span class="k">let</span> <span class="n">b</span> <span class="o">=</span> <span class="n">index</span> <span class="n">k</span> <span class="n">tab</span> <span class="k">in</span>
    <span class="k">let</span> <span class="n">old_bucket</span> <span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">buckets</span><span class="o">.(</span><span class="n">b</span><span class="o">)</span> <span class="k">in</span>
    <span class="n">tab</span><span class="o">.</span><span class="n">buckets</span><span class="o">.(</span><span class="n">b</span><span class="o">)</span> <span class="o">&lt;-</span> <span class="nn">List</span><span class="p">.</span><span class="n">remove_assoc</span> <span class="n">k</span> <span class="n">tab</span><span class="o">.</span><span class="n">buckets</span><span class="o">.(</span><span class="n">b</span><span class="o">);</span>
    <span class="k">if</span> <span class="nn">List</span><span class="p">.</span><span class="n">mem_assoc</span> <span class="n">k</span> <span class="n">old_bucket</span> <span class="k">then</span>
      <span class="n">tab</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;-</span> <span class="n">tab</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="o">;</span>
    <span class="bp">()</span>

  <span class="c">(** Efficiency: O(n). *)</span>
  <span class="k">let</span> <span class="n">remove</span> <span class="n">k</span> <span class="n">tab</span> <span class="o">=</span>
    <span class="n">remove_no_resize</span> <span class="n">k</span> <span class="n">tab</span><span class="o">;</span> <span class="c">(* O(L) *)</span>
    <span class="n">resize_if_needed</span> <span class="n">tab</span> <span class="c">(* O(n) *)</span>

  <span class="c">(** Efficiency: O(n). *)</span>
  <span class="k">let</span> <span class="n">bindings</span> <span class="n">tab</span> <span class="o">=</span>
    <span class="nn">Array</span><span class="p">.</span><span class="n">fold_left</span>
      <span class="o">(</span><span class="k">fun</span> <span class="n">acc</span> <span class="n">bucket</span> <span class="o">-&gt;</span>
         <span class="nn">List</span><span class="p">.</span><span class="n">fold_left</span>
           <span class="c">(* 1 cons for every binding, which is O(n) *)</span>
           <span class="o">(</span><span class="k">fun</span> <span class="n">acc</span> <span class="o">(</span><span class="n">k</span><span class="o">,</span><span class="n">v</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="n">k</span><span class="o">,</span><span class="n">v</span><span class="o">)</span> <span class="o">::</span> <span class="n">acc</span><span class="o">)</span>
           <span class="n">acc</span> <span class="n">bucket</span><span class="o">)</span>
      <span class="bp">[]</span> <span class="n">tab</span><span class="o">.</span><span class="n">buckets</span>

  <span class="c">(** Efficiency: O(n^2). *)</span>
  <span class="k">let</span> <span class="n">of_list</span> <span class="n">hash</span> <span class="n">lst</span> <span class="o">=</span>
    <span class="k">let</span> <span class="n">m</span> <span class="o">=</span> <span class="n">create</span> <span class="n">hash</span> <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">length</span> <span class="n">lst</span><span class="o">)</span> <span class="k">in</span>  <span class="c">(* O(n) *)</span>
    <span class="nn">List</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="k">fun</span> <span class="o">(</span><span class="n">k</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">insert</span> <span class="n">k</span> <span class="n">v</span> <span class="n">m</span><span class="o">)</span> <span class="n">lst</span><span class="o">;</span> <span class="c">(* n * O(n) is O(n^2) *)</span>
    <span class="n">m</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>module HashMap : TableMap
</pre></div>
</div>
</div>
</details>
</div>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/FN-YyNaSkz8" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/Du4SxDJzS6g" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/GKtcy5AfPgc" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/YQUHqv-RXI8" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>An optimization of <code class="docutils literal notranslate"><span class="pre">rehash</span></code> is possible. When it calls <code class="docutils literal notranslate"><span class="pre">insert_no_resize</span></code> to
re-insert a binding, extra work is being done: there’s no need for that
insertion to call <code class="docutils literal notranslate"><span class="pre">remove_assoc</span></code> or <code class="docutils literal notranslate"><span class="pre">mem_assoc</span></code>, because we are guaranteed the
binding does not contain a duplicate key. We could omit that work. If the hash
function is good, it’s only a constant amount of work that we save. But if the
hash function is bad and doesn’t distribute keys uniformly, that could be an
important optimization.</p>
</section>
</section>
<section id="hash-functions">
<h2><span class="section-number">8.1.5. </span>Hash Functions<a class="headerlink" href="#hash-functions" title="Permalink to this heading">#</a></h2>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/tGktnJWmCy0" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>Hash tables are one of the most useful data structures ever invented.
Unfortunately, they are also one of the most misused. Code built using hash
tables often falls far short of achievable performance. There are two reasons
for this:</p>
<ul class="simple">
<li><p>Clients choose poor hash functions that do not distribute keys randomly over
buckets.</p></li>
<li><p>Hash table abstractions do not adequately specify what is required of the hash
function, or make it difficult to provide a good hash function.</p></li>
</ul>
<p>Clearly, a bad hash function can destroy our attempts at a constant running
time. A lot of obvious hash function choices are bad. For example, if we’re
mapping names to phone numbers, then hashing each name to its length would be a
very poor function, as would a hash function that used only the first name, or
only the last name. We want our hash function to use all of the information in
the key. This is a bit of an art. While hash tables are extremely effective when
used well, all too often poor hash functions are used that sabotage performance.</p>
<p>Hash tables work well when the hash function looks random. If it is to look
random, this means that any change to a key, even a small one, should change the
bucket index in an apparently random way. If we imagine writing the bucket index
as a binary number, a small change to the key should randomly flip the bits in
the bucket index. This is called information <em>diffusion</em>. For example, a one-bit
change to the key should cause every bit in the index to flip with 1/2
probability.</p>
<p><strong>Client vs. implementer.</strong> As we’ve described it, the hash function is a single
function that maps from the key type to a bucket index. In practice, the hash
function is the composition of <em>two</em> functions, one provided by the client and
one by the implementer. This is because the implementer doesn’t understand the
element type, the client doesn’t know how many buckets there are, and the
implementer probably doesn’t trust the client to achieve diffusion.</p>
<p>The client function <code class="docutils literal notranslate"><span class="pre">hash_c</span></code> first converts the key into an integer hash code,
and the implementation function <code class="docutils literal notranslate"><span class="pre">hash_i</span></code> converts the hash code into a bucket
index. The actual hash function is the composition of these two functions. As a
hash table designer, you need to figure out which of the client hash function
and the implementation hash function is going to provide diffusion. If clients
are sufficiently savvy, it makes sense to push the diffusion onto them, leaving
the hash table implementation as simple and fast as possible. The easy way to
accomplish this is to break the computation of the bucket index into three
steps.</p>
<ol class="arabic simple">
<li><p>Serialization: Transform the key into a stream of bytes that contains all of
the information in the original key. Two equal keys must result in the same
byte stream. Two byte streams should be equal only if the keys are actually
equal. How to do this depends on the form of the key. If the key is a
string, then the stream of bytes would simply be the characters of the
string.</p></li>
<li><p>Diffusion: Map the stream of bytes into a large integer <em>x</em> in a way that
causes every change in the stream to affect the bits of <em>x</em> apparently
randomly. There is a tradeoff in performance versus randomness (and
security) here.</p></li>
<li><p>Compression: Reduce that large integer to be within the range of the
buckets. For example, compute the hash bucket index as <em>x</em> mod <em>m</em>. This
is particularly cheap if <em>m</em> is a power of two.</p></li>
</ol>
<p>Unfortunately, hash table implementations are rarely forthcoming about what they
assume of client hash functions. So it can be hard to know, as a client, how to
get good performance from a table. The more information the implementation can
provide to a client about how well distributed keys are in buckets, the better.</p>
</section>
<section id="standard-library-hashtbl">
<h2><span class="section-number">8.1.6. </span>Standard Library <code class="docutils literal notranslate"><span class="pre">Hashtbl</span></code><a class="headerlink" href="#standard-library-hashtbl" title="Permalink to this heading">#</a></h2>
<p>Although it’s great to know how to implement a hash table, and to see how
mutability is used in doing so, it’s also great <em>not</em> to have to implement a
data structure yourself in your own projects. Fortunately the OCaml standard
library does provide a module <code class="docutils literal notranslate"><span class="pre">Hashtbl</span></code> [sic] that implements hash tables. You
can think of this module as the imperative equivalent of the functional <code class="docutils literal notranslate"><span class="pre">Map</span></code>
module.</p>
<p><strong>Hash function.</strong> The function <code class="docutils literal notranslate"><span class="pre">Hashtbl.hash</span> <span class="pre">:</span> <span class="pre">'a</span> <span class="pre">-&gt;</span> <span class="pre">int</span></code> takes responsibility
for serialization and diffusion. It is capable of hashing any type of value.
That includes not just integers but strings, lists, trees, and so forth. So how
does it run in constant time, if the length of a tree or size of a tree can be
arbitrarily large? It looks only at a predetermined number of <em>meaningful nodes</em>
of the structure it is hashing. By default, that number is 10. A meaningful node
is an integer, floating-point number, string, character, booleans or constant
constructor.  You can see that as we hash these lists:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="nn">Hashtbl</span><span class="p">.</span><span class="n">hash</span> <span class="o">[</span><span class="mi">1</span><span class="o">;</span> <span class="mi">2</span><span class="o">;</span> <span class="mi">3</span><span class="o">;</span> <span class="mi">4</span><span class="o">;</span> <span class="mi">5</span><span class="o">;</span> <span class="mi">6</span><span class="o">;</span> <span class="mi">7</span><span class="o">;</span> <span class="mi">8</span><span class="o">;</span> <span class="mi">9</span><span class="o">];;</span>
<span class="nn">Hashtbl</span><span class="p">.</span><span class="n">hash</span> <span class="o">[</span><span class="mi">1</span><span class="o">;</span> <span class="mi">2</span><span class="o">;</span> <span class="mi">3</span><span class="o">;</span> <span class="mi">4</span><span class="o">;</span> <span class="mi">5</span><span class="o">;</span> <span class="mi">6</span><span class="o">;</span> <span class="mi">7</span><span class="o">;</span> <span class="mi">8</span><span class="o">;</span> <span class="mi">9</span><span class="o">;</span> <span class="mi">10</span><span class="o">];;</span>
<span class="nn">Hashtbl</span><span class="p">.</span><span class="n">hash</span> <span class="o">[</span><span class="mi">1</span><span class="o">;</span> <span class="mi">2</span><span class="o">;</span> <span class="mi">3</span><span class="o">;</span> <span class="mi">4</span><span class="o">;</span> <span class="mi">5</span><span class="o">;</span> <span class="mi">6</span><span class="o">;</span> <span class="mi">7</span><span class="o">;</span> <span class="mi">8</span><span class="o">;</span> <span class="mi">9</span><span class="o">;</span> <span class="mi">10</span><span class="o">;</span> <span class="mi">11</span><span class="o">];;</span>
<span class="nn">Hashtbl</span><span class="p">.</span><span class="n">hash</span> <span class="o">[</span><span class="mi">1</span><span class="o">;</span> <span class="mi">2</span><span class="o">;</span> <span class="mi">3</span><span class="o">;</span> <span class="mi">4</span><span class="o">;</span> <span class="mi">5</span><span class="o">;</span> <span class="mi">6</span><span class="o">;</span> <span class="mi">7</span><span class="o">;</span> <span class="mi">8</span><span class="o">;</span> <span class="mi">9</span><span class="o">;</span> <span class="mi">10</span><span class="o">;</span> <span class="mi">11</span><span class="o">;</span> <span class="mi">12</span><span class="o">];;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>- : int = 635296333
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>- : int = 822221246
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>- : int = 822221246
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>- : int = 822221246
</pre></div>
</div>
</div>
</div>
<p>The hash values stop changing after the list goes beyond 10 elements. That has
implications for how we use this built-in hash function: it will not necessarily
provide good diffusion for large data structures, which means performance could
degrade as collisions become common. To support clients who want to hash such
structures, <code class="docutils literal notranslate"><span class="pre">Hashtbl</span></code> provides another function <code class="docutils literal notranslate"><span class="pre">hash_param</span></code> which can be
configured to examine more nodes.</p>
<p><strong>Hash table.</strong> Here’s an abstract of the hash table interface:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="k">type</span> <span class="nc">Hashtbl</span> <span class="o">=</span> <span class="k">sig</span>
  <span class="k">type</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">a</span><span class="o">,</span> <span class="k">&#39;</span><span class="n">b</span><span class="o">)</span> <span class="n">t</span>
  <span class="k">val</span> <span class="n">create</span> <span class="o">:</span> <span class="kt">int</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">a</span><span class="o">,</span> <span class="k">&#39;</span><span class="n">b</span><span class="o">)</span> <span class="n">t</span>
  <span class="k">val</span> <span class="n">add</span> <span class="o">:</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">a</span><span class="o">,</span> <span class="k">&#39;</span><span class="n">b</span><span class="o">)</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">b</span> <span class="o">-&gt;</span> <span class="kt">unit</span>
  <span class="k">val</span> <span class="n">find</span> <span class="o">:</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">a</span><span class="o">,</span> <span class="k">&#39;</span><span class="n">b</span><span class="o">)</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">b</span>
  <span class="k">val</span> <span class="n">remove</span> <span class="o">:</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">a</span><span class="o">,</span> <span class="k">&#39;</span><span class="n">b</span><span class="o">)</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="kt">unit</span>
  <span class="o">...</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The representation type <code class="docutils literal notranslate"><span class="pre">('a,</span> <span class="pre">'b)</span> <span class="pre">Hashtbl.t</span></code> maps keys of type <code class="docutils literal notranslate"><span class="pre">'a</span></code> to values of
type <code class="docutils literal notranslate"><span class="pre">'b</span></code>. The <code class="docutils literal notranslate"><span class="pre">create</span></code> function initializes a hash table to have a given
capacity, as our implementation above did. But rather than requiring the client
to provide a hash function, the module uses <code class="docutils literal notranslate"><span class="pre">Hashtbl.hash</span></code>.</p>
<p>Resizing occurs when the load factor exceeds 2. Let’s see that happen. First,
we’ll create a table and fill it up:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">open</span> <span class="nc">Hashtbl</span><span class="o">;;</span>
<span class="k">let</span> <span class="n">t</span> <span class="o">=</span> <span class="n">create</span> <span class="mi">16</span><span class="o">;;</span>
<span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">to</span> <span class="mi">16</span> <span class="k">do</span>
  <span class="n">add</span> <span class="n">t</span> <span class="n">i</span> <span class="o">(</span><span class="n">string_of_int</span> <span class="n">i</span><span class="o">)</span>
<span class="k">done</span><span class="o">;;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val t : (&#39;_weak1, &#39;_weak2) Hashtbl.t = &lt;abstr&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>- : unit = ()
</pre></div>
</div>
</div>
</div>
<p>We can query the hash table to find out how the bindings are distributed
over buckets with <code class="docutils literal notranslate"><span class="pre">Hashtbl.stats</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="n">stats</span> <span class="n">t</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>- : Hashtbl.statistics =
{num_bindings = 16; num_buckets = 16; max_bucket_length = 3;
 bucket_histogram = [|6; 5; 4; 1|]}
</pre></div>
</div>
</div>
</div>
<p>The number of bindings and number of buckets are equal, so the load factor is 1.
The bucket histogram is an array <code class="docutils literal notranslate"><span class="pre">a</span></code> in which <code class="docutils literal notranslate"><span class="pre">a.(i)</span></code> is the number of buckets whose size is <code class="docutils literal notranslate"><span class="pre">i</span></code>.</p>
<p>Let’s pump up the load factor to 2:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">17</span> <span class="k">to</span> <span class="mi">32</span> <span class="k">do</span>
  <span class="n">add</span> <span class="n">t</span> <span class="n">i</span> <span class="o">(</span><span class="n">string_of_int</span> <span class="n">i</span><span class="o">)</span>
<span class="k">done</span><span class="o">;;</span>
<span class="n">stats</span> <span class="n">t</span><span class="o">;;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>- : unit = ()
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>- : Hashtbl.statistics =
{num_bindings = 32; num_buckets = 16; max_bucket_length = 4;
 bucket_histogram = [|3; 3; 3; 5; 2|]}
</pre></div>
</div>
</div>
</div>
<p>Now adding one more binding will trigger a resize, which doubles the number of
buckets:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="n">add</span> <span class="n">t</span> <span class="mi">33</span> <span class="s2">&quot;33&quot;</span><span class="o">;;</span>
<span class="n">stats</span> <span class="n">t</span><span class="o">;;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>- : unit = ()
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>- : Hashtbl.statistics =
{num_bindings = 33; num_buckets = 32; max_bucket_length = 3;
 bucket_histogram = [|11; 11; 8; 2|]}
</pre></div>
</div>
</div>
</div>
<p>But <code class="docutils literal notranslate"><span class="pre">Hashtbl</span></code> does not implement resize on removal:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">to</span> <span class="mi">33</span> <span class="k">do</span>
  <span class="n">remove</span> <span class="n">t</span> <span class="n">i</span>
<span class="k">done</span><span class="o">;;</span>
<span class="n">stats</span> <span class="n">t</span><span class="o">;;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>- : unit = ()
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>- : Hashtbl.statistics =
{num_bindings = 0; num_buckets = 32; max_bucket_length = 0;
 bucket_histogram = [|32|]}
</pre></div>
</div>
</div>
</div>
<p>The number of buckets is still 32, even though all bindings have been removed.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Java’s <code class="docutils literal notranslate"><span class="pre">HashMap</span></code> has a default constructor <code class="docutils literal notranslate"><span class="pre">HashMap()</span></code> that creates an empty
hash table with a capacity of 16 that resizes when the load factor exceeds 0.75
rather than 2. So Java hash tables would tend to have a shorter bucket length
than OCaml hash tables, but also would tend to take more space to store because
of empty buckets.</p>
</div>
<p><strong>Client-provided hash functions.</strong> What if a client of <code class="docutils literal notranslate"><span class="pre">Hashtbl</span></code> found that the
default hash function was leading to collisions, hence poor performance? Then
it would make sense to change to a different hash function.  To support that,
<code class="docutils literal notranslate"><span class="pre">Hashtbl</span></code> provides a functorial interface similar to <code class="docutils literal notranslate"><span class="pre">Map</span></code>.  The functor
is <code class="docutils literal notranslate"><span class="pre">Hashtbl.Make</span></code>, and it requires an input of the following module type:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="k">type</span> <span class="nc">HashedType</span> <span class="o">=</span> <span class="k">sig</span>
  <span class="k">type</span> <span class="n">t</span>
  <span class="k">val</span> <span class="n">equal</span> <span class="o">:</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="kt">bool</span>
  <span class="k">val</span> <span class="n">hash</span> <span class="o">:</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="kt">int</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Type <code class="docutils literal notranslate"><span class="pre">t</span></code> is the key type for the table, and the two functions <code class="docutils literal notranslate"><span class="pre">equal</span></code> and <code class="docutils literal notranslate"><span class="pre">hash</span></code>
say how to compare keys for equality and how to hash them. If two keys are equal
according to <code class="docutils literal notranslate"><span class="pre">equal</span></code>, they must have the same hash value according to <code class="docutils literal notranslate"><span class="pre">hash</span></code>. If
that requirement were violated, the hash table would no longer operate
correctly. For example, suppose that <code class="docutils literal notranslate"><span class="pre">equal</span> <span class="pre">k1</span> <span class="pre">k2</span></code> holds but
<code class="docutils literal notranslate"><span class="pre">hash</span> <span class="pre">k1</span> <span class="pre">&lt;&gt;</span> <span class="pre">hash</span> <span class="pre">k2</span></code>. Then <code class="docutils literal notranslate"><span class="pre">k1</span></code> and <code class="docutils literal notranslate"><span class="pre">k2</span></code> would be stored in different buckets.
So if a client added a binding of <code class="docutils literal notranslate"><span class="pre">k1</span></code> to <code class="docutils literal notranslate"><span class="pre">v</span></code>, then looked up <code class="docutils literal notranslate"><span class="pre">k2</span></code>, they would
not get <code class="docutils literal notranslate"><span class="pre">v</span></code> back.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>That final requirement might sound familiar from Java. There, if you override
<code class="docutils literal notranslate"><span class="pre">Object.equals()</span></code> and <code class="docutils literal notranslate"><span class="pre">Object.hashCode()</span></code> you must ensure the same
correspondence.</p>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "cs3110/textbook",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "ocaml-jupyter"
        },
        kernelOptions: {
            name: "ocaml-jupyter",
            path: "./chapters/ds"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ocaml-jupyter'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="intro.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">8. </span>Data Structures</p>
      </div>
    </a>
    <a class="right-next"
       href="amortized.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">8.2. </span>Amortized Analysis</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#maps">8.1.1. Maps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#maps-as-association-lists">8.1.2. Maps as Association Lists</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#maps-as-arrays">8.1.3. Maps as Arrays</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#maps-as-hash-tables">8.1.4. Maps as Hash Tables</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#chaining-representation">8.1.4.1. Chaining Representation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#resizing">8.1.4.2. Resizing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation">8.1.4.3. Implementation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hash-functions">8.1.5. Hash Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#standard-library-hashtbl">8.1.6. Standard Library <code class="docutils literal notranslate"><span class="pre">Hashtbl</span></code></a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Michael R. Clarkson et al.
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=bd9e20870c6007c4c509"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=bd9e20870c6007c4c509"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>